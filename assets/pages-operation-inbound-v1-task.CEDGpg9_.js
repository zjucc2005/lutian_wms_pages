import{_ as t}from"./uni-list-item.BnynrAPo.js";import{s as i,c as e,d as n,w as s,i as a,o,e as _,q as l,u as r,F as u,f as c,t as m,k as d}from"./index-DGWOUQdM.js";import{r as f}from"./uni-app.es.DKZsoyMd.js";import{_ as h}from"./uni-list.Kn4QrsAX.js";import{_ as p}from"./uni-section.Dvy4SRsN.js";import{_ as F}from"./uni-icons.LDhtL0t0.js";import{_ as k}from"./uni-drawer.Cl_UrRdK.js";import{I as g}from"./inbound_task.DqmN0Qhk.js";import"./k3cloudapi.CbDqg_He.js";import"./stock_loc.C36uFwb2.js";import{I as b}from"./inv_log.OihDyY2r.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-badge._gn3hy42.js";import"./date-format.Dm3Q97cL.js";const x=T({data:()=>({cur_stock:{},cur_staff:{},cur_inbound_task:{},inv_logs:[],mount_infos:[],mount_info_drawer_data:[]}),mounted(){this.cur_stock=i.state.cur_stock,this.cur_staff=i.state.cur_staff,this.cur_inbound_task=g.current(),this.load_inv_logs()},methods:{handle_list_item_click(t){this.mount_info_drawer_data=this.inv_logs.filter((i=>i["FMaterialId.FNumber"]==t.material_no&&"in"==i.FOpType&&!i.status)),this.$refs.mount_info_drawer.open()},load_inv_logs(){b.query({FStockId:this.cur_stock.FStockId,FBatchNo:this.cur_inbound_task.batch_no,FOpType_in:["in","in_cl"]},{order:"FCreateTime DESC"}).then((t=>{t.data.reverse().forEach((t=>this.unshift_inv_log(t))),this.set_mount_infos()}))},unshift_inv_log(t){if("in_cl"==t.FOpType){let i=this.inv_logs.find((i=>i.FID===t.FReferId));i&&(i.status="已取消")}this.inv_logs.unshift(t)},set_mount_infos(){let t=[];this.inv_logs.forEach((i=>{if("in"==i.FOpType&&!i.status){let e=t.find((t=>t.material_no==i["FMaterialId.FNumber"]));e?e.mounted_qty+=i.FOpQTY:(e={material_no:i["FMaterialId.FNumber"],material_name:i["FMaterialId.FName"],material_spec:i["FMaterialId.FSpecification"],mounted_qty:i.FOpQTY,base_unit_name:i["FStockUnitId.FName"]},t.push(e))}})),this.mount_infos=t}}},[["render",function(i,g,b,T,x,y){const j=f(e("uni-list-item"),t),I=f(e("uni-list"),h),v=f(e("uni-section"),p),N=d,w=a,O=f(e("uni-icons"),F),S=f(e("uni-drawer"),k);return o(),n(w,null,{default:s((()=>[_(v,{title:"进行中的入库任务",type:"line"},{default:s((()=>[_(I,null,{default:s((()=>[_(j,{title:"入库日期",rightText:x.cur_inbound_task.inbound_date},null,8,["rightText"]),_(j,{title:"批次号",rightText:x.cur_inbound_task.batch_no},null,8,["rightText"]),_(j,{title:"单据编号",rightText:x.cur_inbound_task.bill_no},null,8,["rightText"]),_(j,{title:"组织",rightText:x.cur_stock["FUseOrgId.FName"]},null,8,["rightText"]),_(j,{title:"仓库",rightText:[x.cur_stock["FGroup.FName"],x.cur_stock.FName].join(" - ")},null,8,["rightText"]),_(j,{title:"员工",rightText:x.cur_staff.FName},null,8,["rightText"])])),_:1})])),_:1}),_(v,{title:"上架物料信息",type:"line"},{default:s((()=>[_(I,null,{default:s((()=>[(o(!0),l(u,null,r(x.cur_inbound_task.inbound_list,((t,i)=>(o(),n(j,{key:i,rightText:[t.base_unit_qty,t.base_unit_name].join(" "),disabled:t.dest_stock_id!=x.cur_stock.FStockId},{body:s((()=>[_(w,{class:"uni-list-item__content uni-list-item__content--center"},{default:s((()=>[_(N,{class:"uni-list-item__content-title"},{default:s((()=>[c(m(t.material_no),1)])),_:2},1024),_(w,{class:"uni-list-item__content-note"},{default:s((()=>[_(w,null,{default:s((()=>[c(m(t.material_name),1)])),_:2},1024),_(w,null,{default:s((()=>[c(m(t.material_spec),1)])),_:2},1024),_(w,null,{default:s((()=>[_(O,{type:"home",color:"#999"}),_(N,{class:"src-stock"},{default:s((()=>[c(m(t.src_stock_name),1)])),_:2},1024),_(O,{type:"redo",color:"#007bff",style:{margin:"0 5px"}}),_(O,{type:"home",color:"#007bff"}),_(N,{class:"dest-stock"},{default:s((()=>[c(m(t.dest_stock_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["rightText","disabled"])))),128))])),_:1}),_(I,null,{default:s((()=>[(o(!0),l(u,null,r(x.mount_infos,((t,i)=>(o(),n(j,{key:i,title:t.material_no,note:[t.material_name,t.material_spec].join("\n"),rightText:[t.mounted_qty,t.base_unit_name].join(" "),showArrow:""},null,8,["title","note","rightText"])))),128))])),_:1})])),_:1}),_(S,{ref:"mount_info_drawer"},{default:s((()=>[_(w,{class:"close"},{default:s((()=>[c(m(x.mount_info_drawer_data),1)])),_:1})])),_:1},512)])),_:1})}]]);export{x as default};
