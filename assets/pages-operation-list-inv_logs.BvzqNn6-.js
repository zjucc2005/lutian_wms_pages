import{P as e,v as t,p as a,s as l,a as o,h as i,c as s,q as r,d as _,w as n,e as c,F as d,o as u,f as m,u as f,i as p,t as h,g,k as y}from"./index-DsK9pIyj.js";import{_ as F,a as v,b}from"./uni-td.DKOxbdh1.js";import{r as k}from"./uni-app.es.CSK8ITuj.js";import{_ as I}from"./uni-table.BXeOwSLO.js";import{_ as x}from"./uni-icons.DRoE6XYp.js";import{_ as V}from"./uni-list-item.BkmqxiQh.js";import{_ as w}from"./uni-list.dJf-6p1_.js";import{_ as T}from"./uni-load-more.CyJx3ZKG.js";import{_ as C}from"./uni-fab.b1ZtjMUn.js";import{_ as j}from"./uni-datetime-picker.Bsu03if5.js";import{_ as O,a as N}from"./uni-forms.DoSYlyoS.js";import{_ as S}from"./uni-data-select.DcISTJAW.js";import{_ as M}from"./uni-easyinput.BfazFYzq.js";import{_ as P,a as D}from"./uni-popup.CPWlX1tX.js";import{f as U}from"./date-format.Dm3Q97cL.js";import"./k3cloudapi.PCDjx1SF.js";import"./stock_loc.Bj3C3Byx.js";import{I as R}from"./inv_log.D0BShjlW.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-badge.CO78OwkC.js";const L=B({props:{material_no:{type:String}},data:()=>({inv_logs:[],search_form:{create_time_ge:"",create_time_le:"",op_type:"",material_no:"",material_name:"",material_spec:"",bill_no:"",receiver:"",status:""},page:1,per_page:25,load_more_status:"more",op_type_dict:R.FOpTypeEnum,fab_content:[{iconPath:"/static/icon/cc_search.png",selectedIconPath:"/static/icon/cc_search_active.png",text:"搜索",active:!1},{iconPath:"/static/icon/cc_inbound.png",selectedIconPath:"/static/icon/cc_inbound_active.png",text:"入库",active:!1},{iconPath:"/static/icon/cc_outbound.png",selectedIconPath:"/static/icon/cc_outbound_active.png",text:"出库",active:!1},{iconPath:"/static/icon/cc_warn.png",selectedIconPath:"/static/icon/cc_warn_active.png",text:"失败",active:!1},{iconPath:"/static/icon/cc_gotop.png",selectedIconPath:"/static/icon/cc_gotop_active.png",text:"返回顶部",active:!1}]}),onPullDownRefresh(){this.reload_inv_logs(),e()},onReachBottom(){this.load_more()},onLoad(e){e.material_no&&(this.search_form.material_no=e.material_no)},mounted(){this.load_inv_logs()},computed:{op_type_options(){return Object.getOwnPropertyNames(this.op_type_dict).map((e=>({value:e,text:this.op_type_dict[e]})))}},methods:{formatDate:U,fab_icon_active(e){for(let t=0;t<this.fab_content.length;t++)this.fab_content[t].active=t==e},fab_trigger(e){0===e.index&&this.$refs.search_dialog.open(),1===e.index&&(this.search_form={op_type:"in"},this.reload_inv_logs(),this.fab_icon_active(1)),2===e.index&&(this.search_form={op_type:"out"},this.reload_inv_logs(),this.fab_icon_active(2)),3===e.index&&(this.search_form={status:"failed"},this.reload_inv_logs(),this.fab_icon_active(3)),4===e.index&&t({scrollTop:0})},inv_log_menu(e){e.FCInvId||a({itemList:["全部重试"],success:e=>{0===e.tapIndex&&this.retry_all()}})},load_more(){"nomore"!=this.load_more_status&&(this.page+=1,this.load_inv_logs())},reload_inv_logs(){this.inv_logs=[],this.load_more_status="more",this.page=1,this.load_inv_logs()},search_dialog_close(){this.$refs.search_dialog.close()},search_dialog_confirm(){this.reload_inv_logs(),this.search_dialog_close()},async load_inv_logs(){let e={FStockId:l.state.cur_stock.FStockId};this.search_form.create_time_ge&&(e.FCreateTime_ge=this.search_form.create_time_ge),this.search_form.create_time_le&&(e.FCreateTime_le=this.search_form.create_time_le),this.search_form.op_type&&(e.FOpType=this.search_form.op_type),"in"==this.search_form.op_type?this.fab_icon_active(1):"out"==this.search_form.op_type?this.fab_icon_active(2):"failed"==this.search_form.status?this.fab_icon_active(3):this.fab_icon_active(-1),this.search_form.material_no&&(e["FMaterialId.FNumber_lk"]=this.search_form.material_no),this.search_form.material_name&&(e.FMaterialName_lk=this.search_form.material_name),this.search_form.material_spec&&(e.FModel_lk=this.search_form.material_spec),this.search_form.bill_no&&(e.FBillNo_lk=this.search_form.bill_no),this.search_form.receiver&&(e.FReceiver_lk=this.search_form.receiver),"failed"==this.search_form.status&&(e.FCInvId="");let t={page:this.page,per_page:this.per_page,order:"FID DESC"};this.load_more_status="loading",R.query(e,t).then((e=>{this.load_more_status=e.data.length<this.per_page?"nomore":"more",e.data.forEach((e=>this.inv_logs.push(e)))}))},async retry_all(){let e={FStockId:l.state.cur_stock.FStockId,FCInvId:""};o({title:"重试中"});let t=await R.query(e,{order:"FID ASC"});for(let a of t.data)await R.retry(a);i(),this.inv_logs=[],this.search_form.status="failed",this.load_more_status="more",this.page=1,this.load_inv_logs()}}},[["render",function(e,t,a,l,o,i){const U=k(s("uni-th"),F),R=k(s("uni-tr"),v),B=k(s("uni-td"),b),L=p,$=y,q=k(s("uni-table"),I),E=k(s("uni-icons"),x),z=k(s("uni-list-item"),V),A=k(s("uni-list"),w),Q=k(s("uni-load-more"),T),Y=k(s("uni-fab"),C),G=k(s("uni-datetime-picker"),j),H=k(s("uni-forms-item"),O),J=k(s("uni-data-select"),S),K=k(s("uni-easyinput"),M),W=k(s("uni-forms"),N),X=k(s("uni-popup-dialog"),P),Z=k(s("uni-popup"),D);return u(),r(d,null,["h5"===e.$store.state.screen_type?(u(),_(q,{key:0,ref:"table",border:"",stripe:""},{default:n((()=>[c(R,null,{default:n((()=>[c(U,{align:"center",width:"160"},{default:n((()=>[m("时间")])),_:1}),c(U,{align:"center",width:"80"},{default:n((()=>[m("操作类型")])),_:1}),c(U,{align:"center",width:"60"},{default:n((()=>[m("数量")])),_:1}),c(U,{align:"center",width:"80"},{default:n((()=>[m("计量单位")])),_:1}),c(U,{align:"center",width:"160"},{default:n((()=>[m("物料编码")])),_:1}),c(U,{align:"center",width:"200"},{default:n((()=>[m("物料名称")])),_:1}),c(U,{align:"center"},{default:n((()=>[m("规格型号")])),_:1}),c(U,{align:"center",width:"80"},{default:n((()=>[m("批次")])),_:1}),c(U,{align:"center",width:"120"},{default:n((()=>[m("库位")])),_:1}),c(U,{align:"center"},{default:n((()=>[m("单据编号")])),_:1}),c(U,{align:"center",width:"80"},{default:n((()=>[m("收货人")])),_:1}),c(U,{align:"center"},{default:n((()=>[m("备注")])),_:1}),c(U,{align:"center",width:"120"},{default:n((()=>[m("操作员工编号")])),_:1}),c(U,{align:"center",width:"80"},{default:n((()=>[m("状态")])),_:1})])),_:1}),(u(!0),r(d,null,f(o.inv_logs,((t,a)=>(u(),_(R,{key:a},{default:n((()=>[c(B,null,{default:n((()=>[m(h(i.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024),c(B,null,{default:n((()=>[["in","add"].includes(t.FOpType)?(u(),_(L,{key:0,class:"text-error"},{default:n((()=>[m(h(o.op_type_dict[t.FOpType]),1)])),_:2},1024)):g("",!0),["out","sub"].includes(t.FOpType)?(u(),_(L,{key:1,class:"text-primary"},{default:n((()=>[m(h(o.op_type_dict[t.FOpType]),1)])),_:2},1024)):g("",!0),["mv_in","mv_out"].includes(t.FOpType)?(u(),_(L,{key:2},{default:n((()=>[m(h(o.op_type_dict[t.FOpType]),1)])),_:2},1024)):g("",!0)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t.FOpQTY),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t["FStockUnitId.FName"]),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t["FMaterialId.FNumber"]),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t["FMaterialId.FName"]),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t["FMaterialId.FSpecification"]),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t.FBatchNo),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t["FStockLocId.FNumber"]),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t.FBillNo),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t.FReceiver),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t.FRemark),1)])),_:2},1024),c(B,null,{default:n((()=>[m(h(t.FOpStaffNo),1)])),_:2},1024),c(B,null,{default:n((()=>[c($,{class:"text-primary"},{default:n((()=>[m(h(e.$store.state.document_status_dict[t.FDocumentStatu]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)):(u(),_(A,{key:1},{default:n((()=>[(u(!0),r(d,null,f(o.inv_logs,((t,a)=>(u(),_(z,{key:a,"show-extra-icon":!t.FCInvId,"extra-icon":{type:"loop",size:"24",color:"#dd524d"},onClick:e=>i.inv_log_menu(t),clickable:!t.FCInvId,"show-arrow":!t.FCInvId},{body:n((()=>[c(L,{class:"uni-list-item__body"},{default:n((()=>[c(L,{class:"title"},{default:n((()=>[m(h(t["FMaterialId.FNumber"])+" / "+h(t["FMaterialId.FName"]),1)])),_:2},1024),c(L,{class:"note"},{default:n((()=>{var e,a,l;return[c(L,null,{default:n((()=>[m("规格："+h(t["FMaterialId.FSpecification"]),1)])),_:2},1024),c(L,null,{default:n((()=>[m(" 库位："),c($,{class:"text-default"},{default:n((()=>[m(h(t["FStockLocId.FNumber"]),1)])),_:2},1024),"mv"==t.FOpType?(u(),r(d,{key:0},[c(E,{type:"redo",color:"#007bff"}),c($,{class:"text-primary uni-ml-2"},{default:n((()=>[m(h(t["FDestStockLocId.FNumber"]),1)])),_:2},1024)],64)):g("",!0),c($,{class:"uni-ml-5"},{default:n((()=>[m("批次："+h(t.FBatchNo),1)])),_:2},1024)])),_:2},1024),(null==(e=t.FBillNo)?void 0:e.trim())?(u(),_(L,{key:0},{default:n((()=>[m("单据："+h(t.FBillNo),1)])),_:2},1024)):g("",!0),(null==(a=t.FReceiver)?void 0:a.trim())?(u(),_(L,{key:1},{default:n((()=>[m("收货人："+h(t.FReceiver),1)])),_:2},1024)):g("",!0),(null==(l=t.FRemark)?void 0:l.trim())?(u(),_(L,{key:2},{default:n((()=>[m("备注："+h(t.FRemark),1)])),_:2},1024)):g("",!0),c(L,null,{default:n((()=>[m("时间："+h(i.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024),t.FCInvId?g("",!0):(u(),_(L,{key:3,class:"text-error"},{default:n((()=>[m("库存未更新，请点击重试")])),_:1}))]})),_:2},1024)])),_:2},1024)])),footer:n((()=>[c(L,{class:"uni-list-item__foot"},{default:n((()=>[["in","add"].includes(t.FOpType)?(u(),_(L,{key:0,class:"text-error"},{default:n((()=>[m(h(o.op_type_dict[t.FOpType]),1)])),_:2},1024)):g("",!0),["out","sub"].includes(t.FOpType)?(u(),_(L,{key:1,class:"text-primary"},{default:n((()=>[m(h(o.op_type_dict[t.FOpType]),1)])),_:2},1024)):g("",!0),["mv_in","mv_out"].includes(t.FOpType)?(u(),_(L,{key:2},{default:n((()=>[m(h(o.op_type_dict[t.FOpType]),1)])),_:2},1024)):g("",!0),c(L,null,{default:n((()=>[m(h(t.FOpQTY)+" "+h(t["FStockUnitId.FName"]),1)])),_:2},1024),c(L,{class:"text-primary"},{default:n((()=>[m(h(e.$store.state.document_status_dict[t.FDocumentStatu]),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["show-extra-icon","onClick","clickable","show-arrow"])))),128))])),_:1})),c(Q,{status:o.load_more_status,onClickLoadMore:i.load_more},null,8,["status","onClickLoadMore"]),c(Y,{ref:"fab",content:o.fab_content,onTrigger:i.fab_trigger,show:""},null,8,["content","onTrigger"]),c(Z,{ref:"search_dialog",type:"dialog"},{default:n((()=>[c(X,{type:"info",title:"搜索条件",cancelText:"关闭",onClose:i.search_dialog_close,onConfirm:i.search_dialog_confirm,"before-close":!0,style:{width:"360px"}},{default:n((()=>[c(L,{class:"search-form"},{default:n((()=>[c(W,{ref:"search_form",model:o.search_form},{default:n((()=>[c(H,{label:"开始时间"},{default:n((()=>[c(G,{type:"date",modelValue:o.search_form.create_time_ge,"onUpdate:modelValue":t[0]||(t[0]=e=>o.search_form.create_time_ge=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"结束时间"},{default:n((()=>[c(G,{type:"date",modelValue:o.search_form.create_time_le,"onUpdate:modelValue":t[1]||(t[1]=e=>o.search_form.create_time_le=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"操作类型"},{default:n((()=>[c(J,{modelValue:o.search_form.op_type,"onUpdate:modelValue":t[2]||(t[2]=e=>o.search_form.op_type=e),localdata:i.op_type_options},null,8,["modelValue","localdata"])])),_:1}),c(H,{label:"物料编码"},{default:n((()=>[c(K,{modelValue:o.search_form.material_no,"onUpdate:modelValue":t[3]||(t[3]=e=>o.search_form.material_no=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"名称"},{default:n((()=>[c(K,{modelValue:o.search_form.material_name,"onUpdate:modelValue":t[4]||(t[4]=e=>o.search_form.material_name=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"规格"},{default:n((()=>[c(K,{modelValue:o.search_form.material_spec,"onUpdate:modelValue":t[5]||(t[5]=e=>o.search_form.material_spec=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"单据编号"},{default:n((()=>[c(K,{modelValue:o.search_form.bill_no,"onUpdate:modelValue":t[6]||(t[6]=e=>o.search_form.bill_no=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"收货人"},{default:n((()=>[c(K,{modelValue:o.search_form.receiver,"onUpdate:modelValue":t[7]||(t[7]=e=>o.search_form.receiver=e)},null,8,["modelValue"])])),_:1}),c(H,{label:"状态"},{default:n((()=>[c(J,{modelValue:o.search_form.status,"onUpdate:modelValue":t[8]||(t[8]=e=>o.search_form.status=e),localdata:[{value:"failed",text:"失败"}]},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["onClose","onConfirm"])])),_:1},512)],64)}],["__scopeId","data-v-6e89d9f7"]]);export{L as default};
