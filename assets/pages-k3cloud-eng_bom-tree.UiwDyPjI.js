import{a as e,h as a,c as t,d as r,w as l,o,e as i,g as s,q as _,u as d,F as n,i as m,f as c,t as u,L as I,k as p}from"./index-MIvYX1nW.js";import{_ as f}from"./uni-load-more.5aGCwx5G.js";import{r as b}from"./uni-app.es.B8zr0lZI.js";import{_ as h}from"./uni-icons.DEYikQDp.js";import{_ as D}from"./uni-section.C7O4oyAr.js";import{l as g}from"./index.DbF5UMRK.js";import"./k3cloudapi.DzDu3BGl.js";import{E as L}from"./eng_bom.Cg1RpB00.js";import"./stock_loc.BckAHwoS.js";import"./inv_log.BJcJnepW.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=N({props:{bom_id:{type:String},material_no:{type:String},sup:{type:String,default:"false"}},data:()=>({_props:{},tree_data:[]}),onLoad(e){this._props=e,e.bom_id?this.load_eng_bom(e.bom_id):e.material_no&&this.load_eng_boms(e.material_no,e.sup)},mounted(){},methods:{search_bom(e,a){g(`/pages/k3cloud/eng_bom/tree?bom_id=${e}&material_no=${a}&sup=false`)},toggle(e){e.open=!e.open,e.open&&!e.loaded&&this.load_children(e)},async load_children(t){e({title:"Loading"});let r=await L.view(t.bom_id);a(),t.children=this._handle_eng_bom_children(r),t.open=!0,t.loaded=!0},async load_eng_bom(t){e({title:"Loading"});let r=await L.view(t);a(),this.tree_data=this._handle_eng_bom(r)},async load_eng_boms(t,r){let l={FForbidStatus:"A"};"true"==r?l["FMaterialIdChild.FNumber"]=t:l["FMaterialId.FNumber"]=t;e({title:"Loading"});let o=await L.query(l,{});a();let i=[];for(let e of o.data)i.some((a=>a.bom_id==e.FID))||i.push({bom_id:e.FID,bom_no:e.FNumber,material_id:e.FMaterialId,material_no:e["FMaterialId.FNumber"],material_name:e["FMaterialId.FName"],material_spec:e.FItemModel,use_org_id:e.FUseOrgId,use_org_name:e["FUseOrgId.FName"],open:!1,loaded:!1,children:[]});if(this.tree_data=i,1==this.tree_data.length)for(let e of this.tree_data)await this.load_children(e)},_handle_eng_bom(e){var a;if(e.data.Result.ResponseStatus.IsSuccess){let t=e.data.Result.Result,r={bom_id:t.Id,bom_no:t.Number,material_id:t.MATERIALID_Id,material_no:t.MATERIALID.Number,material_name:t.MATERIALID.Name[0].Value,material_spec:t.MATERIALID.Specification[0].Value,use_org_id:t.UseOrgId_Id,use_org_name:t.UseOrgId.Name[0].Value,open:!0,loaded:!0,children:[]};for(let e of t.TreeEntity.sort(((e,a)=>e.Seq-a.Seq)))e.CHILDUNITID_Id&&r.children.push({bom_id:e.BOMID_Id,bom_no:null==(a=e.BOMID)?void 0:a.Number,material_id:e.MATERIALIDCHILD_Id,material_no:e.MATERIALIDCHILD.Number,material_name:e.MATERIALIDCHILD.Name[0].Value,material_spec:e.MATERIALIDCHILD.Specification[0].Value,unit_id:e.CHILDUNITID_Id,unit_name:e.CHILDUNITID.Name[0].Value,numerator:e.NUMERATOR,denominator:e.DENOMINATOR});return[r]}return[]},_handle_eng_bom_children(e){var a;if(e.data.Result.ResponseStatus.IsSuccess){let t=[],r=e.data.Result.Result;for(let e of r.TreeEntity.sort(((e,a)=>e.Seq-a.Seq)))e.CHILDUNITID_Id&&t.push({bom_id:e.BOMID_Id,bom_no:null==(a=e.BOMID)?void 0:a.Number,material_id:e.MATERIALIDCHILD_Id,material_no:e.MATERIALIDCHILD.Number,material_name:e.MATERIALIDCHILD.Name[0].Value,material_spec:e.MATERIALIDCHILD.Specification[0].Value,unit_id:e.CHILDUNITID_Id,unit_name:e.CHILDUNITID.Name[0].Value,numerator:e.NUMERATOR,denominator:e.DENOMINATOR});return t}return[]}}},[["render",function(e,a,g,L,N,A){const M=b(t("uni-load-more"),f),y=p,R=m,T=b(t("uni-icons"),h),C=b(t("uni-section"),D);return o(),r(C,{title:"true"==N._props.sup?"查询父项物料":"查询子项物料","sub-title":N._props.material_no,type:"square"},{default:l((()=>[i(R,{class:"container"},{default:l((()=>[0===N.tree_data.length?(o(),r(M,{key:0,status:"nomore"})):s("",!0),(o(!0),_(n,null,d(N.tree_data,((e,a)=>(o(),r(R,{key:a,class:"cc-tree-card"},{default:l((()=>[i(R,{class:"cc-tree-card-item"},{default:l((()=>[i(R,{class:"cc-tree-card-item__section"},{default:l((()=>[i(R,{class:"cc-tree-card-item__card",onClick:a=>A.toggle(e)},{default:l((()=>[i(R,{class:"cc-tree-card-item__body"},{default:l((()=>[i(R,{class:"title"},{default:l((()=>[c(u(e.material_no)+" / ",1),i(y,{class:"text-primary"},{default:l((()=>[c(u(e.bom_no),1)])),_:2},1024)])),_:2},1024),i(R,{class:"note"},{default:l((()=>[c("名称："+u(e.material_name),1)])),_:2},1024),i(R,{class:"note"},{default:l((()=>[c("规格："+u(e.material_spec),1)])),_:2},1024),i(R,{class:"note"},{default:l((()=>[c("使用组织："+u(e.use_org_name),1)])),_:2},1024)])),_:2},1024),i(R,{class:"cc-tree-card-item__foot"},{default:l((()=>[e.loaded?(o(),r(R,{key:0,class:"text-primary text-bold"},{default:l((()=>[c(u(e.children.length)+" 子项",1)])),_:2},1024)):(o(),r(R,{key:1},{default:l((()=>[c("展开子项")])),_:1}))])),_:2},1024),i(R,{class:I(["cc-tree-card-item__arrow",{"cc-tree-card-item__arrow-active":e.open}])},{default:l((()=>[i(T,{type:"bottom",size:"14",color:"#999"})])),_:2},1032,["class"])])),_:2},1032,["onClick"])])),_:2},1024),e.open?(o(),r(R,{key:0,class:"cc-tree-card__sub"},{default:l((()=>[(o(!0),_(n,null,d(e.children,((e,a)=>(o(),r(R,{key:a,class:"cc-tree-card-item"},{default:l((()=>[i(R,{class:"vertical-line"}),i(R,{class:"cc-tree-card-item__section"},{default:l((()=>[i(R,{class:"horizontal-line"}),i(R,{class:"cc-tree-card-item__card",onClick:a=>e.bom_id?A.search_bom(e.bom_id,e.material_no):""},{default:l((()=>[i(R,{class:"cc-tree-card-item__body"},{default:l((()=>[e.bom_id?(o(),r(R,{key:0,class:"title"},{default:l((()=>[c(u(e.material_no)+" / ",1),i(y,{class:"text-primary"},{default:l((()=>[c(u(e.bom_no),1)])),_:2},1024)])),_:2},1024)):(o(),r(R,{key:1,class:"title"},{default:l((()=>[c(u(e.material_no),1)])),_:2},1024)),i(R,{class:"note"},{default:l((()=>[c("名称："+u(e.material_name),1)])),_:2},1024),i(R,{class:"note"},{default:l((()=>[c("规格："+u(e.material_spec),1)])),_:2},1024)])),_:2},1024),i(R,{class:"cc-tree-card-item__foot"},{default:l((()=>[i(R,null,{default:l((()=>[c(u(1==e.denominator?e.numerator:[e.numerator,e.denominator].join(" / "))+" "+u(e.unit_name),1)])),_:2},1024)])),_:2},1024),e.bom_id?(o(),r(R,{key:0,class:"cc-tree-card-item__arrow"},{default:l((()=>[i(T,{type:"right",size:"14",color:"#999"})])),_:1})):s("",!0)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):s("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},8,["title","sub-title"])}],["__scopeId","data-v-dac5d502"]]);export{A as default};
