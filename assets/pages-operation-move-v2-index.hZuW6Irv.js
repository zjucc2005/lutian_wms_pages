import{s as t,P as e,p as a,b as l,m as i,a as s,h as n,n as o,c as d,q as u,e as r,w as c,F as _,i as f,o as p,f as m,u as h,d as k,g,t as v,L as b,y as F,k as y}from"./index-DsK9pIyj.js";import{_ as w,a as x,b as I}from"./uni-td.DKOxbdh1.js";import{r as S}from"./uni-app.es.CSK8ITuj.js";import{_ as C}from"./uni-icons.DRoE6XYp.js";import{_ as D}from"./uni-tag.DapJ5B6u.js";import{_ as j}from"./uni-table.BXeOwSLO.js";import{_ as N}from"./uni-section.BpQrEx4g.js";import{_ as R}from"./uni-goods-nav.BN-nj5na.js";import{_ as M}from"./uni-list-item.BkmqxiQh.js";import{_ as L}from"./uni-list.dJf-6p1_.js";import{_ as T}from"./uni-load-more.CyJx3ZKG.js";import{l as O,p as $}from"./index.uHoH2c2-.js";import"./k3cloudapi.PCDjx1SF.js";import{a as B}from"./stock_loc.Bj3C3Byx.js";import"./inv_log.D0BShjlW.js";import{b as A}from"./gen_pdf.C89vt95K.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{f as q}from"./date-format.Dm3Q97cL.js";import"./uni-datetime-picker.Bsu03if5.js";import"./uni-badge.CO78OwkC.js";const P=E({data:()=>({inv_plans:[],op_type_dict:B.FOpTypeEnum,last_refresh_time:0,refresh_interval:3e4,goods_nav:{options:[{icon:"refreshempty",text:"刷新"},{icon:"checkbox",text:"全选"},{icon:"map",text:"PDF"}],admin_button_group:[{text:"审核确认",backgroundColor:t.state.goods_nav_color.green,color:"#fff"},{text:"新增库存调整计划",backgroundColor:t.state.goods_nav_color.blue,color:"#fff"}],staff_button_group:[{text:"提交",backgroundColor:t.state.goods_nav_color.blue,color:"#fff"}]}}),onShow(){this.load_inv_plans()},onPullDownRefresh(){this.refresh(),e()},mounted(){},methods:{link_to:O,formatDate:q,check_all(){let t=!this.inv_plans.find((t=>!t.disabled&&!t.checked));this.inv_plans.forEach((e=>{e.disabled||(e.checked=!t)}))},checkbox_click(t){let e=this.inv_plans.find((e=>e.FID==t.target.dataset.id));e&&!e.disabled&&(e.checked=!e.checked)},list_item_click(t){"A"==t.FDocumentStatu&&a({itemList:["编辑","删除"],success:e=>{0===e.tapIndex&&this.link_to(`/pages/operation/move/v2/plan_new?material_no=${t["FMaterialId.FNumber"]}`),1===e.tapIndex&&this.submit_delete(t)}})},goods_nav_click(t){0===t.index&&this.refresh(),1===t.index&&this.check_all(),2===t.index&&this.preview_pdf()},goods_nav_admin_button_click(t){0===t.index&&this.submit_audit(),1===t.index&&this.new_plan()},goods_nav_staff_button_click(t){0===t.index&&this.submit_submit()},preview_pdf(){let t=this.inv_plans.filter((t=>t.checked));if(0===t.length&&(t=this.inv_plans),0===t.length)return void l({icon:"none",title:"未选择任何条目"});let e=A(t);window.open(`#/pages/my/preview_pdf?url=${e}`,"newWindow","width=800")},if_submit_delete(t){i({title:"删除",content:"是否确定删除?",success:e=>{e.confirm&&this.submit_delete(t)},fail:t=>{}})},async load_inv_plans(){let e={FStockId:t.state.cur_stock.FStockId,FOpType_in:["mv","add","sub"]};return"wh_admin"==t.state.role?e.FDocumentStatu_in=["A","B"]:e.FDocumentStatu="A",s({title:"Loading"}),B.query(e,{order:"FCreateTime ASC"}).then((e=>{n(),this.inv_plans=e.data,this.inv_plans.forEach((e=>{e.checked=!1,e.status=t.state.document_status_dict[e.FDocumentStatu]}))}))},async refresh(){this.last_refresh_time+this.refresh_interval>Date.now()?l({icon:"none",title:"请不要频繁刷新"}):(await this.load_inv_plans(),this.last_refresh_time=Date.now())},async submit_audit(){var t;let e=this.inv_plans.filter((t=>t.checked));if(0===e.length)return void l({icon:"none",title:"未选择任何条目"});s({title:"Loading",mask:!0});let a=e.filter((t=>"A"==t.FDocumentStatu)).map((t=>t.FID));a.length&&await B.submit(a);let i=e.map((t=>t.FID)),o=await B.audit(i);if(o.data.Result.ResponseStatus.IsSuccess){for(let t=0;t<e.length;t++)s({title:`Loading:${t}/${e.length}`,mask:!0}),await B.execute(e[t]);await this.load_inv_plans(),n(),$("success")}else n(),l({icon:"none",title:null==(t=o.data.Result.ResponseStatus.Errors[0])?void 0:t.Message})},async submit_submit(){let t=this.inv_plans.filter((t=>t.checked));if(0===t.length)return void l({icon:"none",title:"未选择任何条目"});s({title:"Loading",mask:!0});let e=t.map((t=>t.FID));B.submit(e).then((t=>{var e;t.data.Result.ResponseStatus.IsSuccess?(n(),$("success"),this.load_inv_plans()):(n(),l({icon:"none",title:null==(e=t.data.Result.ResponseStatus.Errors[0])?void 0:e.Message}))}))},async submit_delete(t){if("A"==t.FDocumentStatu)return s({title:"Loading",mask:!0}),B.delete([t.FID]).then((t=>{var e;n(),t.data.Result.ResponseStatus.IsSuccess?($("delete"),this.load_inv_plans()):l({icon:"none",title:null==(e=t.data.Result.ResponseStatus.Errors[0])?void 0:e.Message})}));l({icon:"error",title:"只能删除新增的计划"})},new_plan(){$("success"),o({url:"/pages/operation/move/v2/plan_new"})}}},[["render",function(t,e,a,l,i,s){const n=S(d("uni-th"),w),o=S(d("uni-tr"),x),O=F,$=S(d("uni-td"),I),B=f,A=S(d("uni-icons"),C),E=y,q=S(d("uni-tag"),D),P=S(d("uni-table"),j),z=S(d("uni-section"),N),Q=S(d("uni-goods-nav"),R),U=S(d("uni-list-item"),M),W=S(d("uni-list"),L),Y=S(d("uni-load-more"),T);return"h5"===t.$store.state.screen_type?(p(),u(_,{key:0},[r(z,{title:"库存调整计划",type:"square",class:"above-uni-goods-nav",onClick:e[0]||(e[0]=t=>console.log(">>> this.$data",this.$data))},{default:c((()=>[r(P,{ref:"table",border:"",stripe:""},{default:c((()=>[r(o,null,{default:c((()=>[r(n,{align:"center",width:"30"}),r(n,{align:"center",width:"60"},{default:c((()=>[m("序号")])),_:1}),r(n,{align:"center"},{default:c((()=>[m("物料编号")])),_:1}),r(n,{align:"center"},{default:c((()=>[m("物料名称")])),_:1}),r(n,{align:"center"},{default:c((()=>[m("规格型号")])),_:1}),r(n,{align:"center",width:"80"},{default:c((()=>[m("操作类型")])),_:1}),r(n,{align:"center",width:"60"},{default:c((()=>[m("数量")])),_:1}),r(n,{align:"center",width:"80"},{default:c((()=>[m("单位")])),_:1}),r(n,{align:"center",width:"120"},{default:c((()=>[m("库位")])),_:1}),r(n,{align:"center",width:"80"},{default:c((()=>[m("批次")])),_:1}),r(n,{align:"center"},{default:c((()=>[m("供应商")])),_:1}),r(n,{align:"center",width:"80"},{default:c((()=>[m("状态")])),_:1}),r(n,{align:"center",width:"160"},{default:c((()=>[m("时间")])),_:1}),r(n,{align:"center",width:"120"},{default:c((()=>[m("操作")])),_:1})])),_:1}),(p(!0),u(_,null,h(i.inv_plans,((t,e)=>(p(),k(o,{key:e},{default:c((()=>[r($,null,{default:c((()=>[r(O,{checked:t.checked,disabled:t.disabled,onClick:s.checkbox_click,"data-id":t.FID},null,8,["checked","disabled","onClick","data-id"])])),_:2},1024),r($,{align:"center"},{default:c((()=>[m(v(e+1),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(t["FMaterialId.FNumber"]),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(t["FMaterialId.FName"]),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(t["FMaterialId.FSpecification"]),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(i.op_type_dict[t.FOpType]),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(t.FOpQTY),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(t["FStockUnitId.FName"]),1)])),_:2},1024),r($,{align:"center"},{default:c((()=>[r(B,null,{default:c((()=>[m(v(t["FStockLocId.FNumber"]),1)])),_:2},1024),"mv"==t.FOpType?(p(),u(_,{key:0},[r(A,{type:"arrow-down",size:"20",color:"#007bff"}),r(B,null,{default:c((()=>[m(v(t["FDestStockLocId.FNumber"]),1)])),_:2},1024)],64)):g("",!0)])),_:2},1024),r($,null,{default:c((()=>[m(v(t.FBatchNo),1)])),_:2},1024),r($,null,{default:c((()=>[m(v(t["FSupplierId.FName"]),1)])),_:2},1024),r($,null,{default:c((()=>[r(E,{class:b([t.disabled?"text-error":"text-primary"])},{default:c((()=>[m(v(t.status),1)])),_:2},1032,["class"])])),_:2},1024),r($,null,{default:c((()=>[m(v(s.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024),r($,{align:"center"},{default:c((()=>["A"==t.FDocumentStatu?(p(),k(B,{key:0},{default:c((()=>[r(q,{text:"编辑",type:"primary",onClick:e=>s.link_to(`/pages/operation/move/v2/plan_new?material_no=${t["FMaterialId.FNumber"]}`)},null,8,["onClick"]),r(q,{text:"删除",type:"error",class:"uni-ml-2",onClick:e=>s.if_submit_delete(t)},null,8,["onClick"])])),_:2},1024)):g("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)])),_:1}),r(B,{class:"uni-goods-nav-wrapper"},{default:c((()=>[r(Q,{options:i.goods_nav.options,"button-group":i.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)):(p(),u(_,{key:1},[r(z,{title:"库存调整计划",type:"square",class:"above-uni-goods-nav"},{default:c((()=>[r(W,null,{default:c((()=>[(p(!0),u(_,null,h(i.inv_plans,((t,e)=>(p(),k(U,{key:e,onClick:e=>s.list_item_click(t),clickable:"","show-arrow":"",onLongpress:e=>s.list_item_click(t)},{header:c((()=>[r(B,{class:"uni-list-item__head"},{default:c((()=>[r(O,{checked:t.checked,disabled:t.disabled,onClick:s.checkbox_click,"data-id":t.FID},null,8,["checked","disabled","onClick","data-id"])])),_:2},1024)])),body:c((()=>[r(B,{class:"uni-list-item__body"},{default:c((()=>[r(B,{class:"title"},{default:c((()=>[m(v(t["FMaterialId.FNumber"]),1)])),_:2},1024),r(B,{class:"note"},{default:c((()=>{var e,a;return[r(B,null,{default:c((()=>[m("名称："+v(t["FMaterialId.FName"]),1)])),_:2},1024),r(B,null,{default:c((()=>[m("规格："+v(t["FMaterialId.FSpecification"]),1)])),_:2},1024),r(B,null,{default:c((()=>[m("批次："+v(t.FBatchNo),1)])),_:2},1024),r(B,null,{default:c((()=>[m(" 库位："),r(E,{class:"src_loc_no"},{default:c((()=>[m(v(t["FStockLocId.FNumber"]),1)])),_:2},1024),"mv"==t.FOpType?(p(),u(_,{key:0},[r(A,{type:"redo",size:"20",color:"#007bff"}),r(E,{class:"dest_loc_no uni-ml-2"},{default:c((()=>[m(v(t["FDestStockLocId.FNumber"]),1)])),_:2},1024)],64)):g("",!0)])),_:2},1024),(null==(e=t.FBillNo)?void 0:e.trim())?(p(),k(B,{key:0},{default:c((()=>[m("单据："+v(t.FBillNo),1)])),_:2},1024)):g("",!0),(null==(a=t.FRemark)?void 0:a.trim())?(p(),k(B,{key:1},{default:c((()=>[m("备注："+v(t.FRemark),1)])),_:2},1024)):g("",!0)]})),_:2},1024)])),_:2},1024)])),footer:c((()=>[r(B,{class:"uni-list-item__foot"},{default:c((()=>[r(B,{class:"op_qty"},{default:c((()=>["mv"==t.FOpType?(p(),k(E,{key:0,class:"text-primary"},{default:c((()=>[m("移动 ")])),_:1})):g("",!0),"add"==t.FOpType?(p(),k(E,{key:1,class:"text-error"},{default:c((()=>[m("增加 ")])),_:1})):g("",!0),"sub"==t.FOpType?(p(),k(E,{key:2,class:"text-success"},{default:c((()=>[m("减少 ")])),_:1})):g("",!0),r(E,null,{default:c((()=>[m(v(t.FOpQTY)+" "+v(t["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024),r(E,{class:b(["status",t.disabled?"disabled":""])},{default:c((()=>[m(v(t.status),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick","onLongpress"])))),128))])),_:1}),0===i.inv_plans.length?(p(),k(Y,{key:0,status:"nomore"})):g("",!0)])),_:1}),r(B,{class:"uni-goods-nav-wrapper"},{default:c((()=>[r(Q,{options:i.goods_nav.options,"button-group":i.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64))}]]);export{P as default};
