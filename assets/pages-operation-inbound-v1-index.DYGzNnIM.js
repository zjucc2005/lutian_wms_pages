import{s as t,m as n,b as o,n as i,p as e,a as s,h as a,c as _,d as l,w as u,i as d,o as r,e as c,q as b,u as m,F as f,g as k,f as h,t as p,k as g}from"./index-DGWOUQdM.js";import{_ as y}from"./uni-datetime-picker.CztCdWST.js";import{r as v}from"./uni-app.es.DKZsoyMd.js";import{_ as x,a as j}from"./uni-forms.BvQoUrI-.js";import{_ as I}from"./uni-data-picker.yU0P1u9A.js";import{_ as C}from"./uni-easyinput.l7FUzy_X.js";import{_ as S}from"./uni-section.Dvy4SRsN.js";import{_ as T}from"./uni-icons.LDhtL0t0.js";import{_ as V}from"./uni-list-item.BnynrAPo.js";import{_ as B}from"./uni-list.Kn4QrsAX.js";import{_ as F}from"./uni-goods-nav.BwI3ErB8.js";import{K as q}from"./k3cloudapi.CbDqg_He.js";import{p as M}from"./index.JIux-90-.js";import{I as E}from"./inbound_task.DqmN0Qhk.js";import"./stock_loc.C36uFwb2.js";import"./inv_log.OihDyY2r.js";import{f as N}from"./date-format.Dm3Q97cL.js";import{s as w}from"./scan_code.CS8963f7.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-load-more.Dv1TB_Bm.js";import"./uni-badge._gn3hy42.js";const R=D({data:()=>({cur_stock:{},cur_inbound_task:{},inbound_task_form:{inbound_date:"",batch_no:"",bill_no:"",inbound_list:[]},inbound_task_form_rules:{inbound_date:{rules:[{required:!0,errorMessage:"入库日期不能为空"}]},batch_no:{rules:[{required:!0,errorMessage:"批次号不能为空"}]},bill_no:{rules:[{required:!0,errorMessage:"单据编号不能为空"}]}},batch_no_opts:[],goods_nav:{options:[{icon:"search",text:"查询"}],button_group:[{text:"扫码",backgroundColor:"linear-gradient(90deg, #FE6035, #EF1224)",color:"#fff"},{text:"新建入库任务",backgroundColor:"linear-gradient(90deg, #1E83FF, #0053B8)",color:"#fff"}],options_2:[{icon:"bars",text:"详情"}],button_group_2:[{text:"结束入库任务",backgroundColor:"linear-gradient(90deg, #AAA, #606266)",color:"#fff"},{text:"继续入库任务",backgroundColor:"linear-gradient(90deg, #1E83FF, #0053B8)",color:"#fff"}]}}),mounted(){this.cur_stock=t.state.cur_stock,this.cur_inbound_task=E.current()||{},this.cur_inbound_task.stock_id&&this.cur_inbound_task.stock_id!=t.state.cur_stock.FStockId&&n({title:"注意",content:"本机中有其他仓库的入库任务，不能操作，将终止此入库任务",showCancel:!1,success:t=>{t.confirm&&this.finish_inbound_task()}})},methods:{goods_nav_click(t){0===t.index&&(this.inbound_task_form.bill_no?(this.$logger.info(t.content.text,this.inbound_task_form.bill_no),this.get_inbound_list_by_bill_no()):o({icon:"none",title:"请输入单据编号"}))},goods_nav_button_click(t){0===t.index&&this.scan_code(),1===t.index&&this.create_inbound_task()},goods_nav_click_2(t){0===t.index&&i({url:"/pages/operation/inbound/v1/task"})},goods_nav_button_click_2(t){0===t.index&&this.if_finish_inbound_task(),1===t.index&&this.continue_inbound_task()},handle_inbound_date_change(t){var n;const o=[];if(t){const n=new Date(t);for(var i=0;i<3;i++){let t=N(n-864e5*i,"yyyyMMdd");o.push({text:t,value:t})}}this.inbound_task_form.batch_no=null==(n=o[0])?void 0:n.value,this.batch_no_opts=o},handle_bill_no_change(t){this.get_inbound_list_by_bill_no()},scan_code(){w().then((t=>{this.handle_scan_code(t.result)})).catch((t=>{o({icon:"none",title:t})}))},handle_scan_code(t){let n=t.split(/\|{2}|,|;/);1===n.length?(this.inbound_task_form.bill_no=n[0],this.get_inbound_list_by_bill_no()):e({title:"扫码结果",itemList:n,success:t=>{this.inbound_task_form.bill_no=n[t.tapIndex],this.get_inbound_list_by_bill_no()}})},get_inbound_list_by_bill_no(){const t=this.inbound_task_form.bill_no;t?t.startsWith("ZJDB")?(s({title:"Loading"}),q.view("STK_TransferDirect",{Number:t}).then((t=>{this.handle_zjdbd_data(t),a()}))):(this.inbound_task_form.inbound_list=[],o({icon:"none",title:"未找到单据信息"})):this.inbound_task_form.inbound_list=[]},handle_zjdbd_data(t){var n;if(t.data.Result.ResponseStatus.IsSuccess){const n=t.data.Result.Result;let o=[];n.TransferDirectEntry.forEach((t=>{var n,i,e,s,a;o.push({material_no:t.MaterialId.Number,material_name:null==(n=t.MaterialId.Name[0])?void 0:n.Value,material_spec:null==(i=t.MaterialId.Specification[0])?void 0:i.Value,base_unit_qty:t.BaseQty,base_unit_name:null==(e=t.BaseUnitId.Name[0])?void 0:e.Value,base_unit_no:t.BaseUnitId.Number,src_stock_id:t.SrcStockId.Id,src_stock_name:null==(s=t.SrcStockId.Name[0])?void 0:s.Value,dest_stock_id:t.DestStockId.Id,dest_stock_name:null==(a=t.DestStockId.Name[0])?void 0:a.Value})})),this.inbound_task_form.inbound_list=o}else this.inbound_task_form.inbound_list=[],o({icon:"none",title:null==(n=t.data.Result.ResponseStatus.Errors[0])?void 0:n.Message})},create_inbound_task(){this.$refs.inbound_task_form.validate().then((n=>{M("success");const o={stock_id:t.state.cur_stock.FStockId,inbound_date:this.inbound_task_form.inbound_date,batch_no:this.inbound_task_form.batch_no,bill_no:this.inbound_task_form.bill_no,inbound_list:this.inbound_task_form.inbound_list};let e=new E(o);e.save(),this.cur_inbound_task=e,i({url:"/pages/operation/inbound/v1/mount"})})).catch((t=>{}))},if_finish_inbound_task(){e({itemList:["结束入库任务"],success:t=>{0===t.tapIndex&&this.finish_inbound_task()}})},finish_inbound_task(){E.destroy_all(),this.cur_inbound_task={},this.inbound_task_form={inbound_date:"",batch_no:"",bill_no:"",inbound_list:[]}},continue_inbound_task(){M("success"),i({url:"/pages/operation/inbound/v1/mount"})}}},[["render",function(t,n,o,i,e,s){const a=v(_("uni-datetime-picker"),y),q=v(_("uni-forms-item"),x),M=v(_("uni-data-picker"),I),E=v(_("uni-easyinput"),C),N=v(_("uni-forms"),j),w=d,D=v(_("uni-section"),S),R=g,U=v(_("uni-icons"),T),A=v(_("uni-list-item"),V),z=v(_("uni-list"),B),K=v(_("uni-goods-nav"),F);return e.cur_inbound_task.inbound_date?(r(),l(w,{key:1},{default:u((()=>[c(D,{title:"进行中的入库任务",type:"line"},{default:u((()=>[c(z,null,{default:u((()=>[c(A,{title:"入库日期",rightText:e.cur_inbound_task.inbound_date},null,8,["rightText"]),c(A,{title:"批次号",rightText:e.cur_inbound_task.batch_no},null,8,["rightText"]),c(A,{title:"单据编号",rightText:e.cur_inbound_task.bill_no},null,8,["rightText"])])),_:1})])),_:1}),e.cur_inbound_task.inbound_list.length?(r(),l(D,{key:0,title:"入库物料信息",type:"line",style:{"padding-bottom":"60px"}},{default:u((()=>[c(z,null,{default:u((()=>[(r(!0),b(f,null,m(e.cur_inbound_task.inbound_list,((t,n)=>(r(),l(A,{key:n,rightText:[t.base_unit_qty,t.base_unit_name].join(" "),disabled:t.dest_stock_id!=e.cur_stock.FStockId},{body:u((()=>[c(w,{class:"uni-list-item__content uni-list-item__content--center"},{default:u((()=>[c(R,{class:"uni-list-item__content-title"},{default:u((()=>[h(p(t.material_no),1)])),_:2},1024),c(w,{class:"uni-list-item__content-note"},{default:u((()=>[c(w,null,{default:u((()=>[h(p(t.material_name),1)])),_:2},1024),c(w,null,{default:u((()=>[h(p(t.material_spec),1)])),_:2},1024),c(w,null,{default:u((()=>[c(U,{type:"home",color:"#999"}),c(R,{class:"src-stock"},{default:u((()=>[h(p(t.src_stock_name),1)])),_:2},1024),c(U,{type:"redo",color:"#007bff",style:{margin:"0 5px"}}),c(U,{type:"home",color:"#007bff"}),c(R,{class:"dest-stock"},{default:u((()=>[h(p(t.dest_stock_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["rightText","disabled"])))),128))])),_:1})])),_:1})):k("",!0),c(w,{class:"uni-goods-nav-wrapper"},{default:u((()=>[c(K,{options:e.goods_nav.options_2,"button-group":e.goods_nav.button_group_2,onClick:s.goods_nav_click_2,onButtonClick:s.goods_nav_button_click_2},null,8,["options","button-group","onClick","onButtonClick"])])),_:1})])),_:1})):(r(),l(w,{key:0},{default:u((()=>[c(D,{title:"入库设定",type:"line"},{default:u((()=>[c(w,{class:"container"},{default:u((()=>[c(N,{ref:"inbound_task_form",model:e.inbound_task_form,rules:e.inbound_task_form_rules,labelWidth:"80px"},{default:u((()=>[c(q,{label:"入库日期",name:"inbound_date",required:""},{default:u((()=>[c(a,{modelValue:e.inbound_task_form.inbound_date,"onUpdate:modelValue":n[0]||(n[0]=t=>e.inbound_task_form.inbound_date=t),type:"date","return-type":"string",onChange:s.handle_inbound_date_change},null,8,["modelValue","onChange"])])),_:1}),c(q,{label:"批次号",name:"batch_no",required:""},{default:u((()=>[c(M,{modelValue:e.inbound_task_form.batch_no,"onUpdate:modelValue":n[1]||(n[1]=t=>e.inbound_task_form.batch_no=t),localdata:e.batch_no_opts,"popup-title":e.inbound_task_form.inbound_date?"请选择":"请先选择入库日期"},null,8,["modelValue","localdata","popup-title"])])),_:1}),c(q,{label:"单据编号",name:"bill_no",required:""},{default:u((()=>[c(E,{modelValue:e.inbound_task_form.bill_no,"onUpdate:modelValue":n[2]||(n[2]=t=>e.inbound_task_form.bill_no=t),onChange:s.handle_bill_no_change,onClear:s.handle_bill_no_change,prefixIcon:"search",trim:"both"},null,8,["modelValue","onChange","onClear"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1}),e.inbound_task_form.inbound_list.length?(r(),l(D,{key:0,title:"入库物料信息",type:"line",style:{"padding-bottom":"60px"}},{default:u((()=>[c(z,null,{default:u((()=>[(r(!0),b(f,null,m(e.inbound_task_form.inbound_list,((t,n)=>(r(),l(A,{key:n,rightText:[t.base_unit_qty,t.base_unit_name].join(" "),disabled:t.dest_stock_id!=e.cur_stock.FStockId},{body:u((()=>[c(w,{class:"uni-list-item__content uni-list-item__content--center"},{default:u((()=>[c(R,{class:"uni-list-item__content-title"},{default:u((()=>[h(p(t.material_no),1)])),_:2},1024),c(w,{class:"uni-list-item__content-note"},{default:u((()=>[c(w,null,{default:u((()=>[h(p(t.material_name),1)])),_:2},1024),c(w,null,{default:u((()=>[h(p(t.material_spec),1)])),_:2},1024),c(w,null,{default:u((()=>[c(U,{type:"home",color:"#999"}),c(R,{class:"src-stock"},{default:u((()=>[h(p(t.src_stock_name),1)])),_:2},1024),c(U,{type:"redo",color:"#007bff",style:{margin:"0 5px"}}),c(U,{type:"home",color:"#007bff"}),c(R,{class:"dest-stock"},{default:u((()=>[h(p(t.dest_stock_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["rightText","disabled"])))),128))])),_:1})])),_:1})):k("",!0),c(w,{class:"uni-goods-nav-wrapper"},{default:u((()=>[c(K,{options:e.goods_nav.options,"button-group":e.goods_nav.button_group,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_button_click},null,8,["options","button-group","onClick","onButtonClick"])])),_:1})])),_:1}))}],["__scopeId","data-v-60ae0756"]]);export{R as default};
