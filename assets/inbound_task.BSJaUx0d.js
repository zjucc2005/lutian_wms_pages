import{x as t,J as i,H as s,s as a}from"./index-MIvYX1nW.js";import{f as n}from"./date-format.Dm3Q97cL.js";class _{constructor(t={}){this.created_at=t.created_at||Date.now(),this.stock_id=t.stock_id,this.stock_name=t.stock_name,this.staff_no=t.staff_no,this.inbound_date=t.inbound_date,this.category=t.category||"bill",this.status=t.status||"init",this.batch_no=t.batch_no||n(this.created_at,"yyyyMMdd"),this.bill_no=t.bill_no,this.inbound_list=t.inbound_list||[],this.pallet_infos=t.pallet_infos||[]}static current(){return t("cur_inbound_task")}static destroy_all(){i("cur_inbound_task")}save(){return s("cur_inbound_task",this),this}destroy(){return i("cur_inbound_task"),null}update(t={}){return Object.getOwnPropertyNames(t).forEach((i=>{this[i]=t[i]})),this.save()}is_cur_depot(){return a.state.cur_depot.FStockId===this.stock_id}add_inbound_list(t){return t._id=a.state.snowflake.next_id(),t.dest_stock_id=this.stock_id,t.dest_stock_name=this.stock_name,t.batch_no=this.batch_no,this.inbound_list.push(t),this.save()}del_inbound_list(t){let i=this.inbound_list.findIndex((i=>i._id==t));return this.inbound_list.splice(i,1),this.save()}add_pallet_info(t){t._id=a.state.snowflake.next_id(),this.pallet_infos.unshift(t);let i=this.inbound_list.find((i=>i.material_id==t.material_id));return i?i.base_unit_qty+=t.base_unit_qty:this.inbound_list.push({material_id:t.material_id,material_no:t.material_no,material_name:t.material_name,material_spec:t.material_spec,base_unit_qty:t.base_unit_qty,base_unit_name:t.base_unit_name,dest_stock_id:this.stock_id,dest_stock_name:this.stock_name,batch_no:this.batch_no}),this.save()}del_pallet_info(t){let i=this.pallet_infos.findIndex((i=>i._id==t)),s=this.pallet_infos[i],a=this.inbound_list.find((t=>t.material_no==s.material_no));if(a.base_unit_qty-=s.base_unit_qty,a.base_unit_qty<=0){let t=this.inbound_list.findIndex((t=>t.material_no==s.material_no));this.inbound_list.splice(t,1)}return this.pallet_infos.splice(i,1),this.save()}}export{_ as I};
