var e,a=Object.defineProperty;import{P as t,v as l,c as r,q as i,d as o,w as s,e as d,F as n,o as _,f as u,u as m,C as c,i as f,t as p,g as h,k as F,Q as g}from"./index-MIvYX1nW.js";import{_ as y,a as b,b as I}from"./uni-td.B3Sq6FHr.js";import{r as N}from"./uni-app.es.B8zr0lZI.js";import{_ as w}from"./uni-table.CMkDOYII.js";import{_ as v}from"./uni-list-item.Dk-snU2X.js";import{_ as D}from"./uni-list.zX7C8YBn.js";import{_ as M}from"./uni-load-more.5aGCwx5G.js";import{_ as j}from"./uni-fab.CC_INFyt.js";import{_ as k}from"./uni-easyinput.BboSH9MB.js";import{_ as x,a as V}from"./uni-forms.C-YkALHf.js";import{_ as R,a as S}from"./uni-row.Cx_kdH4q.js";import{_ as P,a as Q}from"./uni-popup.j9WTBudP.js";import{t as B}from"./index.DbF5UMRK.js";import{K as U}from"./k3cloudapi.DzDu3BGl.js";import"./stock_loc.BckAHwoS.js";import"./inv_log.BJcJnepW.js";import{f as C}from"./date-format.Dm3Q97cL.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-datetime-picker.D11eskE5.js";import"./uni-icons.DEYikQDp.js";import"./uni-badge.DDwx_b0i.js";class ${constructor(){}static async update(e,a={}){const t={model:{FID:e,...a}};return U.save(this.form_id,t)}static async query(e={},a={}){const t={FormId:this.form_id,FieldKeys:["FID","FBillNo","FSupplierId","FSupplierId.FName","FDemandBillNo","FMaterialId","FMaterialId.FNumber","FMaterialId.FName","FMaterialId.FSpecification","FQty","FRemainReceiveQty","FUnitId","FUnitId.FName","FDate","FDeliveryDate","FPurchaserId","FPurchaserId.FName"].join(","),FilterString:U.query_filter(e)};return a.per_page&&(t.Limit=a.per_page,a.page&&(t.StartRow=(a.page-1)*a.per_page)),a.order&&(t.OrderString=a.order),U.bill_query(t)}static async find(e){return this.query({FID:e},{limit:1})}static async view(e){return"number"==typeof e?U.view(this.form_id,{Id:e}):U.view(this.form_id,{Number:e})}}((e,t,l)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l})($,"symbol"!=typeof(e="form_id")?e+"":e,"PUR_PurchaseOrder");const L=q({data:()=>({purchase_orders:[],search_form:{demand_bill_no:"",demander:"",supplier:"",material_no:"",material_name:"",material_spec:""},page:1,per_page:100,load_more_status:"more",fab_content:[{iconPath:"/static/icon/cc_search.png",selectedIconPath:"/static/icon/cc_search_active.png",text:"搜索",active:!1},{iconPath:"/static/icon/cc_gotop.png",selectedIconPath:"/static/icon/cc_gotop_active.png",text:"返回顶部",active:!1}]}),onPullDownRefresh(){this.reload_purchase_orders(),t()},onReachBottom(){this.load_more()},mounted(){this.load_purchase_orders()},methods:{truncate:B,formatDate:C,async load_purchase_orders(){let e={},a={page:this.page,per_page:this.per_page,order:"FID DESC"};this.search_form.demand_bill_no&&(e.FDemandBillNo_lk=this.search_form.demand_bill_no),this.search_form.demander&&(e["FRequireStaffId.FName_lk"]=this.search_form.demander),this.search_form.supplier&&(e["FSupplierId.FName_lk"]=this.search_form.supplier),this.search_form.material_no&&(e["FMaterialId.FNumber_lk"]=this.search_form.material_no),this.search_form.material_name&&(e["FMaterialId.FName_lk"]=this.search_form.material_name),this.search_form.material_spec&&(e["FMaterialId.FSpecification_lk"]=this.search_form.material_spec),this.load_more_status="loading",$.query(e,a).then((e=>{this.load_more_status=e.data.length<this.per_page?"nomore":"more",e.data.forEach((e=>this.purchase_orders.push(e)))}))},reload_purchase_orders(){this.purchase_orders=[],this.load_more_status="more",this.page=1,this.load_purchase_orders()},fab_trigger(e){0===e.index&&this.$refs.search_dialog.open(),1===e.index&&l({scrollTop:0})},load_more(){"nomore"!=this.load_more_status&&(this.page+=1,this.load_purchase_orders())},search_dialog_close(){this.$refs.search_dialog.close()},search_dialog_confirm(){this.reload_purchase_orders(),this.search_dialog_close()},_calc_percentage:e=>100*(e.FQty-e.FRemainReceiveQty)/e.FQty}},[["render",function(e,a,t,l,B,U){const C=N(r("uni-th"),y),q=N(r("uni-tr"),b),$=N(r("uni-td"),I),L=N(r("uni-table"),w),O=f,T=F,E=g,K=N(r("uni-list-item"),v),W=N(r("uni-list"),D),A=N(r("uni-load-more"),M),G=N(r("uni-fab"),j),J=N(r("uni-easyinput"),k),z=N(r("uni-forms-item"),x),H=N(r("uni-col"),R),X=N(r("uni-row"),S),Y=N(r("uni-forms"),V),Z=N(r("uni-popup-dialog"),P),ee=N(r("uni-popup"),Q);return _(),i(n,null,["h5"===e.$store.state.screen_type?(_(),o(L,{key:0,ref:"table",border:"",stripe:""},{default:s((()=>[d(q,null,{default:s((()=>[d(C,{align:"center",width:"120"},{default:s((()=>[u("单据编号")])),_:1}),d(C,{align:"center",width:"150"},{default:s((()=>[u("供应商")])),_:1}),d(C,{align:"center",width:"120"},{default:s((()=>[u("需求单据编号")])),_:1}),d(C,{align:"center",width:"160"},{default:s((()=>[u("物料编码")])),_:1}),d(C,{align:"center",width:"200"},{default:s((()=>[u("物料名称")])),_:1}),d(C,{align:"center"},{default:s((()=>[u("规格型号")])),_:1}),d(C,{align:"center",width:"80"},{default:s((()=>[u("采购数量")])),_:1}),d(C,{align:"center",width:"80"},{default:s((()=>[u("剩余收料数量")])),_:1}),d(C,{align:"center",width:"96"},{default:s((()=>[u("采购日期")])),_:1}),d(C,{align:"center",width:"96"},{default:s((()=>[u("交货日期")])),_:1}),d(C,{align:"center",width:"80"},{default:s((()=>[u("采购员")])),_:1})])),_:1}),(_(!0),i(n,null,m(B.purchase_orders,((e,a)=>(_(),o(q,{key:a},{default:s((()=>[a>0&&e.FBillNo==B.purchase_orders[a-1].FBillNo?(_(),o($,{key:0})):(_(),o($,{key:1},{default:s((()=>[u(p(e.FBillNo),1)])),_:2},1024)),d($,{title:e["FSupplierId.FName"]},{default:s((()=>[u(p(U.truncate(e["FSupplierId.FName"],8)),1)])),_:2},1032,["title"]),d($,null,{default:s((()=>[u(p(e.FDemandBillNo),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(e["FMaterialId.FNumber"]),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(e["FMaterialId.FName"]),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(e["FMaterialId.FSpecification"]),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(e.FQty),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(e.FRemainReceiveQty),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(U.formatDate(e.FDate,"yyyy-MM-dd")),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(U.formatDate(e.FDeliveryDate,"yyyy-MM-dd")),1)])),_:2},1024),d($,null,{default:s((()=>[u(p(e["FPurchaserId.FName"]),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)):(_(),o(W,{key:1},{default:s((()=>[(_(!0),i(n,null,m(B.purchase_orders,((e,a)=>(_(),o(K,{key:a},{body:s((()=>[d(O,{class:"uni-list-item__body"},{default:s((()=>[d(O,{class:"title"},{default:s((()=>[u(p(e.FBillNo)+" / "+p(e.FDemandBillNo),1)])),_:2},1024),d(O,{class:"note"},{default:s((()=>[d(O,null,{default:s((()=>[u("供应商："+p(e["FSupplierId.FName"]),1)])),_:2},1024),d(O,null,{default:s((()=>[u("编码："+p(e["FMaterialId.FNumber"]),1)])),_:2},1024),d(O,null,{default:s((()=>[u("名称："+p(e["FMaterialId.FName"]),1)])),_:2},1024),d(O,null,{default:s((()=>[u("规格："+p(e["FMaterialId.FSpecification"]),1)])),_:2},1024),d(O,null,{default:s((()=>[u("采购日期："+p(U.formatDate(e.FDate,"yyyy-MM-dd")),1)])),_:2},1024),d(O,null,{default:s((()=>[u("交货日期："+p(U.formatDate(e.FDeliveryDate,"yyyy-MM-dd")),1)])),_:2},1024),d(O,null,{default:s((()=>[u("采购员："+p(e["FPurchaserId.FName"]),1)])),_:2},1024),e.FRemainReceiveQty>0?(_(),o(O,{key:0},{default:s((()=>[u("剩余收料数量："),d(T,{class:"text-primary"},{default:s((()=>[u(p(e.FRemainReceiveQty),1)])),_:2},1024)])),_:2},1024)):h("",!0)])),_:2},1024)])),_:2},1024)])),footer:s((()=>[d(O,{class:"uni-list-item__foot"},{default:s((()=>[d(O,null,{default:s((()=>[u(p(e.FQty),1)])),_:2},1024),d(E,{percent:U._calc_percentage(e),"stroke-width":"2","active-color":U._calc_percentage(e)>=100?"#4cd964":"#f0ad4e"},null,8,["percent","active-color"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})),d(A,{status:B.load_more_status,onClickLoadMore:U.load_more},null,8,["status","onClickLoadMore"]),d(G,{ref:"fab",content:B.fab_content,onTrigger:U.fab_trigger,show:""},null,8,["content","onTrigger"]),d(ee,{ref:"search_dialog",type:"dialog"},{default:s((()=>[d(Z,{type:"info",title:"搜索条件",cancelText:"关闭",onClose:U.search_dialog_close,onConfirm:U.search_dialog_confirm,"before-close":!0,style:c({width:e.$store.state.system_info.windowWidth-20+"px",minWidth:"360px",maxWidth:"1200px"})},{default:s((()=>[d(O,{class:"search-form"},{default:s((()=>[d(Y,{ref:"search_form",model:B.search_form,"label-width":100},{default:s((()=>[d(X,{gutter:15},{default:s((()=>[d(H,{md:8,sm:12,xs:24},{default:s((()=>[d(z,{label:"需求单据编号"},{default:s((()=>[d(J,{modelValue:B.search_form.demand_bill_no,"onUpdate:modelValue":a[0]||(a[0]=e=>B.search_form.demand_bill_no=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(H,{md:8,sm:12,xs:24},{default:s((()=>[d(z,{label:"需求人"},{default:s((()=>[d(J,{modelValue:B.search_form.demander,"onUpdate:modelValue":a[1]||(a[1]=e=>B.search_form.demander=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(H,{md:8,sm:12,xs:24},{default:s((()=>[d(z,{label:"供应商"},{default:s((()=>[d(J,{modelValue:B.search_form.supplier,"onUpdate:modelValue":a[2]||(a[2]=e=>B.search_form.supplier=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(H,{md:8,sm:12,xs:24},{default:s((()=>[d(z,{label:"物料编码"},{default:s((()=>[d(J,{modelValue:B.search_form.material_no,"onUpdate:modelValue":a[3]||(a[3]=e=>B.search_form.material_no=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(H,{md:8,sm:12,xs:24},{default:s((()=>[d(z,{label:"物料名称"},{default:s((()=>[d(J,{modelValue:B.search_form.material_name,"onUpdate:modelValue":a[4]||(a[4]=e=>B.search_form.material_name=e)},null,8,["modelValue"])])),_:1})])),_:1}),d(H,{md:8,sm:12,xs:24},{default:s((()=>[d(z,{label:"规格型号"},{default:s((()=>[d(J,{modelValue:B.search_form.material_spec,"onUpdate:modelValue":a[5]||(a[5]=e=>B.search_form.material_spec=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["onClose","onConfirm","style"])])),_:1},512)],64)}],["__scopeId","data-v-1ec34a9b"]]);export{L as default};
