import{P as e,v as a,b as t,a as o,h as s,c as r,q as i,e as l,w as _,F as c,o as m,u as n,d,g as u,i as h,f as p,t as f,k as g}from"./index-DsK9pIyj.js";import{_ as y}from"./uni-list-item.BkmqxiQh.js";import{r as F}from"./uni-app.es.CSK8ITuj.js";import{_ as b}from"./uni-list.dJf-6p1_.js";import{_ as k}from"./uni-load-more.CyJx3ZKG.js";import{_ as j}from"./uni-fab.b1ZtjMUn.js";import{_ as v}from"./uni-datetime-picker.Bsu03if5.js";import{_ as x,a as V}from"./uni-forms.DoSYlyoS.js";import{_ as T}from"./uni-easyinput.BfazFYzq.js";import{_ as I,a as C}from"./uni-popup.CPWlX1tX.js";import{_ as M}from"./qiun-data-charts.CgqeEOUR.js";import{f as N}from"./date-format.Dm3Q97cL.js";import"./k3cloudapi.PCDjx1SF.js";import"./stock_loc.Bj3C3Byx.js";import"./inv_log.D0BShjlW.js";import{I as O}from"./issuemtr_log.Bkb3IULO.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DRoE6XYp.js";import"./uni-badge.CO78OwkC.js";const P=B({data:()=>({category:"search",issuemtr_logs:[],search_form:{create_time_ge:"",create_time_le:"",material_no:"",material_name:"",material_spec:"",batch_no:""},page:1,per_page:20,load_more_status:"more",op_type_dict:O.FOpTypeEnum,fab_content:[{iconPath:"/static/icon/cc_search.png",selectedIconPath:"/static/icon/cc_search_active.png",text:"搜索",active:!1},{iconPath:"/static/icon/cc_barchart.png",selectedIconPath:"/static/icon/cc_barchart_active.png",text:"统计",active:!1},{iconPath:"/static/icon/cc_gotop.png",selectedIconPath:"/static/icon/cc_gotop_active.png",text:"返回顶部",active:!1}],chart_opts:{color:["#1890FF","#EE6666"],padding:[25,25,0,25],extra:{column:{type:"group",width:36,activeBgColor:"#000000",activeBgOpacity:.08,seriesGap:5,barBorderRadius:[5,5,5,5]}}},chart_data:{}}),onPullDownRefresh(){this.reload_issuemtr_logs(),e()},onReachBottom(){this.load_more()},mounted(){this.load_issuemtr_logs()},methods:{formatDate:N,fab_trigger(e){0===e.index&&(this.category="search",this.$refs.search_dialog.open()),1===e.index&&(this.category="statistic",this.$refs.search_dialog.open()),2===e.index&&a({scrollTop:0})},load_more(){"nomore"!=this.load_more_status&&(this.page+=1,this.load_issuemtr_logs())},reload_issuemtr_logs(){this.issuemtr_logs=[],this.load_more_status="more",this.page=1,this.load_issuemtr_logs()},search_dialog_close(){this.$refs.search_dialog.close()},search_dialog_confirm(){"search"==this.category&&(this.reload_issuemtr_logs(),this.search_dialog_close()),"statistic"==this.category&&(this.search_form.material_no&&this.search_form.batch_no?(this.summarize_logs(),this.search_dialog_close()):t({icon:"none",title:"物料和批次必需"}))},async load_issuemtr_logs(){let e={FOpType_in:["send","receive"]};this.search_form.create_time_ge&&(e.FCreateTime_ge=this.search_form.create_time_ge),this.search_form.create_time_le&&(e.FCreateTime_le=this.search_form.create_time_le),this.search_form.material_no&&(e["FMaterialId.FNumber_lk"]=this.search_form.material_no),this.search_form.material_name&&(e.FMaterialName_lk=this.search_form.material_name),this.search_form.material_spec&&(e.FModel_lk=this.search_form.material_spec),this.search_form.bill_no&&(e.FBillNo=this.search_form.bill_no);let a={page:this.page,per_page:this.per_page,order:"FID DESC"};this.load_more_status="loading",O.query(e,a).then((e=>{this.load_more_status=e.data.length<this.per_page?"nomore":"more",e.data.forEach((e=>this.issuemtr_logs.push(e)))}))},async summarize_logs(){let e={FOpType_in:["send","receive"],"FMaterialId.FNumber":this.search_form.material_no,FBatchNo:this.search_form.batch_no};o({title:"Loading"});let a=await O.summary(e);if(s(),0===a.length)return void t({icon:"none",title:"无相关数据"});let r={categories:[[this.search_form.material_no,this.search_form.batch_no].join(" / ")],series:[]},i=0,l=0;for(let t of a)"send"==t[0]&&(i+=t[1]),"receive"==t[0]&&(l+=t[1]);r.series.push({name:"发料",data:[i]}),r.series.push({name:"用料",data:[l]}),this.chart_data=r,this.$refs.summary_dialog.open()}}},[["render",function(e,a,t,o,s,N){const O=h,B=g,P=F(r("uni-list-item"),y),w=F(r("uni-list"),b),U=F(r("uni-load-more"),k),D=F(r("uni-fab"),j),q=F(r("uni-datetime-picker"),v),E=F(r("uni-forms-item"),x),R=F(r("uni-easyinput"),T),S=F(r("uni-forms"),V),$=F(r("uni-popup-dialog"),I),z=F(r("uni-popup"),C),L=F(r("qiun-data-charts"),M);return m(),i(c,null,[l(w,null,{default:_((()=>[(m(!0),i(c,null,n(s.issuemtr_logs,((e,a)=>(m(),d(P,{key:a},{body:_((()=>[l(O,{class:"uni-list-item__body"},{default:_((()=>[l(O,{class:"title"},{default:_((()=>[p(f(e["FMaterialId.FNumber"]),1)])),_:2},1024),l(O,{class:"note"},{default:_((()=>{var a,t;return[l(O,null,{default:_((()=>[p("名称："+f(e["FMaterialId.FName"]),1)])),_:2},1024),l(O,null,{default:_((()=>[p("规格："+f(e["FMaterialId.FSpecification"]),1)])),_:2},1024),l(O,null,{default:_((()=>[p("供应商："),l(B,{class:"text-primary"},{default:_((()=>[p(f(e["FSupplierId.FName"]),1)])),_:2},1024)])),_:2},1024),l(O,null,{default:_((()=>[p("批次："),l(B,{class:"text-primary"},{default:_((()=>[p(f(e.FBatchNo),1)])),_:2},1024)])),_:2},1024),(null==(a=e.FBillNo)?void 0:a.trim())?(m(),d(O,{key:0},{default:_((()=>[p("单据："),l(B,{class:"text-primary"},{default:_((()=>[p(f(e.FBillNo),1)])),_:2},1024)])),_:2},1024)):u("",!0),(null==(t=e.FRemark)?void 0:t.trim())?(m(),d(O,{key:1},{default:_((()=>[p("备注："+f(e.FRemark),1)])),_:2},1024)):u("",!0),l(O,null,{default:_((()=>[p("时间："+f(N.formatDate(e.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024)]})),_:2},1024)])),_:2},1024)])),footer:_((()=>[l(O,{class:"uni-list-item__foot"},{default:_((()=>["send"==e.FOpType?(m(),d(O,{key:0,class:"text-primary"},{default:_((()=>[p(f(s.op_type_dict[e.FOpType]),1)])),_:2},1024)):u("",!0),"receive"==e.FOpType?(m(),d(O,{key:1,class:"text-error"},{default:_((()=>[p(f(s.op_type_dict[e.FOpType]),1)])),_:2},1024)):u("",!0),l(O,null,{default:_((()=>[p(f(e.FOpQTY)+" "+f(e["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),l(U,{status:s.load_more_status,onClickLoadMore:N.load_more},null,8,["status","onClickLoadMore"]),l(D,{ref:"fab",content:s.fab_content,onTrigger:N.fab_trigger,show:""},null,8,["content","onTrigger"]),l(z,{ref:"search_dialog",type:"dialog"},{default:_((()=>[l($,{type:"info",title:"statistic"==s.category?"统计条件":"搜索条件",cancelText:"关闭",onClose:N.search_dialog_close,onConfirm:N.search_dialog_confirm,"before-close":!0,style:{width:"360px"}},{default:_((()=>[l(O,{class:"search-form"},{default:_((()=>[l(S,{ref:"search_form",model:s.search_form},{default:_((()=>["search"==s.category?(m(),d(E,{key:0,label:"开始时间"},{default:_((()=>[l(q,{type:"date",modelValue:s.search_form.create_time_ge,"onUpdate:modelValue":a[0]||(a[0]=e=>s.search_form.create_time_ge=e)},null,8,["modelValue"])])),_:1})):u("",!0),"search"==s.category?(m(),d(E,{key:1,label:"结束时间"},{default:_((()=>[l(q,{type:"date",modelValue:s.search_form.create_time_le,"onUpdate:modelValue":a[1]||(a[1]=e=>s.search_form.create_time_le=e)},null,8,["modelValue"])])),_:1})):u("",!0),l(E,{label:"物料编码"},{default:_((()=>[l(R,{modelValue:s.search_form.material_no,"onUpdate:modelValue":a[2]||(a[2]=e=>s.search_form.material_no=e)},null,8,["modelValue"])])),_:1}),"search"==s.category?(m(),d(E,{key:2,label:"名称"},{default:_((()=>[l(R,{modelValue:s.search_form.material_name,"onUpdate:modelValue":a[3]||(a[3]=e=>s.search_form.material_name=e)},null,8,["modelValue"])])),_:1})):u("",!0),"search"==s.category?(m(),d(E,{key:3,label:"规格"},{default:_((()=>[l(R,{modelValue:s.search_form.material_spec,"onUpdate:modelValue":a[4]||(a[4]=e=>s.search_form.material_spec=e)},null,8,["modelValue"])])),_:1})):u("",!0),l(E,{label:"批次"},{default:_((()=>[l(R,{modelValue:s.search_form.batch_no,"onUpdate:modelValue":a[5]||(a[5]=e=>s.search_form.batch_no=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["title","onClose","onConfirm"])])),_:1},512),l(z,{ref:"summary_dialog",type:"dialog"},{default:_((()=>[l($,{type:"info",title:"统计结果",cancelText:"关闭",style:{width:"360px"}},{default:_((()=>[l(O,{style:{width:"100%"}},{default:_((()=>[l(L,{type:"column",opts:s.chart_opts,"chart-data":s.chart_data,ontouch:""},null,8,["opts","chart-data"])])),_:1})])),_:1})])),_:1},512)],64)}],["__scopeId","data-v-9537431a"]]);export{P as default};
