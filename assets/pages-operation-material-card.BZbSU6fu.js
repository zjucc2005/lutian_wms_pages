import{o as e,d as t,w as s,D as a,e as o,k as i,i as n,s as r,a as l,aC as d,h as c,b as p,c as h,q as m,a8 as _,F as u,T as g,L as w,C as f,u as x,g as y,f as v,t as b,j as k}from"./index-CqdXm0r7.js";import{_ as $}from"./uqrcode.DMCJt9H3.js";import{r as j}from"./uni-app.es.D0fJ2kcT.js";import{_ as z,a as I}from"./uni-row.BfdpflW5.js";import R from"./node_modules-html2canvas-dist-html2canvas.esm.DAJZ3LwS.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as C}from"./uni-goods-nav.CDNwxccE.js";import"./k3cloudapi.BjBFa2ll.js";import"./uni-icons.KMw0mbbD.js";const q={data:()=>({domIdValue:""}),methods:{async renderDom(){try{const e=document.getElementById(this.domIdValue);if(!e)return void console.error("dom盒子未加载成功，请先确保dom渲染完成，再检查你的domId是否有误");const t=(await R(e,{width:e.offsetWidth,height:e.offsetHeight,x:0,y:0,logging:!0,useCORS:!0,scale:2})).toDataURL("image/png",1);this.$ownerInstance.callMethod("renderOver",t)}catch(e){console.log("==== err :",e.message)}},watchDomId(e,t,s,a){this.domIdValue=e},watchExpOver(e,t,s,a){0!==e&&this.renderDom()}}},D=e=>{e.$renderjs||(e.$renderjs=[]),e.$renderjs.push("h2cRender"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.h2cRender=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),e.mixins.push(q)},L={props:{domId:{type:String,default:"",require:!0}},data:()=>({expOver:0}),methods:{renderOver(e){this.$emit("renderOver",e)},h2cRenderDom(){this.renderDom()}}};D(L);const S=O(L,[["render",function(r,l,d,c,p,h){const m=i,_=n;return e(),t(_,{class:"sp-html2canvas-render",prop:d.domId,"change:prop":r.h2cRender.watchDomId},{default:s((()=>[a(r.$slots,"default",{},void 0,!0),o(m,{prop:p.expOver,"change:prop":r.h2cRender.watchExpOver},null,8,["prop","change:prop"])])),_:3},8,["prop","change:prop"])}],["__scopeId","data-v-93b54c80"]]);const U=O({data:()=>({category:"wlzlk",op_type:"export",bd_material:{},image_urls:[],card_template:{id:"",class:"",style:{},rows:[]},window_height:1920,window_width:1080,goods_nav:{options:[],button_group:[{text:"导出图片",color:"#fff",backgroundColor:r.state.goods_nav_color.green}]}}),onLoad(e){this.getOpenerEventChannel().on("sendMaterial",(e=>{this.$logger.info("eventChannel.on sendMaterial",e),this.bd_material=e.bd_material,this.image_urls=e.image_urls,this.set_wlzlk_template(this.bd_material)}))},mounted(){this.goods_nav.button_group.push({text:"导出图片并打印",color:"#fff",backgroundColor:r.state.goods_nav_color.blue})},methods:{compatible_url:async e=>e,goods_nav_click(e){},goods_nav_button_click(e){0===e.index&&(this.op_type="export",l({title:"渲染图片文件"}),this.$refs.pdf_render.h2cRenderDom()),1===e.index&&(this.op_type="print",l({title:"渲染图片文件"}),this.$refs.pdf_render.h2cRenderDom())},async set_wlzlk_template(e){var t;this.card_template.id=this.category,this.card_template.class="card-default",this.card_template.style={width:this.window_width+"px",height:this.window_width/1.414+"px"};let s=[];s.push({cols:[{span:24,image:{url:await this.compatible_url("/static/image/wlzlk_header.png"),style:{width:this.window_width+"px",height:540*this.window_width/3508+"px"}}}]}),s.push({class:"wlzlk-row",cols:[{span:6,text:{text:"物料代码"}},{span:18,text:{text:e.Number}}]}),s.push({class:"wlzlk-row",cols:[{span:6,text:{text:"物料名称"}},{span:18,text:{text:e.Name[0].Value}}]}),s.push({class:"wlzlk-row",cols:[{span:6,text:{text:"物料型号"}},{span:18,text:{text:e.Specification[0].Value.trim()},style:{fontSize:e.Specification[0].Value.trim().length>33?"20px":""}}]}),s.push({class:"wlzlk-row",cols:[{span:6,text:{text:"标准装箱量"}},{span:18,text:{text:e.MaterialStock[0].BoxStandardQty}}]}),s.push({cols:[{span:6,style:{height:.25*this.window_width+"px"},text:{text:"参考图"}},{span:12,style:{height:.25*this.window_width+"px"},image:{url:null==(t=this.image_urls[0])?void 0:t.original,style:{width:.5*this.window_width+"px",height:.25*this.window_width+"px"}}},{span:6,style:{height:.25*this.window_width+"px"},style:{padding:"5px"},qrcode:{ref:"qrcode",id:"qrcode",value:e.Number,size:.24*this.window_width}}]}),s.push({cols:[{span:24,image:{url:await this.compatible_url("/static/image/card_footer.png"),style:{width:this.window_width+"px",height:125*this.window_width/1790+"px"}}}]}),this.card_template.rows=s},render_over(e){let t=`${this.category}_${Date.now()}`;"export"==this.op_type&&this.save_base64_data_h5(e,t),"print"==this.op_type&&this.print_base64_data_h5(e)},save_base64_data_app_plus(e,t){l({title:"正在保存文件"});const s=new plus.nativeObj.Bitmap("base64");s.loadBase64Data(e,(()=>{let a=e.split(",")[0].match(/:image\/(.*?);/)[1],o=`${t}.${a}`;s.save(o,{overwrite:!0},(e=>{d({filePath:o,success:()=>{this.$logger.info(">>> APP-PLUS图片保存成功"),c(),p({title:"已保存到相册"}),s.clear()}})}),(e=>{this.$logger.info(">>> APP-PLUS图片保存失败"),s.clear()}))}))},save_base64_data_h5(e,t){l({title:"正在保存文件"});let s=e.split(","),a=s[0].match(/:(.*?);/)[1],o=atob(s[1]),i=o.length,n=new Uint8Array(i);for(;i--;)n[i]=o.charCodeAt(i);const r=new Blob([n],{type:a});let d=document.createElement("a");d.href=URL.createObjectURL(r),d.download=t,d.click(),URL.revokeObjectURL(d.href),c(),this.$logger.info(">>> H5图片保存成功")},print_base64_data_h5(e,t=""){l({title:"正在打印文件"}),this.$refs.iframe.contentWindow.document.body.innerHTML="",this.$refs.iframe.contentWindow.document.write(`\n                    <html>\n                        <style scoped>\n                            @media print {\n                                @page {\n                                    size: ${t};\n                                }\n                            }\n                        </style>\n                        <body style="margin: 0px;">\n                            <img src="${e}" style="height: 100%; width: 100%;">\n                        </body>\n                    </html>\n                `),setTimeout((e=>{this.$refs.iframe.contentWindow.print()}),0),c()}}},[["render",function(a,r,l,d,c,p){const R=k,O=i,q=j(h("uqrcode"),$),D=j(h("uni-col"),z),L=j(h("uni-row"),I),U=n,B=g,P=j(h("sp-html2canvas-render"),S),V=j(h("uni-goods-nav"),C);return e(),m(u,null,[o(B,{"scroll-x":"true",class:"above-uni-goods-nav"},{default:s((()=>[o(U,{id:c.card_template.id,class:w(c.card_template.class),style:f(c.card_template.style)},{default:s((()=>[(e(!0),m(u,null,x(c.card_template.rows,((a,o)=>(e(),t(L,{key:o,class:w(a.class),style:f(a.style)},{default:s((()=>[(e(!0),m(u,null,x(a.cols,((a,o)=>(e(),t(D,{key:o,span:a.span,class:w(a.class),style:f(a.style)},{default:s((()=>[a.image?(e(),t(R,{key:0,mode:"aspectFit",src:a.image.url,style:f(a.image.style),class:w(a.image.class)},null,8,["src","style","class"])):y("",!0),a.text?(e(),t(O,{key:1,style:f(a.text.style),class:w(a.text.class)},{default:s((()=>[v(b(a.text.text||"　"),1)])),_:2},1032,["style","class"])):y("",!0),a.qrcode?(e(),t(q,{key:2,ref_for:!0,ref:a.qrcode.ref,"canvas-id":a.qrcode.id,value:a.qrcode.value,size:a.qrcode.size},null,8,["canvas-id","value","size"])):y("",!0)])),_:2},1032,["span","class","style"])))),128))])),_:2},1032,["class","style"])))),128))])),_:1},8,["id","class","style"])])),_:1}),o(P,{domId:c.card_template.id,ref:"pdf_render",onRenderOver:p.render_over},null,8,["domId","onRenderOver"]),o(U,{class:"uni-goods-nav-wrapper"},{default:s((()=>[o(V,{options:c.goods_nav.options,"button-group":c.goods_nav.button_group,fill:a.$store.state.goods_nav_fill,onClick:p.goods_nav_click,onButtonClick:p.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1}),_("iframe",{ref:"iframe",style:{display:"none"}},null,512)],64)}],["__scopeId","data-v-b9508813"]]);export{U as default};
