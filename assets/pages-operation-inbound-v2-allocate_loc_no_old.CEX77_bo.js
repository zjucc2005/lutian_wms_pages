import{s as t,R as e,b as l,c as i,q as s,e as o,w as a,F as n,i as d,o as r,u as _,d as c,C as u,L as p,f as h,t as g,g as f,X as m,Y as y}from"./index-DWoH3vfe.js";import{_ as x}from"./uni-list-item.DDtNoANW.js";import{r as b}from"./uni-app.es.BmoqNwAf.js";import{_ as w}from"./uni-list.BUls3DLZ.js";import{_ as k}from"./uni-icons.Btv09wDc.js";import{_ as v,a as q}from"./uni-grid.D9IfGe1V.js";import{_ as F,a as j}from"./uni-collapse.Xutvcnjh.js";import{_ as C}from"./uni-section.iEIUA4ss.js";import{_ as N}from"./uni-goods-nav.CFHsP2dB.js";import{a as M,e as $}from"./index.CbUtXxpp.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-badge.Dyjwvs1c.js";const E=B({onLoad(t){this.getOpenerEventChannel().on("initStockLocs",(t=>{this.stock_locs=t.stock_locs||[],this.pallet_qty=t.pallet_qty||0,this.get_grid_shelves(),this.get_grid_width()}))},data:()=>({stock_locs:[],pallet_qty:0,grid_group_width:0,grid_width:0,grid_shelves:[],allocate_info:[],goods_nav:{options:[{icon:"map-filled",text:"已分配",info:0}],button_group:[{text:"返回",backgroundColor:t.state.goods_nav_color.grey,color:"#fff"},{text:"预览",backgroundColor:t.state.goods_nav_color.yellow,color:"#fff"}]}}),computed:{column(){let e=Math.floor(t.state.system_info.windowWidth/48);return e<10&&(e=10),e>36&&(e=36),e}},methods:{goods_nav_click(t){0===t.index&&this.$logger.info("this.$data",this.$data)},goods_nav_button_click(t){0===t.index&&e(),1===t.index&&this.preview()},preview(){if(this.sum_plt_alloc()<this.pallet_qty)return void l({icon:"none",title:this.pallet_qty-this.sum_plt_alloc()+"个托盘未分配"});this.getOpenerEventChannel().emit("allocateInfo",{allocate_info:this.allocate_info}),e()},get_grid_shelves(){let t=[];this.stock_locs.forEach((e=>{let l=e.FPalletSpace;if(M(e.FNumber)){let i=e.FNumber.split("-"),s=i.slice(0,2).join("-"),o=1*i[2].slice(1,3),a=1*i[2][0],n="",d="default";"B"==e.FForbidStatus?(n="forbidden",d="error",l=0):0==l?d="warn":e.idle||(d="success");let r=t.find((t=>t.name==s));r?(r.bound.x=Math.max(r.bound.x,o),r.bound.y=Math.max(r.bound.y,a),r.grids.push({x:o,y:a,status:n,style:d,no:e.FNumber,name:i[2],qty:0,idle:e.idle,checked:!1,plt_space:l,plt_alloc:0})):t.push({name:s,disabled:!0,bound:{x:o,y:a},grids:[{x:o,y:a,status:n,style:d,no:e.FNumber,name:i[2],qty:0,idle:e.idle,checked:!1,plt_space:l,plt_alloc:0}]})}else if($(e.FNumber)){let i=e.FNumber.split("-"),s=[i[0],i[1][0]].join("-"),o=1*i[1].slice(1,3),a=1,n="",d="default";"B"==e.FForbidStatus?(n="forbidden",d="error",l=0):0==l?d="warn":e.idle||(d="success");let r=t.find((t=>t.name==s));r?(r.bound.x=Math.max(r.bound.x,o),r.bound.y=Math.max(r.bound.y,a),r.grids.push({x:o,y:a,status:n,style:d,sp:!0,no:e.FNumber,name:i[1],qty:0,idle:e.idle,checked:!1,plt_space:l,plt_alloc:0})):t.push({name:s,disabled:!0,bound:{x:o,y:a},sp:!0,grids:[{x:o,y:a,status:n,style:d,sp:!0,no:e.FNumber,name:i[1],qty:0,idle:e.idle,checked:!1,plt_space:l,plt_alloc:0}]})}else{let i={name:e.FNumber,disabled:!0,bound:{x:1,y:1},grids:[{x:1,y:1,status:"B"==e.FForbidStatus?"forbidden":"",style:"B"==e.FForbidStatus?"error":"default",sp:!0,no:e.FNumber,qty:0,idle:e.idle,checked:!1,plt_space:l,plt_alloc:0}]};t.push(i)}})),t.forEach((t=>{for(let e=1;e<=Math.ceil(t.bound.x/this.column)*this.column;e+=1)for(let l=1;l<=t.bound.y;l+=1){let{page:i,index:s}=this.get_grid_page_and_index(t.bound,{x:e,y:l}),o=this.get_grid_name({x:e,y:l}),a=[t.name,o].join("-"),n=t.grids.find((t=>t.x==e&&t.y==l));n?(n.page=i,n.index=s,n.no=n.no||a):(n={x:e,y:l,page:i,index:s,name:o,no:a,qty:0,status:"",style:e>t.bound.x?"none":"default"},t.grids.push(n))}})),t.sort(((t,e)=>t.name>=e.name?1:-1)),this.grid_shelves=t},get_grid_page_and_index(t={},e={}){return{page:Math.ceil(e.x/this.column),index:(t.y-e.y)*Math.ceil(t.x/this.column)*this.column+e.x}},get_grid_name:(t={})=>100*t.y+t.x,get_grid_width(){let e=t.state.system_info.windowWidth;this.grid_group_width=e,this.grid_width=(e-1)/this.column},filter_swiper_grids:(t,e)=>t.grids.filter((t=>t.page==e)).sort(((t,e)=>t.index-e.index)),get_swiper_pages(t){return Math.ceil(t.bound.x/this.column)},get_swiper_height(e){let l=t.state.system_info.windowWidth;return Math.ceil(l/this.column*(e.bound.y+.7))},grid_click(t,e){let i=e.grids.find((e=>e.index===t.detail.index));if(i&&"none"!=i.style&&"forbidden"!=i.status&&0!=i.plt_space){if(i.checked){let t=this.pallet_qty-this.sum_plt_alloc();if(i.plt_alloc===i.plt_space||0===t){i.checked=!1,i.plt_alloc=0;let t=this.allocate_info.findIndex((t=>t.no==i.no));t>=0&&this.allocate_info.splice(t,1)}else if(i.plt_alloc<i.plt_space){i.plt_alloc+=1,this.allocate_info.find((t=>t.no==i.no)).plt_qty+=1}}else{let t=this.pallet_qty-this.sum_plt_alloc();if(0===t)return void l({icon:"none",title:"分配库位已足够"});i.checked=!0,-1==i.plt_space?i.plt_alloc=t:i.plt_alloc=1,this.allocate_info.push({no:i.no,plt_qty:i.plt_alloc})}this.goods_nav.options[0].info=this.sum_plt_alloc()}},sum_plt_alloc(){let t=0;return this.allocate_info.forEach((e=>{t+=e.plt_qty})),t}}},[["render",function(t,e,l,M,$,B){const E=b(i("uni-list-item"),x),S=b(i("uni-list"),w),z=d,I=b(i("uni-icons"),k),L=b(i("uni-grid-item"),v),O=b(i("uni-grid"),q),W=m,P=y,T=b(i("uni-collapse-item"),F),A=b(i("uni-collapse"),j),J=b(i("uni-section"),C),Q=b(i("uni-goods-nav"),N);return r(),s(n,null,[o(J,{title:"分配托盘库位",type:"square","sub-title":"点击选择可以分配的托盘库位","sub-title-color":"#007aff",class:"above-uni-goods-nav"},{default:a((()=>[o(S,null,{default:a((()=>[o(E,{"show-extra-icon":!0,"extra-icon":{type:"right",color:"#007bff"},title:"已分配托盘数",rightText:`${B.sum_plt_alloc()} / ${$.pallet_qty}`},null,8,["rightText"])])),_:1}),o(A,null,{default:a((()=>[(r(!0),s(n,null,_($.grid_shelves,(t=>(r(),c(T,{title:t.name,open:"","title-border":"show"},{default:a((()=>[o(z,{class:"content"},{default:a((()=>[o(P,{"indicator-dots":!0,style:u({height:`${B.get_swiper_height(t)}px`}),class:"shelf_swiper"},{default:a((()=>[(r(!0),s(n,null,_(B.get_swiper_pages(t),(e=>(r(),c(W,{key:e},{default:a((()=>[o(O,{column:B.column,"show-border":!1,onChange:e=>B.grid_click(e,t),style:u({width:$.grid_group_width+"px"})},{default:a((()=>[(r(!0),s(n,null,_(B.filter_swiper_grids(t,e),(t=>(r(),c(L,{key:t.index,index:t.index,style:u({width:$.grid_width+"px",height:$.grid_width+"px"})},{default:a((()=>[o(z,{class:p(["grid-item-box",t.style])},{default:a((()=>[o(z,{class:"name"},{default:a((()=>[h(g(t.name),1)])),_:2},1024),t.checked?(r(),c(z,{key:0},{default:a((()=>[o(I,{type:"checkmarkempty",size:.5*$.grid_width},null,8,["size"]),o(z,{class:"pallet_qty"},{default:a((()=>[h(g(t.plt_alloc),1)])),_:2},1024)])),_:2},1024)):f("",!0)])),_:2},1032,["class"])])),_:2},1032,["index","style"])))),128))])),_:2},1032,["column","onChange","style"])])),_:2},1024)))),128))])),_:2},1032,["style"])])),_:2},1024)])),_:2},1032,["title"])))),256))])),_:1})])),_:1}),o(z,{class:"uni-goods-nav-wrapper"},{default:a((()=>[o(Q,{options:$.goods_nav.options,"button-group":$.goods_nav.button_group,fill:t.$store.state.goods_nav_fill,onClick:B.goods_nav_click,onButtonClick:B.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)}],["__scopeId","data-v-35d1245b"]]);export{E as default};
