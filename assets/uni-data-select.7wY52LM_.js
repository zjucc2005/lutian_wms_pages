import{Z as e,x as t,H as a,c as l,o as s,d as i,w as c,q as o,t as n,g as r,e as u,L as h,f as m,S as d,C as p,F as f,u as _,i as y,k as b,T as g}from"./index-MIvYX1nW.js";import{_ as C}from"./uni-icons.DEYikQDp.js";import{r as x}from"./uni-app.es.B8zr0lZI.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=D({name:"uni-data-select",mixins:[e.mixinDatacom||{}],props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""},placement:{type:String,default:"bottom"}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,t={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return t?e+t:e},valueCom(){return this.modelValue},textShow(){let e=this.current;return e.length>10?e.slice(0,25)+"...":e},getOffsetByPlacement(){switch(this.placement){case"top":return"bottom:calc(100% + 12px);";case"bottom":return"top:calc(100% + 12px);"}}},watch:{localdata:{immediate:!0,handler(e,t){Array.isArray(e)&&t!==e&&(this.mixinDatacomResData=e)}},valueCom(e,t){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,t=100){let a=null;return function(...l){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,l)}),t)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let t;if(this.collection&&(t=this.getCache()),t||0===t)e=t;else{let t="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(t=this.mixinDatacomResData[this.defItem-1].value),e=t}(e||0===e)&&this.emit(e)}else e=this.valueCom;const t=this.mixinDatacomResData.find((t=>t.value===e));this.current=t?this.formatItemName(t):""},isDisabled(e){let t=!1;return this.mixinDatacomResData.forEach((a=>{a.value===e&&(t=a.disable)})),t},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:t,value:a,channel_code:l}=e;if(l=l?`(${l})`:"",this.format){let t="";t=this.format;for(let a in e)t=t.replace(new RegExp(`{${a}}`,"g"),e[a]);return t}return this.collection.indexOf("app-list")>0?`${t}(${a})`:t||`未命名${l}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(e=this.getCurrentCacheKey()){return(t(this.cacheKey)||{})[e]},setCache(e,l=this.getCurrentCacheKey()){let s=t(this.cacheKey)||{};s[l]=e,a(this.cacheKey,s)},removeCache(e=this.getCurrentCacheKey()){let l=t(this.cacheKey)||{};delete l[e],a(this.cacheKey,l)}}},[["render",function(e,t,a,D,S,k){const v=y,w=x(l("uni-icons"),C),R=b,K=g;return s(),i(v,{class:"uni-stat__select"},{default:c((()=>[a.label?(s(),o("span",{key:0,class:"uni-label-text hide-on-phone"},n(a.label+"："),1)):r("",!0),u(v,{class:h(["uni-stat-box",{"uni-stat__actived":S.current}])},{default:c((()=>[u(v,{class:h(["uni-select",{"uni-select--disabled":a.disabled}])},{default:c((()=>[u(v,{class:"uni-select__input-box",onClick:k.toggleSelector},{default:c((()=>[S.current?(s(),i(v,{key:0,class:"uni-select__input-text"},{default:c((()=>[m(n(k.textShow),1)])),_:1})):(s(),i(v,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:c((()=>[m(n(k.typePlaceholder),1)])),_:1})),S.current&&a.clear&&!a.disabled?(s(),i(v,{key:2,onClick:d(k.clearVal,["stop"])},{default:c((()=>[u(w,{type:"clear",color:"#c0c4cc",size:"24"})])),_:1},8,["onClick"])):(s(),i(v,{key:3},{default:c((()=>[u(w,{type:S.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"])])),_:1}))])),_:1},8,["onClick"]),S.showSelector?(s(),i(v,{key:0,class:"uni-select--mask",onClick:k.toggleSelector},null,8,["onClick"])):r("",!0),S.showSelector?(s(),i(v,{key:1,class:"uni-select__selector",style:p(k.getOffsetByPlacement)},{default:c((()=>[u(v,{class:h("bottom"==a.placement?"uni-popper__arrow_bottom":"uni-popper__arrow_top")},null,8,["class"]),u(K,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:c((()=>[0===S.mixinDatacomResData.length?(s(),i(v,{key:0,class:"uni-select__selector-empty"},{default:c((()=>[u(R,null,{default:c((()=>[m(n(a.emptyTips),1)])),_:1})])),_:1})):(s(!0),o(f,{key:1},_(S.mixinDatacomResData,((e,t)=>(s(),i(v,{class:"uni-select__selector-item",key:t,onClick:t=>k.change(e)},{default:c((()=>[u(R,{class:h({"uni-select__selector__disabled":e.disable})},{default:c((()=>[m(n(k.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},8,["style"])):r("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-fe4b6be6"]]);export{S as _};
