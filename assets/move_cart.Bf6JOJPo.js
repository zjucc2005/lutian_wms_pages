import{x as t,H as o,J as e}from"./index-MIvYX1nW.js";import"./k3cloudapi.DzDu3BGl.js";import"./stock_loc.BckAHwoS.js";import{I as i}from"./inv_log.BJcJnepW.js";class s{constructor(t={}){this.move_list=t.move_list||[]}static current(){return new s(t("move_cart")||{move_list:[]})}save(){return o("move_cart",this),this}destroy(){return e("move_cart"),{move_list:[]}}update(t){let o=this.move_list.find((o=>o.inv.FID==t.inv.FID&&o.loc_no==t.loc_no));if(o){if(o.qty=t.qty,0==o.qty){let t=this.move_list.indexOf(o);-1!=t&&this.move_list.splice(t,1)}}else{if(0==t.qty)return this;this.move_list.push({created_at:Date.now(),...t})}return this.save()}async exec(t={}){try{for(let o=0;o<this.move_list.length;o++){let e=this.move_list[o],s=new i({FOpType:"mv_out",FStockId:e.inv.FStockId,FStockLocNo:e.inv["FStockLocId.FNumber"],FMaterialId:e.inv.FMaterialId,FOpQTY:e.qty,FBatchNo:e.inv.FBatchNo,FOpStaffNo:t.staff_no});await s.save();let a=new i({FOpType:"mv_in",FStockId:e.inv.FStockId,FStockLocNo:e.loc_no,FMaterialId:e.inv.FMaterialId,FOpQTY:e.qty,FBatchNo:e.inv.FBatchNo,FOpStaffNo:t.staff_no,FRemark:`${e.inv["FStockLocId.FNumber"]} -> ${e.loc_no}`});await a.save(),e.status="submitted",this.save()}}catch(o){throw new Error(o)}finally{this.move_list=this.move_list.filter((t=>"submitted"!=t.status)),this.save()}}}export{s as M};
