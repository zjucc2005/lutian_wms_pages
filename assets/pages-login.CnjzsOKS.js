import{s,a as e,h as t,b as o,r as a,c as l,d as r,w as i,i as n,o as _,e as d,f,t as u,g as m,j as c,k as g,l as p}from"./index-DjNCOAYS.js";import{_ as k}from"./uni-badge.DRmKIMEp.js";import{r as h}from"./uni-app.es.Ch8d-HxS.js";import{_ as b}from"./uni-icons.CZYyaTue.js";import{_ as v}from"./uni-data-picker.DhH0G6pw.js";import{_ as F,a as y}from"./uni-forms.TRwwN9L2.js";import{_ as j}from"./uni-easyinput.C9ecXEkH.js";import{g as V,p as w}from"./index.uJty1kg6.js";import{v as x,g as I}from"./index.Bax3unEn.js";import"./k3cloudapi.B_cIKn_3.js";import{S as $}from"./stock_loc.GXV191SF.js";import"./inv_log.B3mwqkWu.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-load-more.BRFWIZFV.js";import"./bd_empinfo.DWgOFJvr.js";const C=""+new URL("logo-wms-WFnQQCBX.png",import.meta.url).href;const N=U({data(){return{login_form:{org_id:s.state.cur_stock.FUseOrgId,stock_id:s.state.cur_stock.FStockId,staff_name:s.state.cur_staff.FName,staff_no:s.state.cur_staff.FNumber,password:""},login_form_rules:{stock_id:{rules:[{required:!0,errorMessage:"请选择仓库"}]},staff_name:{rules:[{required:!0,errorMessage:"请填写姓名"}]},staff_no:{rules:[{required:!0,errorMessage:"请填写工号"}]},password:{rules:[{required:!0,errorMessage:"请填写密码"},{validateFunction:(s,o,a,l)=>(e({title:"loading"}),x(this.login_form).then((s=>(t(),(null==s?void 0:s.FName)?"A"!=s.FForbidStatus?l("账号禁用"):void(this.staff=s):l("认证失败")))))}]}},staff:{},bd_stocks:[],bd_stock_opts:[],guest_login_form:{org_id:""},guest_login_form_rules:{org_id:{rules:[{required:!0,errorMessage:"请选择组织"}]}}}},onReady(){V()},mounted(){this.load_stocks()},methods:{get_latest_version:V,async load_stocks(){var o;if(!(null==(o=s.state.bd_stocks)?void 0:o.length)){e({title:"Loading"});let o=await I();t(),s.commit("set_bd_stocks",o.data)}this.bd_stocks=s.state.bd_stocks,this.bd_stock_opts=s.state.bd_stock_opts},handle_stock_change(s){var e;this.login_form.org_id=null==(e=s.detail.value[0])?void 0:e.value},selected_stock_info(){if(this.login_form.stock_id){let e=s.state.bd_stocks.find((s=>s.FStockId===this.login_form.stock_id));return e?[e["FUseOrgId.FName"],e["FGroup.FName"],e.FName].join("\n"):""}return""},submit_login(){this.$refs.login_form.validate().then((e=>{w("success");const t={stock:this.bd_stocks.find((s=>s.FStockId===this.login_form.stock_id)),staff:this.staff};s.commit("staff_login",t),this.after_login(),this.$logger.info(`>>> 登录成功[${this.staff.FName}]`),o({title:"登录成功"}),a({url:"/pages/operation/index_v2"})})).catch((s=>{}))},submit_guest_login(){this.$refs.guest_login_form.validate().then((e=>{let t=this.bd_stock_opts.find((s=>s.value==this.guest_login_form.org_id)),l={stock:{"FUseOrgId.FName":t.text,FUseOrgId:t.value}};w("success"),s.commit("guest_login",l),this.$logger.info(">>> 登录成功[GUEST]"),o({title:"登录成功"}),a({url:"/pages/operation/index_v2"})})).catch((s=>{}))},after_login(){$.query({FStockId:s.state.cur_stock.FStockId}).then((e=>{s.commit("set_stock_locs",e.data)}))}}},[["render",function(s,e,t,o,a,V){const w=c,x=h(l("uni-badge"),k),I=n,$=g,U=h(l("uni-icons"),b),N=h(l("uni-data-picker"),v),S=h(l("uni-forms-item"),F),q=h(l("uni-easyinput"),j),M=p,O=h(l("uni-forms"),y);return _(),r(I,{class:"container"},{default:i((()=>[d(I,{class:"logo-wrapper"},{default:i((()=>[d(w,{src:C}),d(I,null,{default:i((()=>[f("绿田WMS测试版 "+u("v"+s.$store.state.system_info.appVersion)+" ",1),s.$store.state.latest_version>s.$store.state.system_info.appVersionCode?(_(),r(x,{key:0,size:"small",text:"NEW",type:"error",onClick:V.get_latest_version},null,8,["onClick"])):m("",!0)])),_:1})])),_:1}),d(I,{class:"form-wrapper"},{default:i((()=>[d(I,{class:"form-box"},{default:i((()=>[d(O,{ref:"login_form",model:a.login_form,rules:a.login_form_rules,labelWidth:"60px",class:"form"},{default:i((()=>[d(S,{label:"仓库",name:"stock_id"},{default:i((()=>[d(N,{ref:"stock_id_data_picker",modelValue:a.login_form.stock_id,"onUpdate:modelValue":e[0]||(e[0]=s=>a.login_form.stock_id=s),localdata:a.bd_stock_opts,onChange:V.handle_stock_change,"popup-title":"请选择所属仓库"},{default:i((()=>[d(I,{class:"custom-data-picker-input"},{default:i((()=>{var s;return[(null==(s=a.login_form)?void 0:s.stock_id)?(_(),r($,{key:0,class:"selected"},{default:i((()=>[f(u(V.selected_stock_info()),1)])),_:1})):(_(),r($,{key:1,class:"placeholder"},{default:i((()=>[f("请选择")])),_:1})),d(U,{type:"down",color:"#999"})]})),_:1})])),_:1},8,["modelValue","localdata","onChange"])])),_:1}),d(S,{label:"姓名",name:"staff_name"},{default:i((()=>[d(q,{modelValue:a.login_form.staff_name,"onUpdate:modelValue":e[1]||(e[1]=s=>a.login_form.staff_name=s),trim:"both"},null,8,["modelValue"])])),_:1}),d(S,{label:"工号",name:"staff_no"},{default:i((()=>[d(q,{modelValue:a.login_form.staff_no,"onUpdate:modelValue":e[2]||(e[2]=s=>a.login_form.staff_no=s),trim:"both"},null,8,["modelValue"])])),_:1}),d(S,{label:"密码",name:"password"},{default:i((()=>[d(q,{modelValue:a.login_form.password,"onUpdate:modelValue":e[3]||(e[3]=s=>a.login_form.password=s),type:"password",trim:"both"},null,8,["modelValue"])])),_:1}),d(M,{type:"primary",onClick:V.submit_login},{default:i((()=>[f("登录")])),_:1},8,["onClick"])])),_:1},8,["model","rules"])])),_:1})])),_:1}),s.$store.state.config.log?(_(),r(I,{key:0,class:"debug-wrapper"},{default:i((()=>[d(I,null,{default:i((()=>[f("version: "+u(s.$store.state.system_info.appVersion),1)])),_:1}),d(I,null,{default:i((()=>[f("env: "+u(s.$store.state.config.env),1)])),_:1}),d(I,null,{default:i((()=>[f("log: true ")])),_:1})])),_:1})):m("",!0)])),_:1})}],["__scopeId","data-v-a94a28e1"]]);export{N as default};
