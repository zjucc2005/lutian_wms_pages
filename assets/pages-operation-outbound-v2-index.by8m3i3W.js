import{s as o,P as t,b as e,a as n,h as s,n as a,c as i,q as r,e as l,w as _,F as c,i as u,o as p,u as d,d as f,g as m,f as h,t as g,k as v,Q as b}from"./index-MIvYX1nW.js";import{_ as k}from"./uni-easyinput.BboSH9MB.js";import{r as y}from"./uni-app.es.B8zr0lZI.js";import{_ as F}from"./uni-list-item.Dk-snU2X.js";import{_ as j}from"./uni-list.zX7C8YBn.js";import{_ as C}from"./uni-load-more.5aGCwx5G.js";import{_ as q}from"./uni-section.C7O4oyAr.js";import{_ as x}from"./uni-goods-nav.DSaXBg-u.js";import{p as w}from"./index.DbF5UMRK.js";import"./k3cloudapi.DzDu3BGl.js";import{a as S}from"./stock_loc.BckAHwoS.js";import"./inv_log.BJcJnepW.js";import{f as B}from"./date-format.Dm3Q97cL.js";import{s as D}from"./scan_code.bSbj3X8t.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DEYikQDp.js";import"./uni-badge.DDwx_b0i.js";const Q=T({data:()=>({inv_plans:[],inv_plan_groups:[],last_refresh_time:0,refresh_interval:3e4,search_form:{no:""},goods_nav:{options:[{icon:"refreshempty",text:"刷新"}],admin_button_group:[{text:"新增出库计划",backgroundColor:o.state.goods_nav_color.blue,color:"#fff"}],staff_button_group:[{text:"扫码查询",backgroundColor:o.state.goods_nav_color.red,color:"#fff"}]}}),onShow(){this.load_inv_plans()},onPullDownRefresh(){this.refresh(),t()},mounted(){},methods:{checkbox_click(o){let t=this.inv_plan_groups.find((t=>t.bill_no==o.target.dataset.bill_no));t&&(t.checked=!t.checked)},goods_nav_click(o){0===o.index&&this.refresh()},goods_nav_admin_button_click(o){0===o.index&&this.new_plan()},goods_nav_staff_button_click(o){0===o.index&&this.scan_code()},searchbar_icon_click(o){"prefix"==o&&this.scan_code()},scan_code(){D().then((o=>{this.search_form.no=o.result})).catch((o=>{e({icon:"none",title:o})}))},async load_inv_plans(){let t={FStockId:o.state.cur_stock.FStockId,FOpType:"out",FDocumentStatu_in:["A","B"]};return n({title:"Loading"}),S.query(t,{order:"FCreateTime ASC"}).then((o=>{s(),this.inv_plans=o.data,this._set_inv_plan_groups(o.data)}))},async refresh(){this.last_refresh_time+this.refresh_interval>Date.now()?e({icon:"none",title:"请不要频繁刷新"}):(await this.load_inv_plans(),this.last_refresh_time=Date.now())},inv_plan_groups_filtered(){let o=this.search_form.no.trim();return o?this.inv_plan_groups.filter((t=>t.bill_no.includes(o)||t.receiver.includes(o))):this.inv_plan_groups},new_plan(){w("success"),a({url:"/pages/operation/outbound/v2/plan_init"})},operate_plan(o){this.inv_plan_groups.find((t=>t.bill_no==o))?(w("success"),a({url:`/pages/operation/outbound/v2/plan_show?t=${o}`})):e({icon:"none",title:"未找到单据编号"})},_set_inv_plan_groups(o){let t=[];o.forEach((o=>{let e=t.find((t=>t.bill_no==o.FBillNo));e?("A"==o.FDocumentStatu&&(e.qty_a+=o.FOpQTY),"B"==o.FDocumentStatu&&(e.qty_b+=o.FOpQTY)):(e={bill_no:o.FBillNo,receiver:o.FReceiver||"",created_at:B(o.FCreateTime,"yyyy-MM-dd"),qty_a:"A"==o.FDocumentStatu?o.FOpQTY:0,qty_b:"B"==o.FDocumentStatu?o.FOpQTY:0},t.push(e))})),this.inv_plan_groups=t}}},[["render",function(o,t,e,n,s,a){const w=y(i("uni-easyinput"),k),S=u,B=v,D=b,T=y(i("uni-list-item"),F),Q=y(i("uni-list"),j),A=y(i("uni-load-more"),C),I=y(i("uni-section"),q),O=y(i("uni-goods-nav"),x);return p(),r(c,null,[l(I,{title:"进行中的出库计划",type:"square","sub-title":"单据编号",class:"above-uni-goods-nav"},{default:_((()=>[l(S,{class:"searchbar-container"},{default:_((()=>[l(w,{modelValue:s.search_form.no,"onUpdate:modelValue":t[0]||(t[0]=o=>s.search_form.no=o),placeholder:"请输入单据编号或收货人",focus:"","prefix-icon":"scan",onIconClick:a.searchbar_icon_click,"primary-color":"rgb(238, 238, 238)",styles:{color:"#000",backgroundColor:"rgb(238, 238, 238)",borderColor:"rgb(238, 238, 238)"}},null,8,["modelValue","onIconClick","styles"])])),_:1}),l(Q,null,{default:_((()=>[(p(!0),r(c,null,d(a.inv_plan_groups_filtered(),((o,t)=>(p(),f(T,{key:t,"right-text":o.created_at,"show-arrow":"",onClick:t=>a.operate_plan(o.bill_no),clickable:""},{body:_((()=>[l(S,{class:"uni-list-item__body"},{default:_((()=>[l(S,{class:"title"},{default:_((()=>[h(g(o.bill_no)+" ",1),l(B,{class:"note"},{default:_((()=>[h("/")])),_:1}),h(" "+g(o.receiver),1)])),_:2},1024),l(S,{class:"note"},{default:_((()=>[l(D,{percent:100*o.qty_b/(o.qty_b+o.qty_a),"stroke-width":"2","active-color":o.qty_b/(o.qty_b+o.qty_a)==1?"#4cd964":"#f0ad4e",active:!0},null,8,["percent","active-color"]),l(B,null,{default:_((()=>[h("计划出库数："+g(o.qty_a+o.qty_b),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["right-text","onClick"])))),128))])),_:1}),0===s.inv_plan_groups.length?(p(),f(A,{key:0,status:"nomore"})):m("",!0)])),_:1}),l(S,{class:"uni-goods-nav-wrapper"},{default:_((()=>[l(O,{options:s.goods_nav.options,"button-group":s.goods_nav.admin_button_group,fill:o.$store.state.goods_nav_fill,onClick:a.goods_nav_click,onButtonClick:a.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)}]]);export{Q as default};
