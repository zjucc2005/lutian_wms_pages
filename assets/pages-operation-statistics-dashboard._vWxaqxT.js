import{s as t,c as s,d as e,w as a,i as l,o as i,e as r,C as d,q as o,u as n,F as c,g as _,f as u,t as h,aw as f,L as m}from"./index-DjNCOAYS.js";import{_ as g}from"./uni-card.BxqS3xBq.js";import{r as p}from"./uni-app.es.Ch8d-HxS.js";import{_ as y,a as v}from"./uni-row.CNBrzn_m.js";import{_ as k}from"./qiun-data-charts.ButfcOy6.js";import"./k3cloudapi.B_cIKn_3.js";import{I as b}from"./stock_loc.GXV191SF.js";import"./inv_log.B3mwqkWu.js";import{f as F}from"./index.uJty1kg6.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";class x{constructor(t,s=null){var e,a;this.name=t.shelf,this.x_limit=s,this.grids=[],(e=this.grids)[a=t.y-1]||(e[a]=s?new Array(s):[]),this.grids[t.y-1][t.x-1]=t}add_grid(t){var s,e;(s=this.grids)[e=t.y-1]||(s[e]=this.x_limit?new Array(this.x_limit):[]),this.grids[t.y-1][t.x-1]=t}}class w{constructor(t){this.no=t.FNumber,this.shelf=t.FGroup,this.name=F(t.FNumber,t.FGroup),this.x=t.FPosX,this.y=t.FPosY,this.status="",this.style="default","B"==t.FForbidStatus&&(this.status="forbidden",this.style="error"),this.sp=!1,this.qty=0,this.used=!1}}const I=q({data:()=>({grid_span:35,table_shelves:[{shelf:"A01",grids:[]}],sum_inv_qty:0,loc_qty:{total:0,disabled:0,used:0,idle:0},stock_locs_used:{},refresh_interval:null,timer:{interval:null,year:0,month:0,day:0,hour:0,minute:0,second:0,wday:0},wday_map:["日","一","二","三","四","五","六"],scroll_speed:1,chart_data:{}}),onUnload(){this.refresh_interval&&(this.$logger.info(">>> clear refresh interval",this.refresh_interval),clearInterval(this.refresh_interval)),this.timer.interval&&(this.$logger.info(">>> clear timer interval",this.timer.interval),clearInterval(this.timer.interval))},mounted(){this.init_table_shelves(),this.load_invs(),this.refresh_interval=setInterval((()=>{this.load_invs()}),12e4),this.timer.interval=this.set_timer()},computed:{chart_opts(){return{rotate:!1,rotateLock:!1,color:["#67C23A","#C0C0C0","#F56C6C"],padding:[0,0,0,0],dataLabel:!1,enableScroll:!1,legend:{show:!1,position:"top",lineHeight:20},title:{name:"库位使用率",fontSize:16,color:"#333333"},subtitle:{name:(100*this.loc_qty.used/this.loc_qty.total).toFixed(1)+"%",fontSize:30,color:"#007aff"},extra:{ring:{ringWidth:15,activeOpacity:0,activeRadius:10,offsetAngle:0,labelWidth:10,border:!1}}}}},methods:{init_table_shelves(){let s=[];this.loc_qty.total=t.state.stock_locs.length;for(let e of t.state.stock_locs){let t=new w(e);"B"==e.FForbidStatus&&(this.loc_qty.disabled+=1);let a=s.find((s=>s.name==t.shelf));a?a.add_grid(t):(a=new x(t),s.push(a))}s.sort(((t,s)=>t.name>=s.name?1:-1)),this.table_shelves=s},load_invs(){b.get_all({FStockId:t.state.cur_stock.FStockId}).then((t=>{this.update_data(t)}))},update_data(t){let s=0;for(let e of t)s+=e.FQty,this.stock_locs_used[e["FStockLocId.FNumber"]]||this.grid_activate(e["FStockLocId.FGroup"],e["FStockLocId.FPosX"],e["FStockLocId.FPosY"]),this.stock_locs_used[e["FStockLocId.FNumber"]]={v:2,group:e["FStockLocId.FGroup"],x:e["FStockLocId.FPosX"],y:e["FStockLocId.FPosY"]};this.sum_inv_qty=s,this.loc_qty.used=0;for(let e of Object.keys(this.stock_locs_used))1===this.stock_locs_used[e].v?(this.grid_deactivate(this.stock_locs_used[e].group,this.stock_locs_used[e].x,this.stock_locs_used[e].y),this.stock_locs_used[e].v=0):2===this.stock_locs_used[e].v&&(this.stock_locs_used[e].v=1,this.loc_qty.used+=1);this.loc_qty.idle=this.loc_qty.total-this.loc_qty.used-this.loc_qty.disabled,this.update_chart_data()},update_chart_data(){this.chart_data={series:[{data:[{name:"已使用",value:this.loc_qty.used},{name:"未使用",value:this.loc_qty.idle},{name:"被禁用",value:this.loc_qty.disabled}]}]}},grid_activate(t,s,e){let a=this.table_shelves.find((s=>s.name==t));a.grids[e-1][s-1].used=!0,"error"!=a.grids[e-1][s-1].style&&(a.grids[e-1][s-1].style="success")},grid_deactivate(t,s,e){let a=this.table_shelves.find((s=>s.name==t));a.grids[e-1][s-1].used=!1,"error"!=a.grids[e-1][s-1].style&&(a.grids[e-1][s-1].style="default")},slider_change(t){this.scroll_speed=t.detail.value},set_timer(){return setInterval((()=>{let t=new Date;this.timer.year=t.getFullYear(),this.timer.month=t.getMonth()+1,this.timer.day=t.getDate(),this.timer.hour=t.getHours(),this.timer.minute=t.getMinutes(),this.timer.second=t.getSeconds(),this.timer.wday=t.getDay()}),1e3)},timef:t=>t<=9?`0${t}`:t}},[["render",function(t,b,F,q,x,w){const I=l,S=p(s("uni-card"),g),j=p(s("uni-col"),y),L=p(s("uni-row"),v),C=f,$=p(s("qiun-data-charts"),k);return i(),e(I,{class:"bg"},{default:a((()=>[r(L,{gutter:10},{default:a((()=>[x.table_shelves.length?(i(),e(j,{key:0,span:21,class:"scroll-list",style:d({animationDuration:120/x.scroll_speed+"s"})},{default:a((()=>[(i(),o(c,null,n(2,(s=>(i(),o(c,{key:s},[(i(!0),o(c,null,n(x.table_shelves,((s,l)=>(i(),e(S,{key:l,margin:"5px",padding:"10px 0"},{default:a((()=>{var l;return[r(I,{class:"shelf-name"},{default:a((()=>[u(h(s.name),1)])),_:2},1024),(i(!0),o(c,null,n(Math.ceil(((null==(l=s.grids[0])?void 0:l.length)||0)/x.grid_span),(l=>(i(),e(I,{key:l,class:"shelf-grids"},{default:a((()=>[(i(!0),o(c,null,n(s.grids.length,(r=>(i(),e(I,{class:"shelf-grids-row",key:r},{default:a((()=>[(i(!0),o(c,null,n(x.grid_span,(o=>{var n;return i(),e(I,{class:m(["shelf-grid",(null==(n=s.grids[s.grids.length-r][(l-1)*x.grid_span+o-1])?void 0:n.style)||"none"]),style:d({height:(.875*t.$store.state.system_info.windowWidth-32)/x.grid_span-2+"px"})},{default:a((()=>{var t;return[u(h(null==(t=s.grids[s.grids.length-r][(l-1)*x.grid_span+o-1])?void 0:t.name),1)]})),_:2},1032,["class","style"])})),256))])),_:2},1024)))),128))])),_:2},1024)))),128))]})),_:2},1024)))),128))],64)))),64))])),_:1},8,["style"])):_("",!0),r(j,{span:3},{default:a((()=>[r(L,null,{default:a((()=>[r(S,{margin:"10px",spacing:"0",padding:"5px",onClick:b[0]||(b[0]=s=>t.$logger.info(">>>",t.$data))},{default:a((()=>[r(I,{class:"stock-name"},{default:a((()=>[u(h(t.$store.state.cur_stock.FName),1)])),_:1})])),_:1})])),_:1}),r(L,null,{default:a((()=>[r(S,{margin:"10px",spacing:"0",padding:"5px"},{default:a((()=>[r(I,{class:"timer"},{default:a((()=>[r(I,null,{default:a((()=>[u(h(x.timer.year)+"年"+h(w.timef(x.timer.month))+"月"+h(w.timef(x.timer.day))+"日",1)])),_:1}),r(I,null,{default:a((()=>[u("星期"+h(x.wday_map[x.timer.wday])+" "+h(w.timef(x.timer.hour))+":"+h(w.timef(x.timer.minute))+":"+h(w.timef(x.timer.second)),1)])),_:1})])),_:1})])),_:1})])),_:1}),r(L,null,{default:a((()=>[r(S,{margin:"10px",spacing:"0",padding:"0"},{default:a((()=>[r(I,{class:"title"},{default:a((()=>[u("滚动速度")])),_:1}),r(C,{value:x.scroll_speed,step:"1",min:1,max:4,"active-color":"#007aff","block-color":"#007aff","block-size":"20",onChange:w.slider_change},null,8,["value","onChange"])])),_:1})])),_:1}),r(L,null,{default:a((()=>[r(S,{margin:"10px",spacing:"0",padding:"0"},{default:a((()=>[r(I,{class:"title"},{default:a((()=>[u("库存总数")])),_:1}),r(I,{class:"striking-number"},{default:a((()=>[u(h(x.sum_inv_qty),1)])),_:1})])),_:1})])),_:1}),r(L,null,{default:a((()=>[r(S,{margin:"10px",spacing:"0",padding:"0"},{default:a((()=>[r(I,{class:"title"},{default:a((()=>[u("库位总数")])),_:1}),r(I,{class:"striking-number"},{default:a((()=>[u(h(x.loc_qty.total),1)])),_:1}),r(I,{class:"cc-shelf-grid-sample"},{default:a((()=>[r(I,{class:"head success"}),r(I,{class:"body"},{default:a((()=>[u("库位已使用")])),_:1}),r(I,{class:"foot"},{default:a((()=>[u(h(x.loc_qty.used),1)])),_:1})])),_:1}),r(I,{class:"cc-shelf-grid-sample"},{default:a((()=>[r(I,{class:"head default"}),r(I,{class:"body"},{default:a((()=>[u("库位未使用")])),_:1}),r(I,{class:"foot"},{default:a((()=>[u(h(x.loc_qty.idle),1)])),_:1})])),_:1}),r(I,{class:"cc-shelf-grid-sample"},{default:a((()=>[r(I,{class:"head error"}),r(I,{class:"body"},{default:a((()=>[u("库位被禁用")])),_:1}),r(I,{class:"foot"},{default:a((()=>[u(h(x.loc_qty.disabled),1)])),_:1})])),_:1}),r($,{type:"ring",opts:w.chart_opts,"chart-data":x.chart_data},null,8,["opts","chart-data"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-1cb0c1b9"]]);export{I as default};
