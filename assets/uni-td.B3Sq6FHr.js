import{o as e,d as t,w as s,L as i,e as a,i as l,O as n,c as r,g as c,S as d,q as h,F as o,u,C as p,f,t as g,k as b,ah as m,I as k,a7 as y,D as S}from"./index-MIvYX1nW.js";import{_ as w}from"./uni-datetime-picker.D11eskE5.js";import{r as C}from"./uni-app.es.B8zr0lZI.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=_({name:"TableCheckbox",emits:["checkboxSelected"],props:{indeterminate:{type:Boolean,default:!1},checked:{type:[Boolean,String],default:!1},disabled:{type:Boolean,default:!1},index:{type:Number,default:-1},cellData:{type:Object,default:()=>({})}},watch:{checked(e){"boolean"==typeof this.checked?this.isChecked=e:this.isChecked=!0},indeterminate(e){this.isIndeterminate=e}},data:()=>({isChecked:!1,isDisabled:!1,isIndeterminate:!1}),created(){"boolean"==typeof this.checked&&(this.isChecked=this.checked),this.isDisabled=this.disabled},methods:{selected(){this.isDisabled||(this.isIndeterminate=!1,this.isChecked=!this.isChecked,this.$emit("checkboxSelected",{checked:this.isChecked,data:this.cellData}))}}},[["render",function(n,r,c,d,h,o){const u=l;return e(),t(u,{class:"uni-table-checkbox",onClick:o.selected},{default:s((()=>[c.indeterminate?(e(),t(u,{key:1,class:"checkbox__inner checkbox--indeterminate"},{default:s((()=>[a(u,{class:"checkbox__inner-icon"})])),_:1})):(e(),t(u,{key:0,class:i(["checkbox__inner",{"is-checked":h.isChecked,"is-disable":h.isDisabled}])},{default:s((()=>[a(u,{class:"checkbox__inner-icon"})])),_:1},8,["class"]))])),_:1},8,["onClick"])}],["__scopeId","data-v-ff0fdce7"]]),T={reset:"重置",search:"搜索",submit:"确定",filter:"筛选",gt:"大于等于",lt:"小于等于",date:"日期范围"},V="select",R="search",D="range",v="date",$="timestamp";const N=_({name:"uniTh",options:{virtualHost:!0},components:{dropdown:_({name:"FilterDropdown",emits:["change"],components:{checkBox:x},options:{virtualHost:!0},props:{filterType:{type:String,default:V},filterData:{type:Array,default:()=>[]},mode:{type:String,default:"default"},map:{type:Object,default:()=>({text:"text",value:"value"})},filterDefaultValue:{type:[Array,String],default:()=>""}},computed:{canReset(){return this.isSearch?this.filterValue.length>0:this.isSelect?this.checkedValues.length>0:this.isRange?this.gtValue.length>0&&this.ltValue.length>0:!!this.isDate&&this.dateSelect.length>0},isSelect(){return this.filterType===V},isSearch(){return this.filterType===R},isRange(){return this.filterType===D},isDate(){return this.filterType===v||this.filterType===$}},watch:{filterData(e){this._copyFilters()},indeterminate(e){this.isIndeterminate=e}},data(){return{resource:T,enabled:!0,isOpened:!1,dataList:[],filterValue:this.filterDefaultValue,checkedValues:[],gtValue:"",ltValue:"",dateRange:[],dateSelect:[]}},created(){this._copyFilters()},methods:{_copyFilters(){let e=JSON.parse(JSON.stringify(this.filterData));for(let t=0;t<e.length;t++)void 0===e[t].checked&&(e[t].checked=!1);this.dataList=e},openPopup(){this.isOpened=!0,this.isDate&&this.$nextTick((()=>{this.dateRange.length||this.resetDate(),this.$refs.datetimepicker.show()}))},closePopup(){this.isOpened=!1},handleClose(e){this.closePopup()},resetDate(){let e=(new Date).toISOString().split("T")[0];this.dateRange=[e+" 0:00:00",e+" 23:59:59"]},onDropdown(e){this.openPopup()},onItemClick(e,t){let s=this.dataList,i=s[t];void 0===i.checked?s[t].checked=!0:s[t].checked=!i.checked;let a=[];for(let l=0;l<s.length;l++){const e=s[l];e.checked&&a.push(e.value)}this.checkedValues=a},datetimechange(e){this.closePopup(),this.dateRange=e,this.dateSelect=e,this.$emit("change",{filterType:this.filterType,filter:e})},timepickerclose(e){this.closePopup()},handleSelectSubmit(){this.closePopup(),this.$emit("change",{filterType:this.filterType,filter:this.checkedValues})},handleSelectReset(){if(this.canReset){var e=this.dataList;for(let t=0;t<e.length;t++){let s=e[t];this.$set(s,"checked",!1)}this.checkedValues=[],this.handleSelectSubmit()}},handleSearchSubmit(){this.closePopup(),this.$emit("change",{filterType:this.filterType,filter:this.filterValue})},handleSearchReset(){this.canReset&&(this.filterValue="",this.handleSearchSubmit())},handleRangeSubmit(e){this.closePopup(),this.$emit("change",{filterType:this.filterType,filter:!0===e?[]:[parseInt(this.gtValue),parseInt(this.ltValue)]})},handleRangeReset(){this.canReset&&(this.gtValue="",this.ltValue="",this.handleRangeSubmit(!0))}}},[["render",function(y,S,_,x,T,V){const R=l,D=n("check-box"),v=b,$=m,N=k,I=C(r("uni-datetime-picker"),w);return e(),t(R,{class:"uni-filter-dropdown"},{default:s((()=>[a(R,{class:"dropdown-btn",onClick:V.onDropdown},{default:s((()=>[V.isSelect||V.isRange?(e(),t(R,{key:0,class:i(["icon-select",{active:V.canReset}])},null,8,["class"])):c("",!0),V.isSearch?(e(),t(R,{key:1,class:i(["icon-search",{active:V.canReset}])},{default:s((()=>[a(R,{class:"icon-search-0"}),a(R,{class:"icon-search-1"})])),_:1},8,["class"])):c("",!0),V.isDate?(e(),t(R,{key:2,class:i(["icon-calendar",{active:V.canReset}])},{default:s((()=>[a(R,{class:"icon-calendar-0"}),a(R,{class:"icon-calendar-1"})])),_:1},8,["class"])):c("",!0)])),_:1},8,["onClick"]),T.isOpened?(e(),t(R,{key:0,class:"uni-dropdown-cover",onClick:V.handleClose},null,8,["onClick"])):c("",!0),T.isOpened?(e(),t(R,{key:1,class:"dropdown-popup dropdown-popup-right",onClick:S[3]||(S[3]=d((()=>{}),["stop"]))},{default:s((()=>[V.isSelect?(e(),t(R,{key:0,class:"list"},{default:s((()=>[(e(!0),h(o,null,u(T.dataList,((i,l)=>(e(),t($,{class:"flex-r a-i-c list-item",key:l,onClick:e=>V.onItemClick(e,l)},{default:s((()=>[a(D,{class:"check",checked:i.checked},null,8,["checked"]),a(R,{class:"checklist-content"},{default:s((()=>[a(v,{class:"checklist-text",style:p(i.styleIconText)},{default:s((()=>[f(g(i[_.map.text]),1)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):c("",!0),V.isSelect?(e(),t(R,{key:1,class:"flex-r opera-area"},{default:s((()=>[a(R,{class:i(["flex-f btn btn-default",{disable:!V.canReset}]),onClick:V.handleSelectReset},{default:s((()=>[f(g(T.resource.reset),1)])),_:1},8,["class","onClick"]),a(R,{class:"flex-f btn btn-submit",onClick:V.handleSelectSubmit},{default:s((()=>[f(g(T.resource.submit),1)])),_:1},8,["onClick"])])),_:1})):c("",!0),V.isSearch?(e(),t(R,{key:2,class:"search-area"},{default:s((()=>[a(N,{class:"search-input",modelValue:T.filterValue,"onUpdate:modelValue":S[0]||(S[0]=e=>T.filterValue=e)},null,8,["modelValue"])])),_:1})):c("",!0),V.isSearch?(e(),t(R,{key:3,class:"flex-r opera-area"},{default:s((()=>[a(R,{class:"flex-f btn btn-submit",onClick:V.handleSearchSubmit},{default:s((()=>[f(g(T.resource.search),1)])),_:1},8,["onClick"]),a(R,{class:i(["flex-f btn btn-default",{disable:!V.canReset}]),onClick:V.handleSearchReset},{default:s((()=>[f(g(T.resource.reset),1)])),_:1},8,["class","onClick"])])),_:1})):c("",!0),V.isRange?(e(),t(R,{key:4},{default:s((()=>[a(R,{class:"input-label"},{default:s((()=>[f(g(T.resource.gt),1)])),_:1}),a(N,{class:"input",modelValue:T.gtValue,"onUpdate:modelValue":S[1]||(S[1]=e=>T.gtValue=e)},null,8,["modelValue"]),a(R,{class:"input-label"},{default:s((()=>[f(g(T.resource.lt),1)])),_:1}),a(N,{class:"input",modelValue:T.ltValue,"onUpdate:modelValue":S[2]||(S[2]=e=>T.ltValue=e)},null,8,["modelValue"])])),_:1})):c("",!0),V.isRange?(e(),t(R,{key:5,class:"flex-r opera-area"},{default:s((()=>[a(R,{class:i(["flex-f btn btn-default",{disable:!V.canReset}]),onClick:V.handleRangeReset},{default:s((()=>[f(g(T.resource.reset),1)])),_:1},8,["class","onClick"]),a(R,{class:"flex-f btn btn-submit",onClick:V.handleRangeSubmit},{default:s((()=>[f(g(T.resource.submit),1)])),_:1},8,["onClick"])])),_:1})):c("",!0),V.isDate?(e(),t(R,{key:6},{default:s((()=>[a(I,{ref:"datetimepicker",value:T.dateRange,type:"datetimerange","return-type":"timestamp",onChange:V.datetimechange,onMaskClick:V.timepickerclose},{default:s((()=>[a(R)])),_:1},8,["value","onChange","onMaskClick"])])),_:1})):c("",!0)])),_:1})):c("",!0)])),_:1})}],["__scopeId","data-v-61591324"]])},emits:["sort-change","filter-change"],props:{width:{type:[String,Number],default:""},align:{type:String,default:"left"},rowspan:{type:[Number,String],default:1},colspan:{type:[Number,String],default:1},sortable:{type:Boolean,default:!1},filterType:{type:String,default:""},filterData:{type:Array,default:()=>[]},filterDefaultValue:{type:[Array,String],default:()=>""}},data:()=>({border:!1,ascending:!1,descending:!1}),computed:{customWidth(){if("number"==typeof this.width)return this.width;if("string"==typeof this.width){let e=new RegExp(/^[1-9][0-9]*px$/g),t=new RegExp(/^[1-9][0-9]*rpx$/g),s=new RegExp(/^[1-9][0-9]*$/g);if(null!==this.width.match(e))return this.width.replace("px","");if(null!==this.width.match(t)){let e=Number(this.width.replace("rpx","")),t=y().screenWidth/750;return Math.round(e*t)}return null!==this.width.match(s)?this.width:""}return""},contentAlign(){let e="left";switch(this.align){case"left":e="flex-start";break;case"center":e="center";break;case"right":e="flex-end"}return e}},created(){this.root=this.getTable("uniTable"),this.rootTr=this.getTable("uniTr"),this.rootTr.minWidthUpdate(this.customWidth?this.customWidth:140),this.border=this.root.border,this.root.thChildren.push(this)},methods:{sort(){if(this.sortable)return this.clearOther(),this.ascending||this.descending?this.ascending&&!this.descending?(this.ascending=!1,this.descending=!0,void this.$emit("sort-change",{order:"descending"})):void(!this.ascending&&this.descending&&(this.ascending=!1,this.descending=!1,this.$emit("sort-change",{order:null}))):(this.ascending=!0,void this.$emit("sort-change",{order:"ascending"}))},ascendingFn(){this.clearOther(),this.ascending=!this.ascending,this.descending=!1,this.$emit("sort-change",{order:this.ascending?"ascending":null})},descendingFn(){this.clearOther(),this.descending=!this.descending,this.ascending=!1,this.$emit("sort-change",{order:this.descending?"descending":null})},clearOther(){this.root.thChildren.map((e=>(e!==this&&(e.ascending=!1,e.descending=!1),e)))},ondropdown(e){this.$emit("filter-change",e)},getTable(e){let t=this.$parent,s=t.$options.name;for(;s!==e;){if(t=t.$parent,!t)return!1;s=t.$options.name}return t}}},[["render",function(r,o,u,f,g,m){const k=b,y=l,w=n("dropdown");return e(),h("th",{rowspan:u.rowspan,colspan:u.colspan,class:i(["uni-table-th",{"table--border":g.border}]),style:p({width:m.customWidth+"px","text-align":u.align})},[a(y,{class:"uni-table-th-row"},{default:s((()=>[a(y,{class:"uni-table-th-content",style:p({"justify-content":m.contentAlign}),onClick:m.sort},{default:s((()=>[S(r.$slots,"default",{},void 0,!0),u.sortable?(e(),t(y,{key:0,class:"arrow-box"},{default:s((()=>[a(k,{class:i(["arrow up",{active:g.ascending}]),onClick:d(m.ascendingFn,["stop"])},null,8,["class","onClick"]),a(k,{class:i(["arrow down",{active:g.descending}]),onClick:d(m.descendingFn,["stop"])},null,8,["class","onClick"])])),_:1})):c("",!0)])),_:3},8,["style","onClick"]),u.filterType||u.filterData.length?(e(),t(w,{key:0,filterDefaultValue:u.filterDefaultValue,filterData:u.filterData,filterType:u.filterType,onChange:m.ondropdown},null,8,["filterDefaultValue","filterData","filterType","onChange"])):c("",!0)])),_:3})],14,["rowspan","colspan"])}],["__scopeId","data-v-46096bb8"]]);const I=_({name:"uniTr",components:{tableCheckbox:x},props:{disabled:{type:Boolean,default:!1},keyValue:{type:[String,Number],default:""}},options:{virtualHost:!0},data:()=>({value:!1,border:!1,selection:!1,widthThArr:[],ishead:!0,checked:!1,indeterminate:!1}),created(){this.root=this.getTable(),this.head=this.getTable("uniThead"),this.head&&(this.ishead=!1,this.head.init(this)),this.border=this.root.border,this.selection=this.root.type,this.root.trChildren.push(this);const e=this.root.data.find((e=>e[this.root.rowKey]===this.keyValue));e&&(this.rowData=e),this.root.isNodata()},mounted(){if(this.widthThArr.length>0){const e="selection"===this.selection?50:0;this.root.minWidth=Number(this.widthThArr.reduce(((e,t)=>Number(e)+Number(t))))+e}},unmounted(){const e=this.root.trChildren.findIndex((e=>e===this));this.root.trChildren.splice(e,1),this.root.isNodata()},methods:{minWidthUpdate(e){if(this.widthThArr.push(e),this.widthThArr.length>0){const e="selection"===this.selection?50:0;this.root.minWidth=Number(this.widthThArr.reduce(((e,t)=>Number(e)+Number(t))))+e}},checkboxSelected(e){let t=this.root.data.find((e=>e[this.root.rowKey]===this.keyValue));this.checked=e.checked,this.root.check(t||this,e.checked,t?this.keyValue:null)},change(e){this.root.trChildren.forEach((t=>{t===this&&this.root.check(this,e.detail.value.length>0)}))},getTable(e="uniTable"){let t=this.$parent,s=t.$options.name;for(;s!==e;){if(t=t.$parent,!t)return!1;s=t.$options.name}return t}}},[["render",function(t,s,l,r,d,o){const u=n("table-checkbox");return e(),h("tr",{class:"uni-table-tr"},["selection"===d.selection&&d.ishead?(e(),h("th",{key:0,class:i(["checkbox",{"tr-table--border":d.border}])},[a(u,{checked:d.checked,indeterminate:d.indeterminate,disabled:l.disabled,onCheckboxSelected:o.checkboxSelected},null,8,["checked","indeterminate","disabled","onCheckboxSelected"])],2)):c("",!0),S(t.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-3d918083"]]);const O=_({name:"uniTd",options:{virtualHost:!0},props:{width:{type:[String,Number],default:""},align:{type:String,default:"left"},rowspan:{type:[Number,String],default:1},colspan:{type:[Number,String],default:1}},data:()=>({border:!1}),created(){this.root=this.getTable(),this.border=this.root.border},methods:{getTable(){let e=this.$parent,t=e.$options.name;for(;"uniTable"!==t;){if(e=e.$parent,!e)return!1;t=e.$options.name}return e}}},[["render",function(t,s,a,l,n,r){return e(),h("td",{class:i(["uni-table-td",{"table--border":n.border}]),rowspan:a.rowspan,colspan:a.colspan,style:p({width:a.width+"px","text-align":a.align})},[S(t.$slots,"default",{},void 0,!0)],14,["rowspan","colspan"])}],["__scopeId","data-v-aef02679"]]);export{N as _,I as a,O as b};
