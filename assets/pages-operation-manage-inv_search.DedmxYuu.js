import{s as t,p as s,b as o,a,h as i,c as e,q as n,e as l,w as _,F as d,i as c,o as r,d as m,g as u,u as p,f as h,t as f,k as y}from"./index-DGWOUQdM.js";import{_ as F}from"./cc-shelf.Deed8cd0.js";import{r as v}from"./uni-app.es.DKZsoyMd.js";import{_ as g}from"./uni-list-item.BnynrAPo.js";import{_ as b}from"./uni-list.Kn4QrsAX.js";import{_ as k}from"./uni-load-more.Dv1TB_Bm.js";import{_ as I}from"./uni-section.Dvy4SRsN.js";import{_ as j}from"./uni-goods-nav.BwI3ErB8.js";import{a as N}from"./index.DoxUADsK.js";import{i as S,a as x}from"./index.JIux-90-.js";import"./k3cloudapi.CbDqg_He.js";import{I as w}from"./stock_loc.C36uFwb2.js";import"./inv_log.OihDyY2r.js";import{s as C}from"./scan_code.CS8963f7.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.LDhtL0t0.js";import"./uni-grid.T2dTchQc.js";import"./uni-collapse.uyOh-RLk.js";import"./uni-drawer.Cl_UrRdK.js";import"./uni-badge._gn3hy42.js";import"./bd_empinfo.fReN8Img.js";const B=L({props:{t:{type:String},m:{type:Number}},components:{ccShelf:F},data:()=>({mode:"",display_mode:"list",scan_mode:0,no:"",material:{material_no:"",material_name:"",material_spec:"",base_unit_name:""},invs:[],goods_nav:{options:[{icon:"more-filled",text:"更多"},{icon:"list",text:"列表"}],button_group:[{text:"扫码查询",backgroundColor:t.state.goods_nav_color.red,color:"#fff"}]}}),onLoad(t){if(t.t)if(t.m)this.scan_mode=t.m,this.handle_scan_code(t.t);else{let s=this.parse_scan_code(t.t);this.scan_mode=s[1],this.handle_scan_code(s[0])}},mounted(){},methods:{goods_nav_click(t){0==t.index&&this.more_actions(),1==t.index&&this.switch_display_mode()},goods_nav_button_click(t){0==t.index&&this.scan_code()},more_actions(){s({itemList:["扫码查询（物料编号）","扫码查询（库位号）"],success:t=>{0===t.tapIndex&&this.scan_code(0),1===t.tapIndex&&this.scan_code(1)}})},switch_display_mode(){s({itemList:["网格显示","列表显示"],success:t=>{0===t.tapIndex&&this.set_display_mode("grid"),1===t.tapIndex&&this.set_display_mode("list")}})},scan_code(t=0){this.scan_mode=t,C().then((t=>{this.handle_scan_code(t.result)})).catch((t=>{o({icon:"none",title:t})}))},async load_material(s){return this.material={material_no:s},N(s,t.state.cur_stock.FUseOrgId).then((t=>{if(t.data[0]){let s=t.data[0];this.material={material_no:s.FNumber,material_name:s.FName,material_spec:s.FSpecification,base_unit_name:s["FBaseUnitId.FName"]}}}))},async load_invs_by_material_no(s){const o={FStockId:t.state.cur_stock.FStockId,"FMaterialId.FNumber":s,FQty_gt:0};return w.query(o,{order:"FBatchNo ASC, FStockLocId.FNumber ASC"}).then((t=>{this.invs=t.data,this.mode="material_no",this.set_display_mode("list"),this.no=s}))},async load_invs_by_loc_no(s){const o={FStockId:t.state.cur_stock.FStockId,"FStockLocId.FNumber":s,FQty_gt:0};return w.query(o,{order:"FMaterialId.FNumber ASC, FBatchNo ASC"}).then((t=>{this.invs=t.data,this.mode="loc_no",this.set_display_mode("list"),this.no=s}))},async handle_scan_code(t){(t=t.trim())&&(a({title:"Loading"}),0==this.scan_mode?(await this.load_invs_by_material_no(t),await this.load_material(t),i()):1==this.scan_mode?(await this.load_invs_by_loc_no(t),i()):S(t)?(await this.load_invs_by_material_no(t),await this.load_material(t),i()):x(t)?(await this.load_invs_by_loc_no(t),i()):(i(),this.invs=[],this.mode="",this.no="",o({icon:"none",title:"未知格式的编码"})))},parse_scan_code:t=>t.includes("||")?[t.split("||")[1],0]:x(t)?[t,1]:[t,0],set_display_mode(t){this.display_mode=t,"grid"==t?(this.goods_nav.options[1].icon="map",this.goods_nav.options[1].text="网格"):"list"==t&&(this.goods_nav.options[1].icon="list",this.goods_nav.options[1].text="列表")},set_section_sub_title(){let t=[];return"material_no"==this.mode?t=[this.material.material_no,`名称：${this.material.material_name}`,`规格：${this.material.material_spec}`]:"loc_no"==this.mode&&(t=[`库位：${this.no}`]),t.join("\n")}}},[["render",function(t,s,o,a,i,N){const S=v(e("cc-shelf"),F),x=c,w=y,C=v(e("uni-list-item"),g),L=v(e("uni-list"),b),B=v(e("uni-load-more"),k),q=v(e("uni-section"),I),A=v(e("uni-goods-nav"),j);return r(),n(d,null,[l(q,{title:"查询结果",type:"square","sub-title":N.set_section_sub_title(),class:"above-uni-goods-nav"},{default:_((()=>["grid"==i.display_mode&&i.invs.length?(r(),m(S,{key:0,stock_locs:t.$store.state.stock_locs,invs:i.invs,"only-inv":"",open:""},null,8,["stock_locs","invs"])):u("",!0),"material_no"==i.mode&&"list"==i.display_mode?(r(),m(L,{key:1},{default:_((()=>[(r(!0),n(d,null,p(i.invs,((t,s)=>(r(),m(C,{key:s},{body:_((()=>[l(x,{class:"uni-list-item__body"},{default:_((()=>[l(x,{class:"title"},{default:_((()=>[h(f(t["FStockLocId.FNumber"]),1)])),_:2},1024),l(x,{class:"note"},{default:_((()=>[l(x,null,{default:_((()=>[h("批次："+f(t.FBatchNo),1)])),_:2},1024),l(x,null,{default:_((()=>[h("供应商："+f(t["FSupplierId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:_((()=>[l(x,{class:"uni-list-item__foot"},{default:_((()=>[l(x,{class:"op_qty"},{default:_((()=>[l(w,null,{default:_((()=>[h(f(t.FQty)+" "+f(t["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):u("",!0),"loc_no"==i.mode&&"list"==i.display_mode?(r(),m(L,{key:2},{default:_((()=>[(r(!0),n(d,null,p(i.invs,((t,s)=>(r(),m(C,{key:s},{body:_((()=>[l(x,{class:"uni-list-item__body"},{default:_((()=>[l(x,{class:"title"},{default:_((()=>[h(f(t["FMaterialId.FNumber"]),1)])),_:2},1024),l(x,{class:"note"},{default:_((()=>[l(x,null,{default:_((()=>[h("名称："+f(t["FMaterialId.FName"]),1)])),_:2},1024),l(x,null,{default:_((()=>[h("规格："+f(t["FMaterialId.FSpecification"]),1)])),_:2},1024),l(x,null,{default:_((()=>[h("批次："+f(t.FBatchNo),1)])),_:2},1024),l(x,null,{default:_((()=>[h("供应商："+f(t["FSupplierId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:_((()=>[l(x,{class:"uni-list-item__foot"},{default:_((()=>[l(x,{class:"op_qty"},{default:_((()=>[l(w,null,{default:_((()=>[h(f(t.FQty)+" "+f(t["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):u("",!0),0==i.invs.length?(r(),m(B,{key:3,status:"nomore","content-text":{contentnomore:"没有相关数据"}})):u("",!0)])),_:1},8,["sub-title"]),l(x,{class:"uni-goods-nav-wrapper"},{default:_((()=>[l(A,{options:i.goods_nav.options,"button-group":i.goods_nav.button_group,fill:t.$store.state.goods_nav_fill,onClick:N.goods_nav_click,onButtonClick:N.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)}]]);export{B as default};
