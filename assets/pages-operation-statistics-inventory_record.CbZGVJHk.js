import{s as t,a as e,h as a,c as s,q as i,e as o,w as r,F as n,o as _,i as d}from"./index-DjNCOAYS.js";import{_ as u}from"./qiun-data-charts.ButfcOy6.js";import{r as h}from"./uni-app.es.Ch8d-HxS.js";import{_ as l}from"./uni-section.Cyvrqc16.js";import{_ as c}from"./uni-segmented-control.BrXUwpis.js";import{f as m}from"./date-format.Dm3Q97cL.js";import"./k3cloudapi.B_cIKn_3.js";import"./stock_loc.GXV191SF.js";import{I as p}from"./inv_log.B3mwqkWu.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=g({data:()=>({raw_data:[],mode:"day",stime:null,type:"line",opts:{enableScroll:!0,scrollPosition:"right",xAxis:{scrollShow:!0,scrollAlign:"right",itemCount:Math.max(Math.floor(t.state.system_info.windowWidth/60),8)},extra:{line:{type:"curve",width:2,activeType:"hollow"}}},chart_data:{categories:[],series:[]}}),mounted(){this._get_stime(),this.load_raw_data()},methods:{segment_click(t){0===t.currentIndex&&this._set_chart_data_day(),1===t.currentIndex&&this._set_chart_data_week(),2===t.currentIndex&&this._set_chart_data_month()},async load_raw_data(){try{let s={FOpType_in:["in","in_cl","out","out_cl"],FStockId:t.state.cur_stock.FStockId,FCreateTime_ge:m(this.stime,"yyyy-MM-dd")};e({title:"Loading"});let i=await p.inventory_record(s);a(),this.raw_data=i.map((t=>(t[4]=Number(new Date(t[3])),t))),this._set_chart_data_day()}catch(s){}},_set_chart_data_month(){this.mode="month";let t=[],e=[],a=[],s=this.stime.getFullYear(),i=this.stime.getMonth();for(let o=0;o<12;o++){let r=s,n=i+o;n>11&&(r+=1,n-=12);let _=new Date(r,n,1),d=r,u=n+1;u>11&&(d+=1,u-=12);let h=new Date(d,u,1);t.push(m(_,"yy.MM")),e.push(this._sum_inbound(_,h)),a.push(this._sum_outbound(_,h))}this.chart_data={categories:t,series:[{name:"入库",data:e},{name:"出库",data:a}]}},_set_chart_data_week(){this.mode="week";let t=[],e=[],a=[],s=this.stime,i=s.getDay();for(s=1===i?Number(s):Number(s)+24*(8-i)*3600*1e3;s<Date.now();){let i=s+6048e5;t.push(m(s,"MM.dd")),e.push(this._sum_inbound(s,i)),a.push(this._sum_outbound(s,i)),s=i}this.chart_data={categories:t,series:[{name:"入库",data:e},{name:"出库",data:a}]}},_set_chart_data_day(){this.mode="day";let t=[],e=[],a=[],s=Number(this.stime);for(;s<Date.now();){let i=s+864e5;t.push(m(s,"MM.dd")),e.push(this._sum_inbound(s,i)),a.push(this._sum_outbound(s,i)),s=i}this.chart_data={categories:t,series:[{name:"入库",data:e},{name:"出库",data:a}]}},_sum_inbound(t,e){let a=0;return this.raw_data.forEach((s=>{["in","in_cl"].includes(s[0])&&s[4]>=t&&s[4]<e&&(a+=s[1])})),a},_sum_outbound(t,e){let a=0;return this.raw_data.forEach((s=>{["out","out_cl"].includes(s[0])&&s[4]>=t&&s[4]<e&&(a-=s[1])})),a},_get_stime(){let t=new Date(Date.now()-2592e6),e=t.getFullYear(),a=t.getMonth(),s=t.getDate();this.stime=new Date(e,a,s)},debug(t){this.$logger.info("debug",this.$data)}}},[["render",function(t,e,a,m,p,g){const y=h(s("qiun-data-charts"),u),w=h(s("uni-section"),l),f=h(s("uni-segmented-control"),c),b=d;return _(),i(n,null,[o(w,{title:"出入库数量统计",type:"square"},{default:r((()=>[o(y,{type:p.type,opts:p.opts,"chart-data":p.chart_data,ontouch:""},null,8,["type","opts","chart-data"])])),_:1}),o(w,{title:"设置",type:"square"},{default:r((()=>[o(b,{class:"container"},{default:r((()=>[o(f,{current:0,values:["日视图","周视图","月视图"],onClickItem:g.segment_click},null,8,["onClickItem"])])),_:1})])),_:1})],64)}]]);export{y as default};
