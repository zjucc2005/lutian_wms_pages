import{s as t,x as s,b as i,c as o,d as e,w as a,i as n,o as r,e as l,q as u,u as _,F as c,f as d,t as f,k as p}from"./index-DsK9pIyj.js";import{_ as h}from"./uni-list-item.BkmqxiQh.js";import{r as m}from"./uni-app.es.CSK8ITuj.js";import{_ as F,a as g}from"./uni-swipe-action.BTWqdF-e.js";import{_ as k}from"./uni-section.BpQrEx4g.js";import{I as v}from"./inv_log.D0BShjlW.js";import{d as I}from"./index.uHoH2c2-.js";import{f as y}from"./date-format.Dm3Q97cL.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DRoE6XYp.js";import"./uni-badge.CO78OwkC.js";import"./k3cloudapi.PCDjx1SF.js";const j=b({data:()=>({cur_stock:{},cur_staff:{},cur_outbound_task:{},inv_logs:[],log_options:[{text:"取消",style:{backgroundColor:"#f56c6c"}}]}),mounted(){this.cur_stock=t.state.cur_stock,this.cur_staff=t.state.cur_staff,this.cur_outbound_task=s("cur_outbound_task"),this.load_inv_logs()},methods:{describe_inv_log:I,formatDate:y,load_inv_logs(){v.query({FStockId:this.cur_stock.FStockId,FBillNo:this.cur_outbound_task.bill_no,FOpType_in:["out","out_cl"]},{order:"FCreateTime DESC"}).then((t=>{t.data.reverse().forEach((t=>this.unshift_inv_log(t)))}))},swipe_action_click(t,s){0===t.index&&this.cancel(s)},cancel(t){let s=this.inv_logs.find((s=>s.FID===t));if("out"!=s.FOpType||s.status)i({icon:"error",title:"ERROR"});else{new v({FOpType:"out_cl",FStockId:s.FStockId,FStockLocNo:s["FStockLocId.FNumber"],FMaterialId:s.FMaterialId,FOpQTY:s.FOpQTY,FBatchNo:s.FBatchNo,FBillNo:s.FBillNo,FOpStaffNo:this.cur_staff.FNumber,FReferId:s.FID}).save().then((t=>{this.after_save(t),this.$refs.c_inv_log_swipe.closeAll()}))}},after_save(t){t.data.Result.ResponseStatus.IsSuccess?v.find(t.data.Result.Id).then((t=>{t.data[0]&&(this.unshift_inv_log(t.data[0]),i({title:"提交成功"}))})):i({title:"提交失败"})},unshift_inv_log(t){if("out_cl"==t.FOpType){let s=this.inv_logs.find((s=>s.FID===t.FReferId));s&&(s.status="已取消")}this.inv_logs.unshift(t)}}},[["render",function(t,s,i,v,I,y){const b=p,j=m(o("uni-list-item"),h),S=m(o("uni-swipe-action-item"),F),T=m(o("uni-swipe-action"),g),x=m(o("uni-section"),k),N=n;return r(),e(N,null,{default:a((()=>[l(x,{title:"操作日志",type:"line"},{default:a((()=>[l(T,{ref:"c_inv_log_swipe"},{default:a((()=>[(r(!0),u(c,null,_(I.inv_logs,((t,s)=>(r(),e(S,{key:s,threshold:60,"right-options":"out"!=t.FOpType||t.status?[]:I.log_options,onClick:s=>y.swipe_action_click(s,t.FID)},{default:a((()=>[l(j,{title:y.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss"),note:y.describe_inv_log(t),rightText:t.status},{footer:a((()=>[l(b,{class:"uni-list-item-right-text"},{default:a((()=>[d(f(t.status),1)])),_:2},1024)])),_:2},1032,["title","note","rightText"])])),_:2},1032,["right-options","onClick"])))),128))])),_:1},512)])),_:1})])),_:1})}],["__scopeId","data-v-69779c0c"]]);export{j as default};
