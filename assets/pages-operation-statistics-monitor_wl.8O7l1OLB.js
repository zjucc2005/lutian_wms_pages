import{c as t,d as e,w as a,i,o as s,e as l,q as n,u as o,F as d,f as r,Q as c,L as u,t as _,g as p,k as f}from"./index-MIvYX1nW.js";import{_ as m}from"./uni-card.BwOA49d2.js";import{r as h}from"./uni-app.es.B8zr0lZI.js";import{_ as v,a as k}from"./uni-row.Cx_kdH4q.js";import{_ as g,a as F,b as y}from"./uni-td.B3Sq6FHr.js";import{_ as I}from"./uni-table.CMkDOYII.js";import{f as T}from"./date-format.Dm3Q97cL.js";import"./k3cloudapi.DzDu3BGl.js";import"./stock_loc.BckAHwoS.js";import{I as O}from"./inv_log.BJcJnepW.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-datetime-picker.D11eskE5.js";import"./uni-icons.DEYikQDp.js";const w=j({data:()=>({inv_logs:[],refresh_interval:null,refresh_interval_progress:0,last_timestamp:Number(new Date(T(Date.now(),"yyyy-MM-dd"))),op_type_dict:O.FOpTypeEnum,stocks:[{id:103409,code:"WL01",name:"汽油机材料库",active:!1,in:0,out:0,op:0},{id:2970623,code:"WL02",name:"变频机材料库",active:!1,in:0,out:0,op:0},{id:103414,code:"WL03",name:"面板材料库",active:!1,in:0,out:0,op:0},{id:103410,code:"WL04",name:"柴油机材料库",active:!1,in:0,out:0,op:0},{id:103416,code:"WL05",name:"内燃机包材辅料库",active:!1,in:0,out:0,op:0},{id:103415,code:"WL06",name:"内燃机原料库",active:!1,in:0,out:0,op:0},{id:103413,code:"WL07",name:"喷漆材料库",active:!1,in:0,out:0,op:0},{id:1478700,code:"WL08",name:"机架成品库",active:!1,in:0,out:0,op:0}],stock_index:{103409:0,2970623:1,103414:2,103410:3,103416:4,103415:5,103413:6,1478700:7}}),onUnload(){this.refresh_interval&&clearInterval(this.refresh_interval)},mounted(){this.refresh_interval=setInterval((()=>{let t=Date.now()-this.last_timestamp;this.refresh_interval_progress=100*t/6e4,t>6e4&&this.load_inv_logs()}),50)},computed:{inv_logs_filtered(){let t=this.stocks.find((t=>t.active));return t?this.inv_logs.filter((e=>e.FStockId===t.id)):this.inv_logs}},methods:{formatDate:T,click_stock(t){for(let e of this.stocks)e.id===t.id?e.active=!e.active:e.active=!1},async load_inv_logs(){let t={FStockId_in:this.stocks.map((t=>t.id))};t.FCreateTime_ge=T(this.last_timestamp,"yyyy-MM-dd hh:mm:ss.SSS"),this.last_timestamp=Date.now(),O.query(t,{order:"FID DESC"}).then((t=>{for(let e of t.data)this.inv_logs.push(e),"in"==e.FOpType&&(this.stocks[this.stock_index[e.FStockId]].in+=e.FOpQTY),"out"==e.FOpType&&(this.stocks[this.stock_index[e.FStockId]].out+=e.FOpQTY),"mv_in"!=e.FOpType&&(this.stocks[this.stock_index[e.FStockId]].op+=1)}))}}},[["render",function(T,O,j,w,x,S){const L=c,b=f,C=i,D=h(t("uni-card"),m),W=h(t("uni-col"),v),M=h(t("uni-row"),k),N=h(t("uni-th"),g),Q=h(t("uni-tr"),F),U=h(t("uni-td"),y),Y=h(t("uni-table"),I);return s(),e(C,{class:"bg"},{default:a((()=>[l(L,{percent:x.refresh_interval_progress,"stroke-width":"2"},null,8,["percent"]),l(M,{gutter:10},{default:a((()=>[l(W,{span:8},{default:a((()=>[l(M,null,{default:a((()=>[(s(!0),n(d,null,o(x.stocks,((t,i)=>(s(),e(W,{span:12,key:i,onClick:e=>S.click_stock(t)},{default:a((()=>[l(D,{margin:"10px",spacing:"10px",padding:"0",class:u([t.active?"active":""])},{default:a((()=>[l(C,{class:u(["stock-name",[t.active?"active":""]])},{default:a((()=>[l(b,{class:"uni-mr-5"},{default:a((()=>[r(_(t.code),1)])),_:2},1024),l(b,null,{default:a((()=>[r(_(t.name),1)])),_:2},1024)])),_:2},1032,["class"]),l(C,{class:"stock-info"},{default:a((()=>[l(b,{class:"uni-mr-5"},{default:a((()=>[r("入库量")])),_:1}),l(b,null,{default:a((()=>[r(_(t.in),1)])),_:2},1024)])),_:2},1024),l(C,{class:"stock-info"},{default:a((()=>[l(b,{class:"uni-mr-5"},{default:a((()=>[r("出库量")])),_:1}),l(b,null,{default:a((()=>[r(_(t.out),1)])),_:2},1024)])),_:2},1024),l(C,{class:"stock-info"},{default:a((()=>[l(b,{class:"uni-mr-5"},{default:a((()=>[r("操作数")])),_:1}),l(b,null,{default:a((()=>[r(_(t.op),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),l(W,{span:16},{default:a((()=>[l(D,{margin:"10px",spacing:"0",padding:"0",style:{height:"calc(100vh - 20px)","overflow-y":"scroll"}},{default:a((()=>[l(Y,{ref:"table"},{default:a((()=>[l(Q,{onClick:O[0]||(O[0]=t=>T.$logger.info(">>>",T.$data))},{default:a((()=>[l(N,{align:"center"},{default:a((()=>[r("时间")])),_:1}),l(N,{align:"center",width:"110"},{default:a((()=>[r("仓库")])),_:1}),l(N,{align:"center"},{default:a((()=>[r("物料编码")])),_:1}),l(N,{align:"center"},{default:a((()=>[r("物料名称")])),_:1}),l(N,{align:"center"},{default:a((()=>[r("规格型号")])),_:1}),l(N,{align:"center",width:"80"},{default:a((()=>[r("操作")])),_:1}),l(N,{align:"center",width:"60"},{default:a((()=>[r("数量")])),_:1}),l(N,{align:"center",width:"50"},{default:a((()=>[r("单位")])),_:1}),l(N,{align:"center"},{default:a((()=>[r("员工")])),_:1})])),_:1}),(s(!0),n(d,null,o(S.inv_logs_filtered,((t,i)=>(s(),e(Q,{key:i},{default:a((()=>[l(U,{title:t.FCreateTime},{default:a((()=>[r(_(S.formatDate(t.FCreateTime,"hh:mm:ss")),1)])),_:2},1032,["title"]),l(U,null,{default:a((()=>[r(_(t["FStockId.FName"]),1)])),_:2},1024),l(U,null,{default:a((()=>[r(_(t["FMaterialId.FNumber"]),1)])),_:2},1024),l(U,null,{default:a((()=>[r(_(t["FMaterialId.FName"]),1)])),_:2},1024),l(U,null,{default:a((()=>[r(_(t["FMaterialId.FSpecification"]),1)])),_:2},1024),l(U,null,{default:a((()=>[["in","add"].includes(t.FOpType)?(s(),e(C,{key:0,class:"text-error"},{default:a((()=>[r(_(x.op_type_dict[t.FOpType]),1)])),_:2},1024)):p("",!0),["out","sub"].includes(t.FOpType)?(s(),e(C,{key:1,class:"text-primary"},{default:a((()=>[r(_(x.op_type_dict[t.FOpType]),1)])),_:2},1024)):p("",!0),["mv_in","mv_out"].includes(t.FOpType)?(s(),e(C,{key:2},{default:a((()=>[r(_(x.op_type_dict[t.FOpType]),1)])),_:2},1024)):p("",!0)])),_:2},1024),l(U,null,{default:a((()=>[r(_(t.FOpQTY),1)])),_:2},1024),l(U,null,{default:a((()=>[r(_(t["FStockUnitId.FName"]),1)])),_:2},1024),l(U,null,{default:a((()=>[r(_(t.FOpStaffNo),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-7fc61568"]]);export{w as default};
