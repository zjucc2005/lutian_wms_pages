import{s as o,P as t,m as s,n as e,a as n,h as i,b as a,c as r,q as c,e as _,w as l,F as u,i as d,o as p}from"./index-Bu7BB2Sn.js";import{_ as f}from"./cc-shelf.Dh7yom9x.js";import{r as h}from"./uni-app.es.DqvpptM9.js";import{_ as m}from"./uni-section.CtzwYLr2.js";import{_ as g}from"./uni-goods-nav.Dt0enr9c.js";import{p as v}from"./index.CjPNc-2-.js";import"./k3cloudapi.cCLE6bXq.js";import{S as k,I as b}from"./stock_loc.Bg1Allw4.js";import"./inv_log.CiTZZpLf.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-list-item.BEmCCMNu.js";import"./uni-icons.BaZHZ2F1.js";import"./uni-badge.BY_L8vwX.js";import"./uni-list.CGDR7gg4.js";import"./uni-grid.B-HY4VwS.js";import"./uni-collapse.B0l431sv.js";import"./uni-drawer.CQyJTWnA.js";const F=j({components:{ccShelf:f},data:()=>({invs:[],cc_shelf_open:!0,last_refresh_time:0,refresh_interval:3e4,goods_nav:{options:[{icon:"refreshempty",text:"刷新"},{icon:"up",text:"折叠"}],button_group:[{text:"新增库位",backgroundColor:o.state.goods_nav_color.blue,color:"#fff"}]}}),onShow(){this._set_goods_nav()},onPullDownRefresh(){this.refresh(),t()},mounted(){k.query({FStockId:o.state.cur_stock.FStockId,FForbidStatus:"B"}).then((t=>{o.commit("update_stock_locs",t.data)}))},methods:{goods_nav_click(o){0===o.index&&this.refresh(),1===o.index&&this.toggle_cc_shelf()},goods_nav_button_click(t){"wh_admin"==o.state.role&&0===t.index&&this.new_loc_no()},if_inv_map(){s({title:"注意事项",content:"库存地图需要加载所有库存数据，当数据量较大时，可能会需要较长时间。确定要加载吗？",success:o=>{o.confirm&&this.load_invs()},fail:o=>{}})},new_loc_no(){v("success"),e({url:"/pages/operation/manage/loc_new"})},async load_invs(){const t={FStockId:o.state.cur_stock.FStockId};return n({title:"Loading"}),b.get_all(t).then((o=>{i(),v("success"),this.invs=o}))},async refresh(){if(!(this.last_refresh_time+this.refresh_interval>Date.now()))return n({title:"Loading"}),k.query({FStockId:o.state.cur_stock.FStockId}).then((t=>{o.commit("set_stock_locs",t.data),this.last_refresh_time=Date.now(),a({title:"已刷新"})}));a({icon:"none",title:"请不要频繁刷新"})},toggle_cc_shelf(){this.cc_shelf_open?(this.cc_shelf_open=!1,this.goods_nav.options[1].icon="down",this.goods_nav.options[1].text="展开"):(this.cc_shelf_open=!0,this.goods_nav.options[1].icon="up",this.goods_nav.options[1].text="折叠")},_forbid_loc_nos:()=>o.state.stock_locs.filter((o=>"B"==o.FForbidStatus)).map((o=>o.FNumber)),_set_goods_nav(){"wh_admin"==o.state.role?this.goods_nav.button_group=[{text:"新增库位",backgroundColor:o.state.goods_nav_color.blue,color:"#fff"}]:this.goods_nav.button_group=[{text:"",backgroundColor:"#fff",color:"#fff"}]}}},[["render",function(o,t,s,e,n,i){const a=h(r("cc-shelf"),f),v=h(r("uni-section"),m),k=h(r("uni-goods-nav"),g),b=d;return p(),c(u,null,[_(v,{title:"当前仓库",type:"square","sub-title":[o.$store.state.cur_stock["FUseOrgId.FName"],o.$store.state.cur_stock["FGroup.FName"]||"未分组",o.$store.state.cur_stock.FName].join(" / "),"sub-title-color":"#007aff",class:"above-uni-goods-nav"},{default:l((()=>[_(a,{stock_locs:o.$store.state.stock_locs,invs:n.invs,open:n.cc_shelf_open,forbidable:""},null,8,["stock_locs","invs","open"])])),_:1},8,["sub-title"]),_(b,{class:"uni-goods-nav-wrapper"},{default:l((()=>[_(k,{options:n.goods_nav.options,"button-group":n.goods_nav.button_group,fill:o.$store.state.goods_nav_fill,onClick:i.goods_nav_click,onButtonClick:i.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)}]]);export{F as default};
