import{s as t,m as o,n,b as s,a,h as u,p as e,c as i,d as _,w as l,i as r,o as d,e as c,q as b,u as m,F as f,g as k}from"./index-CqdXm0r7.js";import{_ as p}from"./uni-easyinput.Nqewt57l.js";import{r as h}from"./uni-app.es.D0fJ2kcT.js";import{_ as g,a as v}from"./uni-forms.ba5bQ_tw.js";import{_ as x}from"./uni-section.DKwkJd1U.js";import{_ as j}from"./uni-list-item.Dzmn-3-a.js";import{_ as y}from"./uni-list.CUX66DwN.js";import{_ as C}from"./uni-goods-nav.CDNwxccE.js";import{K as I}from"./k3cloudapi.BjBFa2ll.js";import{p as E}from"./index.DXIG_Tpn.js";import{O as F}from"./outbound_task.pwdJfxU0.js";import"./stock_loc.B6bAmQXk.js";import"./inv_log.EW53o3V_.js";import{s as N}from"./scan_code.Bv2D0h8k.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.KMw0mbbD.js";import"./uni-badge.Wm6ZM3Cx.js";const D=B({data:()=>({cur_outbound_task:{},outbound_task_form:{bill_no:"",outbound_list:[]},outbound_task_form_rules:{bill_no:{rules:[{required:!0,errorMessage:"单据编号不能为空"},{minLength:8,errorMessage:"单据编号不能小于8位"}]}},goods_nav:{options:[{icon:"search",text:"查询"}],button_group:[{text:"扫码",backgroundColor:"linear-gradient(90deg, #FE6035, #EF1224)",color:"#fff"},{text:"新建出库任务",backgroundColor:"linear-gradient(90deg, #1E83FF, #0053B8)",color:"#fff"}],options_2:[{icon:"bars",text:"详情"}],button_group_2:[{text:"结束出库任务",backgroundColor:"linear-gradient(90deg, #999, #606266)",color:"#fff"},{text:"继续出库任务",backgroundColor:"linear-gradient(90deg, #1E83FF, #0053B8)",color:"#fff"}]}}),onShow(){this.cur_outbound_task=F.current()||{},this.cur_outbound_task.stock_id&&this.cur_outbound_task.stock_id!=t.state.cur_stock.FStockId&&o({title:"注意",content:"本机中有其他仓库的出库任务，不能操作，将终止此出库任务",showCancel:!1,success:t=>{t.confirm&&this.finish_outbound_task()}})},methods:{goods_nav_click(t){0===t.index&&this.get_outbound_list_by_bill_no()},goods_nav_button_click(t){0===t.index&&this.scan_code(),1===t.index&&this.create_outbound_task()},goods_nav_click_2(t){0===t.index&&n({url:"/pages/operation/outbound/v1/task"})},goods_nav_button_click_2(t){0===t.index&&this.if_finish_outbound_task(),1===t.index&&this.continue_outbound_task()},handle_bill_no_change(){this.get_outbound_list_by_bill_no()},handle_bill_no_clear(){this.outbound_task_form.outbound_list=[]},scan_code(){N().then((t=>{this.handle_scan_code(t.result)})).catch((t=>{s({icon:"none",title:t})}))},handle_scan_code(t){this.outbound_task_form.bill_no=t,t&&this.get_outbound_list_by_bill_no()},get_outbound_list_by_bill_no(){const t=this.outbound_task_form.bill_no;t&&(t.startsWith("FHTZD")?(a({title:"Loading"}),I.view("SAL_DELIVERYNOTICE",{Number:t}).then((t=>{this.handle_fhtzd_data(t),u()}))):(this.outbound_task_form.outbound_list=[],s({icon:"none",title:"未找到单据信息"})))},handle_fhtzd_data(t){var o;if(t.data.Result.ResponseStatus.IsSuccess){const o=t.data.Result.Result;let n=[];o.SAL_DELIVERYNOTICEENTRY.forEach((t=>{var o,s,a;n.push({material_no:t.MaterialID.Number,material_name:null==(o=t.MaterialID.Name[0])?void 0:o.Value,material_spec:null==(s=t.MaterialID.Specification[0])?void 0:s.Value,base_unit_qty:t.BaseUnitQty,base_unit_name:null==(a=t.BaseUnitID.Name[0])?void 0:a.Value,base_unit_no:t.BaseUnitID.Number})})),this.outbound_task_form.outbound_list=n}else this.outbound_task_form.outbound_list=[],s({icon:"none",title:null==(o=t.data.Result.ResponseStatus.Errors[0])?void 0:o.Message})},create_outbound_task(){this.$refs.outbound_task_form.validate().then((o=>{E("success");const s={stock_id:t.state.cur_stock.FStockId,staff_no:t.state.cur_staff.FNumber,bill_no:this.outbound_task_form.bill_no,outbound_list:this.outbound_task_form.outbound_list};let a=new F(s);a.save(),this.cur_outbound_task=a,n({url:"/pages/operation/outbound/v1/allocate"})})).catch((t=>{}))},continue_outbound_task(){E("success"),n({url:"/pages/operation/outbound/v1/allocate"})},if_finish_outbound_task(){e({itemList:["结束出库任务"],success:t=>{0===t.tapIndex&&this.finish_outbound_task()}})},finish_outbound_task(){F.destroy_all(),this.cur_outbound_task={},this.outbound_task_form={bill_no:"",outbound_list:[]}}}},[["render",function(t,o,n,s,a,u){const e=h(i("uni-easyinput"),p),I=h(i("uni-forms-item"),g),E=h(i("uni-forms"),v),F=r,N=h(i("uni-section"),x),B=h(i("uni-list-item"),j),D=h(i("uni-list"),y),R=h(i("uni-goods-nav"),C);return a.cur_outbound_task.bill_no?(d(),_(F,{key:1},{default:l((()=>[c(N,{title:"进行中的出库任务","sub-title":a.cur_outbound_task.bill_no,type:"line"},{default:l((()=>[c(D,null,{default:l((()=>[(d(!0),b(f,null,m(a.cur_outbound_task.outbound_list,((t,o)=>(d(),_(B,{key:o,title:t.material_no,note:[t.material_name,t.material_spec].join("\n"),rightText:[t.base_unit_qty,t.base_unit_name].join(" ")},null,8,["title","note","rightText"])))),128))])),_:1})])),_:1},8,["sub-title"]),c(F,{class:"uni-goods-nav-wrapper"},{default:l((()=>[c(R,{options:a.goods_nav.options_2,"button-group":a.goods_nav.button_group_2,onClick:u.goods_nav_click_2,onButtonClick:u.goods_nav_button_click_2},null,8,["options","button-group","onClick","onButtonClick"])])),_:1})])),_:1})):(d(),_(F,{key:0},{default:l((()=>{var t;return[c(N,{title:"出库设定",type:"line"},{default:l((()=>[c(F,{class:"container"},{default:l((()=>[c(E,{ref:"outbound_task_form",model:a.outbound_task_form,rules:a.outbound_task_form_rules,labelWidth:"80px"},{default:l((()=>[c(I,{label:"单据编号",name:"bill_no",required:""},{default:l((()=>[c(e,{modelValue:a.outbound_task_form.bill_no,"onUpdate:modelValue":o[0]||(o[0]=t=>a.outbound_task_form.bill_no=t),prefixIcon:"search",trim:"both",onChange:u.handle_bill_no_change,onClear:u.handle_bill_no_clear},null,8,["modelValue","onChange","onClear"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1}),(null==(t=a.outbound_task_form.outbound_list)?void 0:t.length)?(d(),_(N,{key:0,title:"出库物料信息",type:"line",style:{"padding-bottom":"60px"}},{default:l((()=>[c(D,null,{default:l((()=>[(d(!0),b(f,null,m(a.outbound_task_form.outbound_list,((t,o)=>(d(),_(B,{key:o,title:t.material_no,note:[t.material_name,t.material_spec].join("\n"),rightText:[t.base_unit_qty,t.base_unit_name].join(" ")},null,8,["title","note","rightText"])))),128))])),_:1})])),_:1})):k("",!0),c(F,{class:"uni-goods-nav-wrapper"},{default:l((()=>[c(R,{options:a.goods_nav.options,"button-group":a.goods_nav.button_group,onClick:u.goods_nav_click,onButtonClick:u.goods_nav_button_click},null,8,["options","button-group","onClick","onButtonClick"])])),_:1})]})),_:1}))}]]);export{D as default};
