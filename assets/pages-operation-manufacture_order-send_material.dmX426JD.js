var e=Object.defineProperty,t=(t,a,l)=>(((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(t,"symbol"!=typeof a?a+"":a,l),l);import{s as a,P as l,N as i,ax as o,b as s,m as r,R as _,v as n,n as d,a as m,h as u,c,q as p,F as f,e as h,w as b,d as y,g,i as F,o as k,f as v,u as I,t as N,S as C,l as q,k as w,T as M,ay as S,Q as x,y as V}from"./index-DsK9pIyj.js";import{_ as B}from"./uni-easyinput.BfazFYzq.js";import{r as O}from"./uni-app.es.CSK8ITuj.js";import{_ as $}from"./uni-icons.DRoE6XYp.js";import{_ as j}from"./uni-list-item.BkmqxiQh.js";import{_ as D}from"./uni-list.dJf-6p1_.js";import{_ as R}from"./uni-card.CdeHcnQF.js";import{_ as U}from"./uni-section.BpQrEx4g.js";import{_ as T}from"./uni-load-more.CyJx3ZKG.js";import{_ as P,a as L}from"./uni-forms.DoSYlyoS.js";import{_ as E}from"./uni-tag.DapJ5B6u.js";import{_ as Q}from"./uni-goods-nav.BN-nj5na.js";import{_ as z}from"./uni-drawer.BPNIP2eu.js";import{_ as Y,a as K}from"./uni-swipe-action.BTWqdF-e.js";import{a as X,_ as A}from"./uni-popup.CPWlX1tX.js";import{_ as W}from"./uni-data-select.DcISTJAW.js";import{K as G}from"./k3cloudapi.PCDjx1SF.js";import{p as H,b as J}from"./index.uHoH2c2-.js";import"./stock_loc.Bj3C3Byx.js";import"./inv_log.D0BShjlW.js";import{I as Z}from"./issuemtr_log.Bkb3IULO.js";import{a as ee,b as te}from"./index.DEl4oXeA.js";import{f as ae}from"./date-format.Dm3Q97cL.js";import{s as le}from"./scan_code.CGa79-3n.js";import{_ as ie}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-badge.CO78OwkC.js";import"./bd_empinfo.DSF0B_p6.js";class oe{constructor(){}static query(e={},t={}){const a={FormId:this.form_id,FieldKeys:["FID","FDate","FBillNo","FSaleOrderNo","FStatus","FPrdOrgId.FName","F_LT_CX.FName","FMaterialId.FNumber","FMaterialId.FName","FMaterialId.FName","FMaterialId.FSpecification"].join(","),FilterString:G.query_filter(e)};return t.per_page&&(a.Limit=t.per_page,t.page&&(a.StartRow=(t.page-1)*t.per_page)),t.order&&(a.OrderString=t.order),G.bill_query(a)}static find(e){return this.query({FID:e},{limit:1})}static view(e){return"number"==typeof e?G.view(this.form_id,{Id:e}):G.view(this.form_id,{Number:e})}}t(oe,"form_id","PRD_MO"),t(oe,"FStatusEnum",{1:"计划",2:"计划确认",3:"下达",4:"开工",5:"完工",6:"结案",7:"结算"});const se=ie({props:{t:{type:String,default:"send"}},data(){return{step:"bill",op_type:"send",bd_materials:[],bd_suppliers:[],bills:[],bills_combi:{materials:[]},prd_mos_visible:!1,prd_mos:[],prd_mo_search_form:{page:1,per_page:20,bill_no:"",sale_order_no:"",status:"4"},prd_mo_status_dict:oe.FStatusEnum,prd_mo_load_more_status:"more",issuemtr_logs:[],unplanned_materials:[],no:"",form:{},form_rules:{material_no:{rules:[{required:!0,errorMessage:"物料编码不能为空"},{validateFunction:(e,t,a,l)=>{if(!this.form.material_id)return l("未找到此物料编码")}}]},supplier_no:{rules:[{required:!0,errorMessage:"供应商编码不能为空"},{validateFunction:(e,t,a,l)=>{if(!this.form.supplier_id)return l("未找到此供应商编码")}}]},batch_no:{rules:[{required:!0,errorMessage:"批次号不能为空"}]},op_qty:{rules:[{required:!0,errorMessage:"数量不能为空"},{format:"number",errorMessage:"数量只能输入数字"},{validateFunction:(e,t,a,l)=>t<=0?l("数量必须大于0"):this.form.decimal_unit||Number.isInteger(t)?void 0:l("数量必须为整数")}]}},swipe_options:[{text:"取消",style:{backgroundColor:"#dd524d"}}],goods_nav:{options:[{icon:"right",text:"物料"},{icon:"up",text:"单据",info:0},{icon:"left",text:"日志"}],button_group:[{text:"查询生产订单",color:"#fff",backgroundColor:a.state.goods_nav_color.green},{text:"扫码",color:"#fff",backgroundColor:a.state.goods_nav_color.red}]}}},onPullDownRefresh(){l()},onReachBottom(){this.prd_mo_load_more()},onLoad(e){e.t&&(this.op_type=e.t,setTimeout((e=>{i({title:"生产订单 - "+("receive"==this.op_type?"用料":"发料")}),o({frontColor:"#ffffff",backgroundColor:"receive"==this.op_type?"#FE6035":"#1E83FF",animation:{duration:400,timingFunc:"easeIn"}})}),0))},mounted(){this._init_form()},methods:{formatDate:ae,after_scan_code(e){if(e=e.trim()){if("bill"==this.step){for(let t of e.split("||")){if(t.match(/^SCFLTZD\d+$/))return void("send"==this.op_type?this.load_scfltzd(t):s({icon:"none",title:"未知单据类型"}));if(t.match(/^PPBOM\d+$/))return void this.load_ppbom(t);if(t.match(/^102\d{10}$/))return void this.load_ppbom_by_mo(t)}s({icon:"none",title:"未知格式单据编号"})}if("material"==this.step){let t=e.split("||");this.form.material_no=t[0],this.form.supplier_no=t[1],this.form.batch_no=t[2],this.material_no_change(),this.supplier_no_change(),this.form.op_qty_focus=!0}}},bills_add(e){this.bills.some((t=>t.bill_no==e.bill_no))||(this.bills.length>=5?s({icon:"none",title:"最多合并5个单据"}):(this.bills.push(e),this._after_update_bills()))},bills_del(e){let t=this.bills.findIndex((t=>t.bill_no==e.bill_no));t>-1&&(this.bills.splice(t,1),this._after_update_bills(),0===this.bills.length&&this.$refs.bill_popup.close())},bills_combine_and_next(){let e=[];for(let t of this.bills)for(let a of t.materials){let t=e.find((e=>e.material_id==a.material_id));t?(t.base_unit_qty+=a.base_unit_qty,t.unit_qty+=a.unit_qty):e.push({...a})}this.bills_combi.materials=e,this._activate_step("material"),this.$refs.bill_popup.close(),this.load_issuemtr_logs()},checkbox_click(e){let t=this.bills_combi.materials.find((t=>t.material_id==e));t&&(t.checked=!t.checked)},goods_nav_click(e){0===e.index&&"material"==this.step&&this.$refs.detail_drawer.open(),1===e.index&&(this.bills.length?this.$refs.bill_popup.open():s({icon:"none",title:"请先添加单据"})),2===e.index&&"material"==this.step&&this.$refs.log_drawer.open(),this.$logger.info(this.$data)},goods_nav_button_click(e){0===e.index&&("bill"==this.step&&this.$refs.prd_mo_search_dialog.open(),"material"==this.step&&this.if_go_back()),1===e.index&&this.scan_code()},icon_click(e){"prefix"==e&&this.scan_code()},if_go_back(){r({title:"返回",content:"确认返回上一步吗？",success:e=>{e.confirm&&(H("delete"),"bill"==this.step?_():"material"==this.step&&(this._activate_step("bill"),this.no=""))}})},material_no_change(){if(this.form.material_id="",this.form.material_name="",this.form.base_unit_name="Pcs",this.form.decimal_unit=!1,!this.form.material_no)return;let e=this.bills_combi.materials.find((e=>e.material_no==this.form.material_no));if(e)return this.form.material_id=e.material_id,this.form.material_name=e.material_name,this.form.base_unit_name=e.base_unit_name,void(this.form.decimal_unit=J(e.base_unit_name));let t=this.bd_materials.find((e=>e.FNumber==this.form.material_no));if(t)return this.form.material_id=t.FMaterialId,this.form.material_name=t.FName,this.form.base_unit_name=t["FBaseUnitId.FName"],void(this.form.decimal_unit=J(t["FBaseUnitId.FName"]));ee(this.form.material_no,a.state.cur_stock.FUseOrgId).then((e=>{e.data.length&&(this.bd_materials.push(e.data[0]),this.form.material_id=e.data[0].FMaterialId,this.form.material_name=e.data[0].FName,this.form.base_unit_name=e.data[0]["FBaseUnitId.FName"],this.form.decimal_unit=J(e.data[0]["FBaseUnitId.FName"]))}))},prd_mo_load_more(){"nomore"!=this.prd_mo_load_more_status&&(this.prd_mo_search_form.page+=1,this.load_prd_mos())},prd_mo_search_dialog_close(){this.$refs.prd_mo_search_dialog.close()},prd_mo_search_dialog_confirm(){this.prd_mos=[],this.prd_mo_load_more_status="more",this.prd_mo_search_form.page=1,this.load_prd_mos(),this.prd_mo_search_dialog_close(),n({scrollTop:0})},supplier_no_change(){if(this.form.supplier_id="",this.form.supplier_name="",!this.form.supplier_no)return;let e=this.bd_suppliers.find((e=>e.FNumber==this.form.supplier_no));if(e)return this.form.supplier_id=e.FSupplierId,void(this.form.supplier_name=e.FName);te(this.form.supplier_no,a.state.cur_stock.FUseOrgId).then((e=>{e.data.length&&(this.bd_suppliers.push(e.data[0]),this.form.supplier_id=e.data[0].FSupplierId,this.form.supplier_name=e.data[0].FName)}))},scan_code(){le().then((e=>{this.after_scan_code(e.result)})).catch((e=>{s({icon:"none",title:e})}))},search(){this.after_scan_code(this.no)},show_material(e){e||s({icon:"none",title:"物料ID不能为空"}),d({url:`/pages/operation/material/show?id=${e}`})},async load_issuemtr_logs(){let e={FBillNo_in:this.bills.map((e=>e.bill_no)),FOpType:this.op_type};m({title:"Loading"});let t=await Z.query(e,{order:"FID DESC"});u(),this.issuemtr_logs=t.data,this._calc_done_qty()},async load_ppbom(e){var t,a,l,i;try{if(this.no="",this.bills.some((t=>t.bill_no==e)))return void s({icon:"none",title:"重复添加单据"});m({title:"Loading"});let o=await G.view("PRD_PPBOM",{Number:e});if(u(),o.data.Result.ResponseStatus.IsSuccess){let e=o.data.Result.Result,i=[];for(let o of e.PPBomEntry){let e=i.find((e=>e.material_id==o.MaterialID.Id));e?(e.base_unit_qty+=o.BaseStdQty,e.unit_qty+=o.StdQty):i.push({material_id:o.MaterialID.Id,material_no:o.MaterialID.Number,material_name:null==(t=o.MaterialID.Name[0])?void 0:t.Value,material_spec:null==(a=o.MaterialID.Specification[0])?void 0:a.Value,base_unit_qty:o.BaseStdQty,base_unit_name:null==(l=o.BaseUnitID.Name[0])?void 0:l.Value,unit_qty:o.StdQty,unit_name:o.UnitID.Name[0].Value,checked:!1,op_qty:0})}this.bills_add({category:"ppbom",bill_no:e.BillNo,mo_bill_no:e.MOBillNO,material_no:e.MaterialID.Number,material_name:e.MaterialID.Name[0].Value,material_spec:e.MaterialID.Specification[0].Value,materials:i})}else s({icon:"none",title:null==(i=o.data.Result.ResponseStatus.Errors[0])?void 0:i.Message})}catch(o){}},async load_ppbom_by_mo(e){if(this.no="",this.bills.some((t=>t.mo_bill_no==e)))return void s({icon:"none",title:"重复添加单据"});let t={FormId:"PRD_PPBOM",FieldKeys:"FBillNo,FMOBillNO",FilterString:[{Left:"",FieldName:"FMOBillNO",Compare:"67",Value:e,Right:"",Logic:0}]},a=await G.bill_query(t);a.data.length?this.load_ppbom(a.data[0].FBillNo):s({icon:"none",title:"未知单据编号"})},async load_prd_mos(){let e={FStatus:"4"};this.prd_mo_search_form.bill_no&&(e.FBillNo_cont=this.prd_mo_search_form.bill_no),this.prd_mo_search_form.sale_order_no&&(e.FSaleOrderNo_lk=this.prd_mo_search_form.sale_order_no),this.prd_mo_search_form.chanxian2&&(e["F_LT_CX.FName_lk"]=this.prd_mo_search_form.chanxian2);let t={order:"FID DESC",page:this.prd_mo_search_form.page,per_page:this.prd_mo_search_form.per_page};m({title:"Loading"}),this.prd_mo_load_more_status="loading";let a=await oe.query(e,t);u(),this.prd_mo_load_more_status=a.data.length<this.prd_mo_search_form.per_page?"nomore":"more",a.data.forEach((e=>this.prd_mos.push(e))),this.prd_mos_visible=!0},async load_scfltzd(e){var t,l,i,o;try{if(this.no="",this.bills.some((t=>t.bill_no==e)))return void s({icon:"none",title:"重复添加单据"});m({title:"Loading"});let r=await G.view("PRD_ISSUEMTRNOTICE",{Number:e});if(u(),r.data.Result.ResponseStatus.IsSuccess){let e=r.data.Result.Result;if(e.PrdOrgId_Id!=a.state.cur_stock.FUseOrgId)return void s({icon:"none",title:"生产组织不一致"});let o=[];for(let a of e.SUMEntity)o.push({material_id:a.ChildMtr.Id,material_no:a.ChildMtr.Number,material_name:null==(t=a.ChildMtr.Name[0])?void 0:t.Value,material_spec:null==(l=a.ChildMtr.Specification[0])?void 0:l.Value,base_unit_qty:a.BasePlanIssueQty,base_unit_name:null==(i=a.BaseSumUnitId.Name[0])?void 0:i.Value,unit_qty:a.PlanIssueQty,unit_name:a.SumUnitId.Name[0].Value});this.bills_add({category:"scfltzd",bill_no:e.BillNo,mo_bill_no:e.MOBillNO,materials:o})}else s({icon:"none",title:null==(o=r.data.Result.ResponseStatus.Errors[0])?void 0:o.Message})}catch(r){}},async submit_cancel(e){try{if(new Date(e.FCreateTime)<Date.now()-864e5)return void s({icon:"none",title:"历史数据不能取消"});return m({title:"Loading"}),new Z(e).cancel(a.state.cur_staff.FNumber).then((e=>{var t;u(),e.data.Result.ResponseStatus.IsSuccess?(H("delete"),this.$refs.log_swipe.closeAll(),this.load_issuemtr_logs()):s({icon:"none",title:null==(t=e.data.Result.ResponseStatus.Errors[0])?void 0:t.Message})}))}catch(t){}},async submit_save(){try{if(await this.$refs.form.validate(),this.bills_combi.materials.find((e=>e.material_id==this.form.material_id))){let e=this.form.op_qty,t=[];for(let a of this.bills){if(e<=0)break;let l=a.materials.find((e=>e.material_id==this.form.material_id));if(!l)continue;if(l.done_qty>=l.base_unit_qty)continue;let i=Math.min(e,l.base_unit_qty-l.done_qty);t.push({bill_no:a.bill_no,op_qty:i}),e-=i}if(e>0){let a=t.find((e=>e.bill_no==this.bills[0].bill_no));a?a.op_qty+=e:t.push({bill_no:this.bills[0].bill_no,op_qty:e})}for(let l of t){let e=new Z({FOpType:this.op_type,FStockId:a.state.cur_stock.FStockId,FMaterialId:this.form.material_id,FSupplierId:this.form.supplier_id,FOpQTY:l.op_qty,FBatchNo:this.form.batch_no,FBillNo:l.bill_no,FOpStaffNo:a.state.cur_staff.FNumber});await e.save()}}else{let e=new Z({FOpType:this.op_type,FStockId:a.state.cur_stock.FStockId,FMaterialId:this.form.material_id,FSupplierId:this.form.supplier_id,FOpQTY:this.form.op_qty,FBatchNo:this.form.batch_no,FBillNo:this.bills[0].bill_no,FOpStaffNo:a.state.cur_staff.FNumber});await e.save()}await this.load_issuemtr_logs(),this._init_form(),H("success")}catch(e){}},_activate_step(e){this.step=e,"bill"==e&&(this.goods_nav.button_group[0].text="查询生产订单",this.goods_nav.button_group[0].backgroundColor=a.state.goods_nav_color.green),"material"==e&&(this.goods_nav.button_group[0].text="返回",this.goods_nav.button_group[0].backgroundColor=a.state.goods_nav_color.grey)},_after_update_bills(){this.goods_nav.options[1].info=this.bills.length},_calc_done_qty(){for(let e of this.bills_combi.materials)e.done_qty=0;for(let e of this.bills)for(let t of e.materials)t.done_qty=0;this.unplanned_materials=[];for(let e of this.issuemtr_logs){let t=this.bills_combi.materials.find((t=>t.material_id==e.FMaterialId));if(t){t.done_qty+=e.FOpQTY;let a=this.bills.find((t=>t.bill_no==e.FBillNo));if(a){let t=a.materials.find((t=>t.material_id==e.FMaterialId));t&&(t.done_qty+=e.FOpQTY)}continue}let a=this.unplanned_materials.find((t=>t.material_id==e.FMaterialId));a?a.done_qty+=e.FOpQTY:this.unplanned_materials.push({material_id:e.FMaterialId,material_no:e["FMaterialId.FNumber"],material_name:e["FMaterialId.FName"],material_spec:e["FMaterialId.FSpecification"],base_unit_qty:0,base_unit_name:e["FStockUnitId.FName"],unit_qty:0,unit_name:e["FStockUnitId.FName"],done_qty:e.FOpQTY})}},_calc_percentage:e=>e.done_qty/e.base_unit_qty*100,_init_form(){this.form={material_id:"",material_no:"",material_name:"",supplier_no:"",supplier_id:"",supplier_name:"",batch_no:"",op_qty:"",op_qty_focus:!1,base_unit_name:"Pcs",decimal_unit:!1}},_is_mo_selected(e){return this.bills.some((t=>t.mo_bill_no==e))},_unplanned_material(e){return!this.bills_combi.materials.some((t=>t.material_id==e.FMaterialId))}}},[["render",function(e,t,a,l,i,o){const s=O(c("uni-easyinput"),B),r=F,_=O(c("uni-icons"),$),n=O(c("uni-list-item"),j),d=O(c("uni-list"),D),m=q,u=O(c("uni-card"),R),G=O(c("uni-section"),U),H=w,J=O(c("uni-load-more"),T),Z=O(c("uni-forms-item"),P),ee=O(c("uni-forms"),L),te=x,ae=O(c("uni-tag"),E),le=O(c("uni-goods-nav"),Q),ie=V,oe=M,se=O(c("uni-drawer"),z),re=O(c("uni-swipe-action-item"),Y),_e=O(c("uni-swipe-action"),K),ne=O(c("uni-popup"),X),de=O(c("uni-data-select"),W),me=O(c("uni-popup-dialog"),A);return k(),p(f,null,["bill"==i.step?(k(),p(f,{key:0},[h(G,{title:"扫描单据",type:"square","sub-title":"用料清单 / 生产订单"},{default:b((()=>[h(r,{class:"container"},{default:b((()=>[h(s,{modelValue:i.no,"onUpdate:modelValue":t[0]||(t[0]=e=>i.no=e),trim:"both","prefix-icon":"scan",onIconClick:o.icon_click,onConfirm:o.search,style:{height:"50px"}},null,8,["modelValue","onIconClick","onConfirm"]),i.bills.length?(k(),y(u,{key:0,title:"待提交单据",extra:`${i.bills.length} 个`,"is-shadow":!1,margin:"0",spacing:"0",padding:"0"},{actions:b((()=>[h(r,null,{default:b((()=>[h(m,{type:"primary",class:"card-form-btn",onClick:o.bills_combine_and_next},{default:b((()=>[h(_,{type:"checkmarkempty",color:"#fff"}),v(" 合并提交 ")])),_:1},8,["onClick"])])),_:1})])),default:b((()=>[h(d,{border:!1},{default:b((()=>[(k(!0),p(f,null,I(i.bills,((e,t)=>(k(),y(n,null,{body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[v(N(`${e.bill_no}${e.mo_bill_no?` / ${e.mo_bill_no}`:""}`),1)])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("类型："+N("scfltzd"==e.category?"生产发料通知单":"用料清单"),1)])),_:2},1024),"ppbom"==e.category?(k(),y(r,{key:0},{default:b((()=>[v("物料编码："+N(e.material_no),1)])),_:2},1024)):g("",!0),"ppbom"==e.category?(k(),y(r,{key:1},{default:b((()=>[v("物料名称："+N(e.material_name),1)])),_:2},1024)):g("",!0),"ppbom"==e.category?(k(),y(r,{key:2},{default:b((()=>[v("规格型号："+N(e.material_spec),1)])),_:2},1024)):g("",!0)])),_:2},1024)])),_:2},1024)])),footer:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[h(_,{type:"minus",size:"24",color:"#dd524d",onClick:t=>o.bills_del(e)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1},8,["extra"])):g("",!0)])),_:1})])),_:1}),i.prd_mos_visible?(k(),y(G,{key:0,title:"生产订单列表",type:"square",class:"above-uni-goods-nav"},{default:b((()=>[i.prd_mos.length?(k(),y(d,{key:0},{default:b((()=>[(k(!0),p(f,null,I(i.prd_mos,((e,t)=>(k(),y(n,{key:t,onClick:t=>o.load_ppbom_by_mo(e.FBillNo),clickable:"","show-arrow":""},{body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[o._is_mo_selected(e.FBillNo)?(k(),y(_,{key:0,type:"checkbox-filled",color:"#007aff"})):g("",!0),v(" "+N(e.FBillNo)+" / "+N(e.FSaleOrderNo),1)])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("生产组织："+N(e["FPrdOrgId.FName"]),1)])),_:2},1024),h(r,null,{default:b((()=>[v("产线2："+N(e["F.LT.CX.FName"]),1)])),_:2},1024),h(r,null,{default:b((()=>[v("物料编码："+N(e["FMaterialId.FNumber"]),1)])),_:2},1024),h(r,null,{default:b((()=>[v("物料名称："+N(e["FMaterialId.FName"]),1)])),_:2},1024),h(r,null,{default:b((()=>[v("规格型号："+N(e["FMaterialId.FSpecification"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[h(H,{class:"text-primary"},{default:b((()=>[v(N(i.prd_mo_status_dict[e.FStatus]),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):g("",!0),h(J,{status:i.prd_mo_load_more_status,onClickLoadMore:o.prd_mo_load_more},null,8,["status","onClickLoadMore"])])),_:1})):g("",!0)],64)):g("",!0),"material"==i.step?(k(),y(G,{key:1,title:"扫描物料",type:"square"},{default:b((()=>[h(r,{class:"container"},{default:b((()=>[h(ee,{ref:"form",model:i.form,rules:i.form_rules,labelWidth:"80px"},{default:b((()=>[h(Z,{label:"物料编码",name:"material_no"},{default:b((()=>[h(s,{modelValue:i.form.material_no,"onUpdate:modelValue":t[1]||(t[1]=e=>i.form.material_no=e),trim:"both","prefix-icon":"scan",onIconClick:o.icon_click,onChange:o.material_no_change,onClear:o.material_no_change},null,8,["modelValue","onIconClick","onChange","onClear"]),h(r,{class:"form-info"},{default:b((()=>[v(N(i.form.material_name),1)])),_:1})])),_:1}),h(Z,{label:"供应商",name:"supplier_no"},{default:b((()=>[h(s,{modelValue:i.form.supplier_no,"onUpdate:modelValue":t[2]||(t[2]=e=>i.form.supplier_no=e),trim:"both",onChange:o.supplier_no_change,onClear:o.supplier_no_change},null,8,["modelValue","onChange","onClear"]),h(r,{class:"form-info"},{default:b((()=>[v(N(i.form.supplier_name),1)])),_:1})])),_:1}),h(Z,{label:"批次号",name:"batch_no"},{default:b((()=>[h(s,{modelValue:i.form.batch_no,"onUpdate:modelValue":t[3]||(t[3]=e=>i.form.batch_no=e),trim:"both"},null,8,["modelValue"])])),_:1}),h(Z,{label:"数量",name:"op_qty"},{default:b((()=>[h(s,{modelValue:i.form.op_qty,"onUpdate:modelValue":t[4]||(t[4]=e=>i.form.op_qty=e),type:"number",focus:i.form.op_qty_focus},{right:b((()=>[h(H,{class:"easyinput-suffix-text"},{default:b((()=>[v(N(i.form.base_unit_name),1)])),_:1})])),_:1},8,["modelValue","focus"])])),_:1})])),_:1},8,["model","rules"]),h(m,{onClick:o.submit_save,type:"primary"},{default:b((()=>[h(_,{type:"checkmarkempty",color:"#fff"}),v(" 提交 ")])),_:1},8,["onClick"])])),_:1})])),_:1})):g("",!0),"material"==i.step?(k(),y(G,{key:2,title:"追踪物料列表",type:"square",class:"above-uni-goods-nav"},{right:b((()=>[h(r,{class:"uni-section__right"},{default:b((()=>[h(r,{onClick:t[5]||(t[5]=t=>e.$refs.log_drawer.open())},{default:b((()=>[h(_,{type:"left"}),v(" 日志 ")])),_:1})])),_:1})])),default:b((()=>[h(d,null,{default:b((()=>[(k(!0),p(f,null,I(i.bills_combi.materials.filter((e=>e.checked)),((e,t)=>(k(),y(n,{key:t},{body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[v(N(e.material_no)+" ",1),h(_,{type:"search",color:"#007aff",onClick:t=>o.show_material(e.material_id)},null,8,["onClick"])])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("名称："+N(e.material_name),1)])),_:2},1024),h(r,null,{default:b((()=>[v("规格："+N(e.material_spec),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[e.done_qty?(k(),y(H,{key:0,class:"text-primary"},{default:b((()=>[v(N(e.done_qty)+" "+N(e.base_unit_name),1)])),_:2},1024)):g("",!0),h(te,{percent:o._calc_percentage(e),"stroke-width":"2","active-color":100==o._calc_percentage(e)?"#4cd964":"#f0ad4e",active:!0},null,8,["percent","active-color"]),h(H,null,{default:b((()=>[v(N(e.base_unit_qty)+" "+N(e.base_unit_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),(k(!0),p(f,null,I(i.unplanned_materials,((e,t)=>(k(),y(n,{key:t},{body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[h(ae,{text:"计划外",type:"warning",size:"mini"}),v(" "+N(e.material_no)+" ",1),h(_,{type:"search",color:"#007aff",onClick:t=>o.show_material(e.material_id)},null,8,["onClick"])])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("名称："+N(e.material_name),1)])),_:2},1024),h(r,null,{default:b((()=>[v("规格："+N(e.material_spec),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[e.done_qty?(k(),y(H,{key:0,class:"text-primary"},{default:b((()=>[v(N(e.done_qty)+" "+N(e.base_unit_name),1)])),_:2},1024)):g("",!0),h(te,{percent:o._calc_percentage(e),"stroke-width":"2","active-color":100==o._calc_percentage(e)?"#4cd964":"#f0ad4e",active:!0},null,8,["percent","active-color"]),h(H,null,{default:b((()=>[v(N(e.base_unit_qty)+" "+N(e.base_unit_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):g("",!0),h(r,{class:"uni-goods-nav-wrapper"},{default:b((()=>[h(le,{options:i.goods_nav.options,"button-group":i.goods_nav.button_group,fill:e.$store.state.goods_nav_fill,onClick:o.goods_nav_click,onButtonClick:o.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1}),h(se,{ref:"detail_drawer",width:e.$store.state.drawer_width},{default:b((()=>[h(oe,{"scroll-y":"",style:{height:"100%"},onTouchmove:t[7]||(t[7]=C((()=>{}),["stop"]))},{default:b((()=>[h(G,{title:"子物料明细汇总",type:"square","sub-title":"勾选的物料会显示在追踪列表"},{right:b((()=>[h(r,{class:"uni-section__right"},{default:b((()=>[h(_,{type:"closeempty",size:"24",color:"#333",onClick:t[6]||(t[6]=t=>e.$refs.detail_drawer.close())})])),_:1})])),default:b((()=>[i.bills_combi.materials.length?(k(),y(d,{key:0},{default:b((()=>[(k(!0),p(f,null,I(i.bills_combi.materials,((e,t)=>(k(),y(n,{key:t},{header:b((()=>[h(r,{class:"uni-list-item__head"},{default:b((()=>[h(ie,{checked:e.checked,onClick:t=>o.checkbox_click(e.material_id)},null,8,["checked","onClick"])])),_:2},1024)])),body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[v(N(e.material_no)+" ",1),h(_,{type:"search",color:"#007aff",onClick:t=>o.show_material(e.material_id)},null,8,["onClick"])])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("名称："+N(e.material_name),1)])),_:2},1024),h(r,null,{default:b((()=>[v("规格："+N(e.material_spec),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[e.done_qty?(k(),y(H,{key:0,class:"text-primary"},{default:b((()=>[v(N(e.done_qty)+" "+N(e.base_unit_name),1)])),_:2},1024)):g("",!0),h(te,{percent:o._calc_percentage(e),"stroke-width":"2","active-color":100==o._calc_percentage(e)?"#4cd964":"#f0ad4e",active:!0},null,8,["percent","active-color"]),h(H,null,{default:b((()=>[v(N(e.base_unit_qty)+" "+N(e.base_unit_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):g("",!0)])),_:1})])),_:1})])),_:1},8,["width"]),h(se,{ref:"log_drawer",mode:"right",width:e.$store.state.drawer_width},{default:b((()=>[h(oe,{"scroll-y":"",style:{height:"100%"},onTouchmove:t[9]||(t[9]=C((()=>{}),["stop"]))},{default:b((()=>[h(G,{title:`${{send:"发料",receive:"用料"}[i.op_type]}日志`,type:"square","sub-title":"左滑可取消"},{right:b((()=>[h(r,{class:"uni-section__right"},{default:b((()=>[h(_,{type:"closeempty",size:"24",color:"#333",onClick:t[8]||(t[8]=t=>e.$refs.log_drawer.close())})])),_:1})])),default:b((()=>[h(_e,{ref:"log_swipe"},{default:b((()=>[(k(!0),p(f,null,I(i.issuemtr_logs,((e,t)=>(k(),y(re,{key:t,threshold:60,"right-options":i.swipe_options,onClick:t=>o.submit_cancel(e)},{default:b((()=>[h(n,null,{body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[o._unplanned_material(e)?(k(),y(ae,{key:0,text:"计划外",type:"warning",size:"mini"})):g("",!0),v(" "+N(e["FMaterialId.FNumber"]),1)])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("名称："+N(e["FMaterialId.FName"]),1)])),_:2},1024),h(r,null,{default:b((()=>[v("规格："+N(e["FMaterialId.FSpecification"]),1)])),_:2},1024),h(r,null,{default:b((()=>[v("供应商："),h(H,{class:"text-primary"},{default:b((()=>[v(N(e["FSupplierId.FName"]),1)])),_:2},1024)])),_:2},1024),h(r,null,{default:b((()=>[v("批次："),h(H,{class:"text-primary"},{default:b((()=>[v(N(e.FBatchNo),1)])),_:2},1024)])),_:2},1024),h(r,null,{default:b((()=>[v("单据："),h(H,{class:"text-primary"},{default:b((()=>[v(N(e.FBillNo),1)])),_:2},1024)])),_:2},1024),h(r,null,{default:b((()=>[v("时间："+N(o.formatDate(e.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[h(H,null,{default:b((()=>[v(N(e.FOpQTY)+" "+N(e["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["right-options","onClick"])))),128))])),_:1},512)])),_:1},8,["title"])])),_:1})])),_:1},8,["width"]),h(ne,{ref:"bill_popup",type:"share","safe-area":""},{default:b((()=>[i.bills.length?(k(),y(G,{key:0,title:"单据",type:"square",style:{borderRadius:"10px 10px 0 0"}},{right:b((()=>[h(r,{class:"uni-section__right"},{default:b((()=>[h(_,{type:"closeempty",size:"20",color:"#333",onClick:t[10]||(t[10]=t=>e.$refs.bill_popup.close())})])),_:1})])),default:b((()=>[h(d,null,{default:b((()=>[(k(!0),p(f,null,I(i.bills,((e,t)=>(k(),y(n,{key:t},S({body:b((()=>[h(r,{class:"uni-list-item__body"},{default:b((()=>[h(r,{class:"title"},{default:b((()=>[v(N(`${e.bill_no}${e.mo_bill_no?` / ${e.mo_bill_no}`:""}`),1)])),_:2},1024),h(r,{class:"note"},{default:b((()=>[h(r,null,{default:b((()=>[v("类型："+N("scfltzd"==e.category?"生产发料通知单":"用料清单"),1)])),_:2},1024),"ppbom"==e.category&&i.bills.length<4?(k(),p(f,{key:0},[h(r,null,{default:b((()=>[v("物料编码："+N(e.material_no),1)])),_:2},1024),h(r,null,{default:b((()=>[v("物料名称："+N(e.material_name),1)])),_:2},1024),h(r,null,{default:b((()=>[v("规格型号："+N(e.material_spec),1)])),_:2},1024)],64)):g("",!0)])),_:2},1024)])),_:2},1024)])),_:2},["bill"==i.step?{name:"footer",fn:b((()=>[h(r,{class:"uni-list-item__foot"},{default:b((()=>[h(_,{type:"minus",size:"24",color:"#dd524d",onClick:t=>o.bills_del(e)},null,8,["onClick"])])),_:2},1024)])),key:"0"}:void 0]),1024)))),128))])),_:1}),"bill"==i.step?(k(),y(m,{key:0,type:"primary",class:"form-btn",onClick:o.bills_combine_and_next},{default:b((()=>[h(_,{type:"checkmarkempty",color:"#fff"}),v(" 合并提交 ")])),_:1},8,["onClick"])):g("",!0)])),_:1})):g("",!0)])),_:1},512),h(ne,{ref:"prd_mo_search_dialog",type:"dialog"},{default:b((()=>[h(me,{type:"info",title:"搜索条件",cancelText:"关闭",onClose:o.prd_mo_search_dialog_close,onConfirm:o.prd_mo_search_dialog_confirm,"before-close":!0,style:{width:"360px"}},{default:b((()=>[h(r,{class:"search-form"},{default:b((()=>[h(ee,{ref:"prd_mo_search_form",model:i.prd_mo_search_form},{default:b((()=>[h(Z,{label:"单据编号"},{default:b((()=>[h(s,{modelValue:i.prd_mo_search_form.bill_no,"onUpdate:modelValue":t[11]||(t[11]=e=>i.prd_mo_search_form.bill_no=e)},null,8,["modelValue"])])),_:1}),h(Z,{label:"需求单据"},{default:b((()=>[h(s,{modelValue:i.prd_mo_search_form.sale_order_no,"onUpdate:modelValue":t[12]||(t[12]=e=>i.prd_mo_search_form.sale_order_no=e)},null,8,["modelValue"])])),_:1}),h(Z,{label:"产线2"},{default:b((()=>[h(s,{modelValue:i.prd_mo_search_form.chanxian2,"onUpdate:modelValue":t[13]||(t[13]=e=>i.prd_mo_search_form.chanxian2=e)},null,8,["modelValue"])])),_:1}),h(Z,{label:"业务状态"},{default:b((()=>[h(de,{modelValue:i.prd_mo_search_form.status,"onUpdate:modelValue":t[14]||(t[14]=e=>i.prd_mo_search_form.status=e),localdata:[{value:"4",text:"开工"}],clear:!1},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["onClose","onConfirm"])])),_:1},512)],64)}],["__scopeId","data-v-a9920fdc"]]);export{se as default};
