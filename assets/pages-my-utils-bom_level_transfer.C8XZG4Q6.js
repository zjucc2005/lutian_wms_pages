import{ap as e,c as t,d as a,w as s,o,e as n,f as r,Q as i,l}from"./index-DjNCOAYS.js";import{_ as d}from"./uni-section.Cyvrqc16.js";import{r as p}from"./uni-app.es.Ch8d-HxS.js";import{X as _}from"./xlsx.uBlg2PW8.js";import{s as h}from"./index.uJty1kg6.js";import{_ as c}from"./_plugin-vue_export-helper.BCo6x5W8.js";const u=c({data:()=>({raw_data:[],done_data:[],raw_len:1,done_len:0}),computed:{progress_percent(){return(100*this.done_len/this.raw_len).toFixed()}},methods:{choose_file(){let t=this;e({count:1,extension:[".xlsx",".xls"],success(e){this.raw_data=[],this.done_data=[],this.raw_data=1,this.done_data=0;let a=e.tempFiles[0];a.name.split(".").pop();var s=new FileReader;s.onload=function(e){let a=e.target.result,s=_.read(a,{type:"binary"}),o=s.Sheets[s.SheetNames[0]],n=_.utils.sheet_to_json(o,{header:1});t.raw_data=n,t.raw_len=n.length,t.handle_data(),t.export_excel()},s.readAsBinaryString(a)}})},handle_data(){let e=0;for(let t=0;t<this.raw_data.length;t++){let a=this.raw_data[t];if(0==t)this.done_data.push(["BOM层级(脚本处理)",...a]);else if("0"===a[0])e+=1,this.done_data.push([String(e),...a]);else{let t=a[0].split(".");t[0]=e,this.done_data.push([t.join("."),...a])}this.done_len+=1}},export_excel(){let e=_.utils.aoa_to_sheet(this.done_data),t=_.utils.book_new();_.utils.book_append_sheet(t,e,"Sheet1");var a=_.write(t,{bookType:"xlsx",bookSST:!0,type:"binary"});const s=new Blob([h(a)],{type:"application/octet-stream"});let o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`BOM层级号转换_${Date.now()}.xlsx`,o.click(),URL.revokeObjectURL(o.href)}}},[["render",function(e,_,h,c,u,m){const f=i,x=l,w=p(t("uni-section"),d);return o(),a(w,{title:"处理进度","sub-title":"选择文件需先解密",type:"square",class:"container"},{default:s((()=>[n(f,{percent:m.progress_percent,"show-info":"","stroke-width":"3"},null,8,["percent"]),n(x,{type:"primary",class:"uni-mt-10",onClick:m.choose_file},{default:s((()=>[r("选择文件")])),_:1},8,["onClick"])])),_:1})}]]);export{u as default};
