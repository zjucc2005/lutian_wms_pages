import{s as a,b as e,a as t,h as r,n as o,c as i,q as s,e as l,w as m,F as n,i as c,o as _,f as d,S as u,u as h,l as f,T as p,d as g}from"./index-MIvYX1nW.js";import{_ as b}from"./uni-easyinput.BboSH9MB.js";import{r as k}from"./uni-app.es.B8zr0lZI.js";import{_ as y,a as v}from"./uni-forms.C-YkALHf.js";import{_ as j}from"./uni-data-select.7wY52LM_.js";import{_ as w}from"./uni-icons.DEYikQDp.js";import{_ as F}from"./uni-section.C7O4oyAr.js";import{_ as C}from"./uni-goods-nav.DSaXBg-u.js";import{_ as V}from"./uni-list-item.Dk-snU2X.js";import{_ as x}from"./uni-list.zX7C8YBn.js";import{_ as I}from"./uni-drawer.COomJS_R.js";import{p as $}from"./index.DbF5UMRK.js";import{K as N}from"./k3cloudapi.DzDu3BGl.js";import{B as S}from"./bd_material.CFPy7Ij-.js";import"./stock_loc.BckAHwoS.js";import"./inv_log.BJcJnepW.js";import{s as U}from"./scan_code.bSbj3X8t.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-badge.DDwx_b0i.js";const B=q({data:()=>({search_form:{material_no:"",material_name:"",material_spec:"",material_category_id:"",candidates:[]},material_categories:[],goods_nav:{options:[],button_group:[{text:"扫码查询",color:"#fff",backgroundColor:a.state.goods_nav_color.red}]}}),mounted(){this.load_bd_materialcategories()},methods:{clear(){this.search_form.material_no="",this.search_form.material_name="",this.search_form.material_spec="",this.search_form.material_category_id=""},goods_nav_click(a){},goods_nav_button_click(a){0===a.index&&this.scan_code()},scan_code(){U().then((a=>{this.search_form.material_no=a.result,a.result.includes("||")&&(this.search_form.material_no=a.result.split("||")[1]),this.search()})).catch((a=>{e({icon:"none",title:a})}))},searchbar_icon_click(a){"prefix"==a&&this.scan_code()},async search(){var a;if(!this.search_form.material_no&&!this.search_form.material_name&&!this.search_form.material_spec)return;let o={FUseOrgId:1};this.search_form.material_no&&(o.FNumber_lk=this.search_form.material_no),this.search_form.material_name&&(o.FName_lk=this.search_form.material_name),this.search_form.material_spec&&(o.FSpecification_lk=this.search_form.material_spec),this.search_form.material_category_id&&(o.FCategoryId=this.search_form.material_category_id);t({title:"Loading"});let i=await S.query(o,{per_page:50,order:"FNumber ASC"});r(),this.search_form.candidates=i.data,this.get_thumbnail(),i.data.length>1&&this.$refs.search_drawer.open(),1===i.data.length&&this.load_material(null==(a=i.data[0])?void 0:a.FMaterialId),i.data.length<1&&e({icon:"none",title:"无匹配结果"})},async load_bd_materialcategories(){var e;(null==(e=a.state.bd_materialcategories)?void 0:e.length)||(t({title:"Loading"}),await S.categories().then((e=>{r(),a.commit("set_bd_materialcategories",e.data)}))),this.material_categories=a.state.bd_materialcategories.map((a=>({value:a.FMasterId,text:a.FName})))},async load_material(a){this.$refs.search_drawer.close(),$("success"),o({url:"/pages/operation/material/show?id="+a})},async get_thumbnail(){for(let a of this.search_form.candidates){let e=await N.thumbnail_url(a.FImageFileServer);a.thumbnail=e}}}},[["render",function(a,e,t,r,o,$){const N=k(i("uni-easyinput"),b),S=k(i("uni-forms-item"),y),U=k(i("uni-data-select"),j),q=k(i("uni-icons"),w),B=f,L=k(i("uni-forms"),v),M=c,z=k(i("uni-section"),F),A=k(i("uni-goods-nav"),C),K=k(i("uni-list-item"),V),T=k(i("uni-list"),x),W=p,E=k(i("uni-drawer"),I);return _(),s(n,null,[l(z,{title:"查询物料",type:"square"},{default:m((()=>[l(M,{class:"container"},{default:m((()=>[l(L,{ref:"form",model:o.search_form,labelWidth:"70px"},{default:m((()=>[l(S,{label:"编码",name:"material_no"},{default:m((()=>[l(N,{modelValue:o.search_form.material_no,"onUpdate:modelValue":e[0]||(e[0]=a=>o.search_form.material_no=a),trim:"both","prefix-icon":"scan",onIconClick:$.searchbar_icon_click},null,8,["modelValue","onIconClick"])])),_:1}),l(S,{label:"名称",name:"material_name"},{default:m((()=>[l(N,{modelValue:o.search_form.material_name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.search_form.material_name=a),trim:"both"},null,8,["modelValue"])])),_:1}),l(S,{label:"规格",name:"material_spec"},{default:m((()=>[l(N,{modelValue:o.search_form.material_spec,"onUpdate:modelValue":e[2]||(e[2]=a=>o.search_form.material_spec=a),trim:"both"},null,8,["modelValue"])])),_:1}),l(S,{label:"存货类别",name:"material_category_id"},{default:m((()=>[l(U,{modelValue:o.search_form.material_category_id,"onUpdate:modelValue":e[3]||(e[3]=a=>o.search_form.material_category_id=a),localdata:o.material_categories},null,8,["modelValue","localdata"])])),_:1}),l(B,{onClick:$.search,type:"primary"},{default:m((()=>[l(q,{type:"search",color:"#fff"}),d(" 搜索 ")])),_:1},8,["onClick"])])),_:1},8,["model"])])),_:1})])),_:1}),l(M,{class:"uni-goods-nav-wrapper"},{default:m((()=>[l(A,{options:o.goods_nav.options,"button-group":o.goods_nav.button_group,fill:a.$store.state.goods_nav_fill,onClick:$.goods_nav_click,onButtonClick:$.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1}),l(E,{ref:"search_drawer",width:a.$store.state.drawer_width},{default:m((()=>[l(W,{"scroll-y":"",style:{height:"100%"},onTouchmove:e[5]||(e[5]=u((()=>{}),["stop"]))},{default:m((()=>[l(z,{title:`搜索结果 ${o.search_form.candidates.length} 条`,type:"square","sub-title":"最多展示50条搜索结果"},{right:m((()=>[l(M,{class:"uni-section__right"},{default:m((()=>[l(q,{type:"closeempty",size:"24",color:"#333",onClick:e[4]||(e[4]=e=>a.$refs.search_drawer.close())})])),_:1})])),default:m((()=>[l(T,null,{default:m((()=>[(_(!0),s(n,null,h(o.search_form.candidates,((a,e)=>(_(),g(K,{key:e,title:a.FNumber,note:[`名称：${a.FName}`,`规格：${a.FSpecification}`].join("\n"),thumb:a.thumbnail||"/static/default_40x40.png","thumb-size":"lg",onClick:e=>$.load_material(a.FMaterialId),clickable:"","show-arrow":""},null,8,["title","note","thumb","onClick"])))),128))])),_:1})])),_:1},8,["title"])])),_:1})])),_:1},8,["width"])],64)}]]);export{B as default};
