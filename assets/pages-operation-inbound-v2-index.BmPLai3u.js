import{s as t,P as o,b as n,a,h as s,p as i,c as e,q as _,e as l,w as r,F as u,i as p,o as d,u as c,d as g,g as m,f as b,t as f,k as h,Q as v}from"./index-DsK9pIyj.js";import{_ as k}from"./uni-list-item.BkmqxiQh.js";import{r as y}from"./uni-app.es.CSK8ITuj.js";import{_ as F}from"./uni-list.dJf-6p1_.js";import{_ as j}from"./uni-load-more.CyJx3ZKG.js";import{_ as x}from"./uni-section.BpQrEx4g.js";import{_ as q}from"./uni-goods-nav.BN-nj5na.js";import{I as C}from"./inbound_task.DN8rWXup.js";import"./k3cloudapi.PCDjx1SF.js";import{a as w}from"./stock_loc.Bj3C3Byx.js";import"./inv_log.D0BShjlW.js";import{l as S}from"./index.uHoH2c2-.js";import{s as I}from"./scan_code.CGa79-3n.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{f as D}from"./date-format.Dm3Q97cL.js";import"./uni-icons.DRoE6XYp.js";import"./uni-badge.CO78OwkC.js";const T=B({data:()=>({inbound_task:"",inv_plans:[],inv_plan_groups:[],last_refresh_time:0,refresh_interval:3e4,goods_nav:{options:[{icon:"refreshempty",text:"刷新"}],admin_button_group:[{text:"新增入库计划",backgroundColor:t.state.goods_nav_color.blue,color:"#fff"}],staff_button_group:[{text:"扫码查询",backgroundColor:t.state.goods_nav_color.red,color:"#fff"}]}}),onShow(){this.load_inv_plans(),this.inbound_task=C.current(),this.inbound_task?(this.goods_nav.admin_button_group[0].text="编辑入库计划",this.goods_nav.admin_button_group[0].backgroundColor=t.state.goods_nav_color.green):(this.goods_nav.admin_button_group[0].text="新增入库计划",this.goods_nav.admin_button_group[0].backgroundColor=t.state.goods_nav_color.blue)},onPullDownRefresh(){this.refresh(),o()},methods:{goods_nav_click(t){0===t.index&&this.refresh()},goods_nav_admin_button_click(t){0===t.index&&this.init_plan()},goods_nav_staff_button_click(t){0===t.index&&this.scan_code()},scan_code(){I().then((t=>{this.operate_plan(t.result)})).catch((t=>{n({icon:"none",title:t})}))},async load_inv_plans(){let o={FStockId:t.state.cur_stock.FStockId,FOpType:"in",FDocumentStatu_in:["A","B"]};return"nrj_admin"==t.state.role&&(o["FMaterialId.F_PAEZ_Base1"]=t.state.cur_staff.FName),a({title:"Loading"}),w.query(o,{order:"FCreateTime ASC"}).then((t=>{s(),this.inv_plans=t.data,this._set_inv_plan_groups(t.data)}))},async refresh(){this.last_refresh_time+this.refresh_interval>Date.now()?n({icon:"none",title:"请不要频繁刷新"}):(await this.load_inv_plans(),this.last_refresh_time=Date.now())},init_plan(){this.inbound_task?"bill"==this.inbound_task.category?S("/pages/operation/inbound/v2/plan_init"):"pallet"==this.inbound_task.category?S("/pages/operation/inbound/v2/plan_init_pallet"):"custom"==this.inbound_task.category?S("/pages/operation/inbound/v2/plan_init_custom"):"cgsl"==this.inbound_task.category&&S("/pages/operation/inbound/v2/plan_init_cgsl"):i({itemList:["扫《直接调拨单》","扫《物料标识卡》","手工录入","扫《收料通知单》"],success:t=>{0===t.tapIndex?S("/pages/operation/inbound/v2/plan_init"):1===t.tapIndex?S("/pages/operation/inbound/v2/plan_init_pallet"):2===t.tapIndex?S("/pages/operation/inbound/v2/plan_init_custom"):3===t.tapIndex&&S("/pages/operation/inbound/v2/plan_init_cgsl")}})},operate_plan(t){this.inv_plan_groups.find((o=>o.bill_no==t))?S(`/pages/operation/inbound/v2/plan_show?t=${t}`):n({icon:"none",title:"未找到单据编号"})},_set_inv_plan_groups(t){let o=[];t.forEach((t=>{let n=o.find((o=>o.bill_no==t.FBillNo));n?("A"==t.FDocumentStatu&&(n.qty_a+=t.FOpQTY),"B"==t.FDocumentStatu&&(n.qty_b+=t.FOpQTY)):(n={bill_no:t.FBillNo,created_at:D(t.FCreateTime,"yyyy-MM-dd"),qty_a:"A"==t.FDocumentStatu?t.FOpQTY:0,qty_b:"B"==t.FDocumentStatu?t.FOpQTY:0},o.push(n))})),this.inv_plan_groups=o}}},[["render",function(t,o,n,a,s,i){const C=h,w=v,S=p,I=y(e("uni-list-item"),k),B=y(e("uni-list"),F),D=y(e("uni-load-more"),j),T=y(e("uni-section"),x),A=y(e("uni-goods-nav"),q);return d(),_(u,null,[l(T,{title:"进行中的入库计划",type:"square","sub-title":"单据编号",class:"above-uni-goods-nav"},{default:r((()=>[l(B,null,{default:r((()=>[(d(!0),_(u,null,c(s.inv_plan_groups,((t,o)=>(d(),g(I,{key:o,"right-text":t.created_at,"show-arrow":"",onClick:o=>i.operate_plan(t.bill_no),clickable:""},{body:r((()=>[l(S,{class:"uni-list-item__body"},{default:r((()=>[l(C,{class:"title"},{default:r((()=>[b(f(t.bill_no),1)])),_:2},1024),l(S,{class:"note"},{default:r((()=>[l(w,{percent:100*t.qty_b/(t.qty_b+t.qty_a),"stroke-width":"2","active-color":t.qty_b/(t.qty_b+t.qty_a)==1?"#4cd964":"#f0ad4e",active:!0},null,8,["percent","active-color"]),l(C,{class:"qty"},{default:r((()=>[b("计划入库数："+f(t.qty_a+t.qty_b),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["right-text","onClick"])))),128))])),_:1}),0===s.inv_plan_groups.length?(d(),g(D,{key:0,status:"nomore"})):m("",!0)])),_:1}),l(S,{class:"uni-goods-nav-wrapper"},{default:r((()=>[l(A,{options:s.goods_nav.options,"button-group":s.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:i.goods_nav_click,onButtonClick:i.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)}]]);export{T as default};
