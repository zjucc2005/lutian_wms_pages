import{s as e,p as o,b as t,m as l,a as s,h as n,c as a,q as i,e as r,w as u,F as m,i as _,o as d,u as c,g as f,f as p,t as h,k as w,d as g}from"./index-CqdXm0r7.js";import{_ as b}from"./uni-notice-bar.Bg_VGOL6.js";import{r as $}from"./uni-app.es.D0fJ2kcT.js";import{_ as x}from"./uni-list-item.Dzmn-3-a.js";import{_ as k,a as v}from"./uni-swipe-action.BmXTlY86.js";import{_ as V}from"./uni-section.DKwkJd1U.js";import{_ as y}from"./uni-goods-nav.CDNwxccE.js";import{_ as C}from"./uni-data-checkbox.BYiVDBHw.js";import{_ as j}from"./uni-easyinput.Nqewt57l.js";import{_ as U,a as F}from"./uni-forms.ba5bQ_tw.js";import{_ as I}from"./uni-number-box.Bv9_MwRE.js";import{_ as N}from"./uni-data-select.COK_BE0s.js";import{_ as q,a as E}from"./uni-popup.Cku_7O0i.js";import{p as S}from"./index.DXIG_Tpn.js";import"./k3cloudapi.BjBFa2ll.js";import{S as G}from"./stock_loc.B6bAmQXk.js";import"./inv_log.EW53o3V_.js";import{s as L}from"./scan_code.Bv2D0h8k.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.KMw0mbbD.js";import"./uni-badge.Wm6ZM3Cx.js";import"./uni-load-more.B96eeEg4.js";const P=O({data:()=>({loc_nos:[],new_form:{type:"standard",depot:"",shelf:"",row:1,column:1},new_form_rules:{depot:{rules:[{required:!0,errorMessage:"仓库编号不能为空"},{validateFunction:(e,o,t,l)=>{if(o.length>4)return l("仓库编号不能大于4位")}}]},shelf:{rules:[{required:!0,errorMessage:"货架编号不能为空"},{validateFunction:(e,o,t,l)=>{if(o.length>8)return l("货架编号不能大于8位")}}]}},swipe_action_options:[{text:"删除",style:{backgroundColor:"#dd524d"}}],goods_nav:{options:[{icon:"trash",text:"清空"}],button_group:[{text:"扫码新增",backgroundColor:e.state.goods_nav_color.red,color:"#fff"},{text:"批量新增",backgroundColor:e.state.goods_nav_color.green,color:"#fff"},{text:"提交保存",backgroundColor:e.state.goods_nav_color.blue,color:"#fff"}]}}),mounted(){},computed:{loc_no_example(){let e={depot:this.new_form.depot||"*",shelf:this.new_form.shelf||"*",column:this.new_form.column||"*",row:this.new_form.row||"*"};return"standard"===this.new_form.type?(this.new_form.column&&this.new_form.column<10&&(e.column=`0${this.new_form.column}`),`${e.depot.toUpperCase()}-${e.shelf.toUpperCase()}-101 ~ ${e.row}${e.column}`):"ground"===this.new_form.type?(this.new_form.column&&this.new_form.column<10&&(e.column=`0${this.new_form.column}`),this.new_form.row&&this.new_form.row<10&&(e.row=`0${this.new_form.row}`),`${e.depot.toUpperCase()}-${e.shelf.toUpperCase()}01-01 ~ ${e.column}-${e.row}`):"special"===this.new_form.type?`${e.depot.toUpperCase()}-${e.shelf.toUpperCase()}`:""}},methods:{swipe_action_click(e,o){0===e.index&&(this.loc_nos.splice(o,1),this.$refs.loc_no_swipe.closeAll())},goods_nav_click(e){0===e.index&&this.if_clear_loc_nos()},goods_nav_button_click(e){0===e.index&&this.scan_code(),1===e.index&&this.open_new_dialog(),2===e.index&&this.if_submit_batch_save()},if_clear_loc_nos(){o({itemList:["清空库位号"],success:e=>{0===e.tapIndex&&(this.loc_nos=[])}})},close_new_dialog(){this.new_form={type:"standard",depot:"",shelf:"",column:1,row:1},this.$refs.new_dialog.close()},confirm_new_dialog(){this.$refs.new_form.validate().then((e=>{console.log("hook >>",this.new_form.type,this.new_form.depot,this.new_form.shelf,this.new_form.column,this.new_form.row),this.loc_nos=this.gen_loc_nos(this.new_form.type,this.new_form.depot,this.new_form.shelf,this.new_form.column,this.new_form.row),this.close_new_dialog()})).catch((e=>{}))},open_new_dialog(){this.$refs.new_dialog.open()},scan_code(){L().then((e=>{this.handle_scan_code(e.result)})).catch((e=>{t({icon:"none",title:e})}))},handle_scan_code(e){(e=e.trim().toUpperCase()).length<4?t({icon:"none",title:"长度需大于4位"}):this.loc_nos.find((o=>o.value===e))?t({icon:"none",title:"重复扫码"}):this.loc_nos.push({value:e,status:""})},if_submit_batch_save(){l({title:"提交保存注意事项",content:"请仔细核对新增库位号，确认提交后，将会批量提交数据并保存。",success:e=>{e.confirm&&this.submit_batch_save()},fail:e=>{}})},async submit_batch_save(){try{if(0===this.loc_nos.length)return void t({icon:"none",title:"没有新增库位"});let o=this.loc_nos.map((e=>e.no));s({title:"Loading"});let l=await G.exist_loc_nos(o);if(n(),0===l.status){const l=this.loc_nos.map((o=>new G({FStockId:e.state.cur_stock.FStockId,FNumber:o.no,FGroup:o.shelf,FPosX:o.x,FPosY:o.y,FPalletSpace:1})));s({title:"Loading"}),await G.batch_save(l),await G.submit(o),await G.audit(o),t({title:"保存成功"}),S("success"),this.loc_nos=[]}else 1===l.status?(t({icon:"none",title:l.msg}),this.loc_nos.forEach((e=>{l.data.indexOf(e.no)>-1&&(e.status="已存在")}))):-1===l.status&&t({icon:"none",title:l.msg})}catch(o){}},gen_loc_nos(e,o,t,l,s){if(l<1||l>99)throw new Error("列数只能在1~99");if(s<1||s>99)throw new Error("行数只能在1~99");let n=[];if(o=o.toUpperCase(),t=t.toUpperCase(),"standard"===e)for(let a=0;a<s;a++)for(let e=0;e<l;e++)n.push({no:`${o}-${t}-${100*(a+1)+e+1}`,status:"",shelf:`${o}-${t}`,x:e+1,y:a+1});else if("ground"===e)for(let a=0;a<l;a++)for(let e=0;e<s;e++){let l=e<9?`0${e+1}`:e+1,s=a<9?`0${a+1}`:a+1;n.push({no:`${o}-${t}${s}-${l}`,status:"",shelf:`${o}-${t}`,x:a+1,y:e+1})}else"special"===e&&n.push({no:`${o}-${t}`,status:"",shelf:`${o}-${t}`,x:1,y:1});return n},debug(){console.log("this.$data",this.$data)}}},[["render",function(e,o,t,l,s,n){const S=$(a("uni-notice-bar"),b),G=w,L=_,O=$(a("uni-list-item"),x),P=$(a("uni-swipe-action-item"),k),A=$(a("uni-swipe-action"),v),B=$(a("uni-section"),V),M=$(a("uni-goods-nav"),y),z=$(a("uni-data-checkbox"),C),D=$(a("uni-easyinput"),j),H=$(a("uni-forms-item"),U),J=$(a("uni-number-box"),I),K=$(a("uni-data-select"),N),Q=$(a("uni-forms"),F),T=$(a("uni-popup-dialog"),q),X=$(a("uni-popup"),E);return d(),i(m,null,[r(S,{single:"",scrollable:"",text:"可以扫码或批量新增库位号，然后一次性点击提交保存"}),r(B,{title:"当前仓库",type:"square","sub-title":[e.$store.state.cur_stock["FUseOrgId.FName"],e.$store.state.cur_stock["FGroup.FName"]||"未分组",e.$store.state.cur_stock.FName].join(" / "),class:"above-uni-goods-nav",onClick:n.debug},{default:u((()=>[r(A,{ref:"loc_no_swipe"},{default:u((()=>[(d(!0),i(m,null,c(s.loc_nos,((e,o)=>(d(),g(P,{key:o,threshold:60,"right-options":s.swipe_action_options,onClick:e=>n.swipe_action_click(e,o)},{default:u((()=>[r(O,{title:e.no},{footer:u((()=>[r(L,{class:"uni-list-item__foot"},{default:u((()=>[r(G,{class:"status disabled"},{default:u((()=>[p(h(e.status),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["title"])])),_:2},1032,["right-options","onClick"])))),128))])),_:1},512)])),_:1},8,["sub-title","onClick"]),r(L,{class:"uni-goods-nav-wrapper"},{default:u((()=>[r(M,{options:s.goods_nav.options,"button-group":s.goods_nav.button_group,fill:e.$store.state.goods_nav_fill,onClick:n.goods_nav_click,onButtonClick:n.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1}),r(X,{ref:"new_dialog",type:"dialog"},{default:u((()=>[r(T,{type:"info",title:"批量新增",onClose:n.close_new_dialog,onConfirm:n.confirm_new_dialog,beforeClose:!0,style:{width:"360px"}},{default:u((()=>[r(L,{class:"new-form"},{default:u((()=>[r(z,{modelValue:s.new_form.type,"onUpdate:modelValue":o[0]||(o[0]=e=>s.new_form.type=e),localdata:[{text:"标准库位",value:"standard"},{text:"地面库位",value:"ground"},{text:"独立库位",value:"special"}],class:"uni-mb-10"},null,8,["modelValue"]),r(Q,{ref:"new_form",model:s.new_form,rules:s.new_form_rules},{default:u((()=>["standard"===s.new_form.type?(d(),i(m,{key:0},[r(H,{label:"仓库编号",name:"depot"},{default:u((()=>[r(D,{modelValue:s.new_form.depot,"onUpdate:modelValue":o[1]||(o[1]=e=>s.new_form.depot=e),trim:"both"},null,8,["modelValue"])])),_:1}),r(H,{label:"货架编号",name:"shelf"},{default:u((()=>[r(D,{modelValue:s.new_form.shelf,"onUpdate:modelValue":o[2]||(o[2]=e=>s.new_form.shelf=e),trim:"both"},null,8,["modelValue"])])),_:1}),r(H,{label:"总行数",name:"row"},{default:u((()=>[r(J,{modelValue:s.new_form.row,"onUpdate:modelValue":o[3]||(o[3]=e=>s.new_form.row=e),min:1,max:99},null,8,["modelValue"])])),_:1}),r(H,{label:"总列数",name:"column"},{default:u((()=>[r(J,{modelValue:s.new_form.column,"onUpdate:modelValue":o[4]||(o[4]=e=>s.new_form.column=e),min:1,max:99},null,8,["modelValue"])])),_:1})],64)):f("",!0),"ground"===s.new_form.type?(d(),i(m,{key:1},[r(H,{label:"仓库编号",name:"depot"},{default:u((()=>[r(D,{modelValue:s.new_form.depot,"onUpdate:modelValue":o[5]||(o[5]=e=>s.new_form.depot=e),trim:"both"},null,8,["modelValue"])])),_:1}),r(H,{label:"库区编号",name:"shelf"},{default:u((()=>[r(D,{modelValue:s.new_form.shelf,"onUpdate:modelValue":o[6]||(o[6]=e=>s.new_form.shelf=e),trim:"both"},null,8,["modelValue"])])),_:1}),r(H,{label:"总列数",name:"column"},{default:u((()=>[r(J,{modelValue:s.new_form.column,"onUpdate:modelValue":o[7]||(o[7]=e=>s.new_form.column=e),min:1,max:99},null,8,["modelValue"])])),_:1}),r(H,{label:"总行数",name:"row"},{default:u((()=>[r(J,{modelValue:s.new_form.row,"onUpdate:modelValue":o[8]||(o[8]=e=>s.new_form.row=e),min:1,max:99},null,8,["modelValue"])])),_:1})],64)):f("",!0),"special"===s.new_form.type?(d(),i(m,{key:2},[r(H,{label:"仓库编号",name:"depot"},{default:u((()=>[r(D,{modelValue:s.new_form.depot,"onUpdate:modelValue":o[9]||(o[9]=e=>s.new_form.depot=e),trim:"both"},null,8,["modelValue"])])),_:1}),r(H,{label:"类型",name:"shelf"},{default:u((()=>[r(K,{modelValue:s.new_form.shelf,"onUpdate:modelValue":o[10]||(o[10]=e=>s.new_form.shelf=e),localdata:[{value:"拆包区",text:"拆包区"}]},null,8,["modelValue"])])),_:1})],64)):f("",!0),r(H,{label:"示例"},{default:u((()=>[r(G,{class:"example"},{default:u((()=>[p(h(n.loc_no_example),1)])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1},8,["onClose","onConfirm"])])),_:1},512)],64)}],["__scopeId","data-v-442b9892"]]);export{P as default};
