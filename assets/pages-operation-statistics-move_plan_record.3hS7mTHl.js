import{s as t,a as e,h as a,c as s,q as i,e as o,w as _,F as r,o as n,i as h}from"./index-DjNCOAYS.js";import{_ as m}from"./qiun-data-charts.ButfcOy6.js";import{r as d}from"./uni-app.es.Ch8d-HxS.js";import{_ as u}from"./uni-section.Cyvrqc16.js";import{_ as p}from"./uni-segmented-control.BrXUwpis.js";import{f as l}from"./date-format.Dm3Q97cL.js";import"./k3cloudapi.B_cIKn_3.js";import"./stock_loc.GXV191SF.js";import{I as c}from"./inv_log.B3mwqkWu.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const g=y({data:()=>({raw_data:[],mode:"day",stime:null,type:"line",opts:{enableScroll:!0,scrollPosition:"right",xAxis:{scrollShow:!0,scrollAlign:"right",itemCount:Math.max(Math.floor(t.state.system_info.windowWidth/60),8)},extra:{line:{type:"curve",width:2,activeType:"hollow"}}},chart_data:{categories:[],series:[]}}),mounted(){this._get_stime(),this.load_raw_data()},methods:{segment_click(t){0===t.currentIndex&&this._set_chart_data_day(),1===t.currentIndex&&this._set_chart_data_month(),2===t.currentIndex&&this._set_chart_data_season()},async load_raw_data(){try{let s={FOpType_in:["mv_in","add","sub"],FStockId:t.state.cur_stock.FStockId,FCreateTime_ge:l(this.stime,"yyyy-MM-dd")};e({title:"Loading"});let i=await c.inventory_record(s);a(),this.raw_data=i.map((t=>(t[4]=Number(new Date(t[3])),t))),this._set_chart_data_day()}catch(s){}},_set_chart_data_season(){this.mode="season";let t=[],e=[],a=[],s=[],i=[],o=this.stime.getFullYear(),_=this.stime.getMonth(),r=(_+1)%3;0==r&&(_+=1),2==r&&(_+=2),_>11&&(o+=1,_-=12);for(let n=0;n<4;n++){let r=o,h=_+3*n;h>11&&(r+=1,h-=12);let m=new Date(r,h,1),d=r,u=h+3;u>11&&(d+=1,u-=12);let p=new Date(d,u,1);t.push(l(m,"yy.MM")),e.push(this._sum_op_type("sum",m,p)),a.push(this._sum_op_type("mv_in",m,p)),s.push(this._sum_op_type("add",m,p)),i.push(this._sum_op_type("sub",m,p))}this.chart_data={categories:t,series:[{name:"合计",data:e},{name:"移库",data:a},{name:"调增",data:s},{name:"调减",data:i}]}},_set_chart_data_month(){this.mode="month";let t=[],e=[],a=[],s=[],i=[],o=this.stime.getFullYear(),_=this.stime.getMonth();for(let r=0;r<12;r++){let n=o,h=_+r;h>11&&(n+=1,h-=12);let m=new Date(n,h,1),d=n,u=h+1;u>11&&(d+=1,u-=12);let p=new Date(d,u,1);t.push(l(m,"yy.MM")),e.push(this._sum_op_type("sum",m,p)),a.push(this._sum_op_type("mv_in",m,p)),s.push(this._sum_op_type("add",m,p)),i.push(this._sum_op_type("sub",m,p))}this.chart_data={categories:t,series:[{name:"合计",data:e},{name:"移库",data:a},{name:"调增",data:s},{name:"调减",data:i}]}},_set_chart_data_day(){this.mode="day";let t=[],e=[],a=[],s=[],i=[],o=Number(this.stime);for(;o<Date.now();){let _=o+864e5;t.push(l(o,"MM.dd")),e.push(this._sum_op_type("sum",o,_)),a.push(this._sum_op_type("mv_in",o,_)),s.push(this._sum_op_type("add",o,_)),i.push(this._sum_op_type("sub",o,_)),o=_}this.chart_data={categories:t,series:[{name:"合计",data:e},{name:"移库",data:a},{name:"调增",data:s},{name:"调减",data:i}]}},_sum_op_type(t,e,a){let s=0;return this.raw_data.forEach((i=>{"sum"==t?i[4]>=e&&i[4]<a&&(s+=1):i[0]==t&&i[4]>=e&&i[4]<a&&(s+=1)})),s},_get_stime(){let t=new Date(Date.now()-2592e6),e=t.getFullYear(),a=t.getMonth(),s=t.getDate();this.stime=new Date(e,a,s)},debug(t){this.$logger.info("debug",this.$data)}}},[["render",function(t,e,a,l,c,y){const g=d(s("qiun-data-charts"),m),f=d(s("uni-section"),u),w=d(s("uni-segmented-control"),p),M=h;return n(),i(r,null,[o(f,{title:"库存调整(次数)统计",type:"square"},{default:_((()=>[o(g,{type:c.type,opts:c.opts,"chart-data":c.chart_data,ontouch:""},null,8,["type","opts","chart-data"])])),_:1}),o(f,{title:"设置",type:"square"},{default:_((()=>[o(M,{class:"container"},{default:_((()=>[o(w,{current:0,values:["日视图"],onClickItem:y.segment_click},null,8,["onClickItem"])])),_:1})])),_:1})],64)}]]);export{g as default};
