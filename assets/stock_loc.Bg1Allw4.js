var e=Object.defineProperty;import{K as t}from"./k3cloudapi.cCLE6bXq.js";import{s as a,b as r}from"./index-Bu7BB2Sn.js";import{I as F}from"./inv_log.CiTZZpLf.js";const i=class{constructor(){}static async delete(e=[]){const a={Ids:e.join(",")};return t.delete("PAEZ_C_INV",a)}static query(e={},a={}){const r={FormId:"PAEZ_C_INV",FieldKeys:["FID","FQty","FBatchNo","FCreateTime","FMaterialId","FMaterialId.FNumber","FMaterialId.FName","FMaterialId.FSpecification","FMaterialId.FImageFileServer","FStockLocId","FStockLocId.FNumber","FStockLocId.FGroup","FStockLocId.FPosX","FStockLocId.FPosY","FStockUnitId","FStockUnitId.FName","FSupplierId","FSupplierId.FName"].join(","),FilterString:t.query_filter(e)};return a.per_page&&(r.Limit=a.per_page,a.page&&(r.StartRow=(a.page-1)*a.per_page)),a.order&&(r.OrderString=a.order),t.bill_query(r)}static find(e){return this.query({FID:e},{limit:1})}static async get_all(e={},t={}){let a={page:1,per_page:1e4,order:"FMaterialId.FNumber ASC, FCreateTime ASC",...t},r=[];return r=await this._get_all_recurse(e,a,r),r}static async _get_all_recurse(e={},a={},r=[]){const F=["FID","FQty","FBatchNo","FCreateTime","FMaterialId","FMaterialId.FNumber","FMaterialId.FName","FMaterialId.FSpecification","FMaterialId.FImageFileServer","FStockLocId","FStockLocId.FNumber","FStockLocId.FGroup","FStockLocId.FPosX","FStockLocId.FPosY","FStockUnitId","FStockUnitId.FName","FSupplierId","FSupplierId.FName"],i={FormId:"PAEZ_C_INV",FieldKeys:F.join(","),FilterString:t.query_filter({FQty_gt:0,...e})};a.per_page&&(i.Limit=a.per_page,a.page&&(i.StartRow=(a.page-1)*a.per_page)),a.order&&(i.OrderString=a.order);let o=await t.execute_bill_query(i),c=o.data.map((e=>{let t={};for(let a=0;a<F.length;a++)t[F[a]]=e[a];return t}));return r=r.concat(c),o.data.length===a.per_page?(a.page+=1,this._get_all_recurse(e,a,r)):r}};class o{constructor(e={}){this.FOpSN=a.state.snowflake.next_id(),this.FOpType=e.FOpType,this.FStockId={FStockId:e.FStockId},this.FStockLocId={FNumber:e.FStockLocNo},e.FDestStockLocNo&&(this.FDestStockLocId={FNumber:e.FDestStockLocNo}),this.FMaterialId={FMaterialId:e.FMaterialId},this.FOpQTY=e.FOpQTY,this.FInvIncre=0,this.FBatchNo=e.FBatchNo,e.FSupplierId&&(this.FSupplierId={FSupplierId:e.FSupplierId}),this.FBillNo=e.FBillNo,this.FRemark=e.FRemark||"",this.FOpStaffNo=e.FOpStaffNo,this.FPalletQty=e.FPalletQty,this.FReceiver=e.FReceiver}async save(){var e;if(!(null==(e=this.FMaterialId)?void 0:e.FMaterialId)||!this.FOpQTY)return void r({title:"参数错误"});const a={model:this};return t.save("PAEZ_C_INV_PLAN",a)}static async update(e,a={}){const r={model:{FID:e,...a}};return t.save("PAEZ_C_INV_PLAN",r)}static async batch_save(e=[]){const a={model:e,ValidateRepeatJson:!0};return t.batch_save("PAEZ_C_INV_PLAN",a)}static async submit(e=[]){const a={Ids:e.join(",")};return t.submit("PAEZ_C_INV_PLAN",a)}static async audit(e=[]){const a={Ids:e.join(",")};return t.audit("PAEZ_C_INV_PLAN",a)}static async delete(e=[]){const a={Ids:e.join(",")};return t.delete("PAEZ_C_INV_PLAN",a)}static async query(e={},a={}){const r={FormId:"PAEZ_C_INV_PLAN",FieldKeys:["FID","FDocumentStatu","FOpSN","FOpType","FOpQTY","FCreateTime","FMaterialId","FMaterialId.FNumber","FMaterialId.FName","FMaterialId.FSpecification","FMaterialId.F_PAEZ_Base1","FStockId","FStockId.FName","FStockLocId","FStockLocId.FNumber","FDestStockLocId","FDestStockLocId.FNumber","FStockUnitId","FStockUnitId.FName","FInvIncre","FInvQTY","FBatchNo","FBillNo","FSupplierId","FSupplierId.FName","FRemark","FOpStaffNo","FCInvId","FReferId","FPalletQty","FReceiver"].join(","),FilterString:t.query_filter(e)};return a.per_page&&(r.Limit=a.per_page,a.page&&(r.StartRow=(a.page-1)*a.per_page)),a.order&&(r.OrderString=a.order),t.bill_query(r)}static async find(e){return this.query({FID:e},{limit:1})}static async execute(e){if(e.FMaterialId)if(["in","out","add","sub"].includes(e.FOpType)){let t={FOpType:e.FOpType,FStockId:e.FStockId,FStockLocNo:e["FStockLocId.FNumber"],FMaterialId:e.FMaterialId,FOpQTY:e.FOpQTY,FBatchNo:e.FBatchNo,FBillNo:e.FBillNo,FOpStaffNo:e.FOpStaffNo,FRemark:e.FRemark,FReceiver:e.FReceiver,FSupplierId:e.FSupplierId},a=new F(t);await a.save()}else if("mv"==e.FOpType){let t={FOpType:"mv_out",FStockId:e.FStockId,FStockLocNo:e["FStockLocId.FNumber"],FMaterialId:e.FMaterialId,FOpQTY:e.FOpQTY,FBatchNo:e.FBatchNo,FBillNo:e.FBillNo,FOpStaffNo:e.FOpStaffNo,FRemark:e.FRemark,FSupplierId:e.FSupplierId},a=new F(t);await a.save();let r={FOpType:"mv_in",FStockId:e.FStockId,FStockLocNo:e["FDestStockLocId.FNumber"],FMaterialId:e.FMaterialId,FOpQTY:e.FOpQTY,FBatchNo:e.FBatchNo,FBillNo:e.FBillNo,FOpStaffNo:e.FOpStaffNo,FRemark:e.FRemark,FSupplierId:e.FSupplierId},i=new F(r);await i.save()}}}var c;((t,a,r)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r})(o,"symbol"!=typeof(c="FOpTypeEnum")?c+"":c,{in:"入库",out:"出库",mv:"移库",add:"增加",sub:"减少"});const s=o;const d=class{constructor(e={}){e.FID&&(this.FID=e.FID),this.FStockId={FStockId:e.FStockId},this.FNumber=e.FNumber,this.FName=e.FNumber,this.FGroup=e.FGroup,this.FPosX=e.FPosX,this.FPosY=e.FPosY,e.FPalletSpace&&(this.FPalletSpace=e.FPalletSpace)}async save(){const e={model:this};return t.save("PAEZ_C_STOCK_LOC",e)}static async batch_save(e=[]){const a={model:e,ValidateRepeatJson:!0};return t.batch_save("PAEZ_C_STOCK_LOC",a)}static async submit(e=[]){const a={Numbers:e};return t.submit("PAEZ_C_STOCK_LOC",a)}static async audit(e=[]){const a={Numbers:e};return t.audit("PAEZ_C_STOCK_LOC",a)}static async forbid(e=[]){const a={Numbers:e};return t.forbid("PAEZ_C_STOCK_LOC",a)}static async enable(e=[]){const a={Numbers:e};return t.enable("PAEZ_C_STOCK_LOC",a)}static async delete(e=[]){const a={Ids:e.join(",")};return t.delete("PAEZ_C_STOCK_LOC",a)}static async query(e={},a={}){let r=["FID","FNumber","FDocumentStatus","FForbidStatus","FStockId","FRemark","FPalletSpace","FGroup","FPosX","FPosY"];const F={FormId:"PAEZ_C_STOCK_LOC",FieldKeys:r.join(","),FilterString:t.query_filter(e),Limit:1e4};return a.per_page&&(F.Limit=a.per_page,a.page&&(F.StartRow=(a.page-1)*a.per_page)),a.order&&(F.OrderString=a.order),t.execute_bill_query(F).then((e=>(e.data=e.data.map((e=>{let t={};for(let a=0;a<r.length;a++)t[r[a]]=e[a];return t})),e)))}static async exist_loc_nos(e){return this.query({FNumber_in:e}).then((e=>Promise.resolve(((e,t,a)=>{t=t||"数据对象",a=a||"FName";let r={status:-1,msg:"网络异常",data:[]};200===e.statusCode&&(r=e.data.length>0?{status:1,msg:`${t}已存在`,data:e.data.map((e=>e[a]))}:{status:0,msg:`${t}不存在`,data:[]});return r})(e,"库位号","FNumber"))))}};export{i as I,d as S,s as a};
