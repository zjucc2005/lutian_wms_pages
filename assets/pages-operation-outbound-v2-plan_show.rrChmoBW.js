import{s as t,p as e,m as a,a as l,h as i,b as s,c as n,q as o,e as d,w as u,F as c,i as _,o as r,f as p,u as f,d as m,t as h,L as g,g as k,y as b,k as v}from"./index-DsK9pIyj.js";import{_ as F,a as y,b as w}from"./uni-td.DKOxbdh1.js";import{r as S}from"./uni-app.es.CSK8ITuj.js";import{_ as I}from"./uni-tag.DapJ5B6u.js";import{_ as x}from"./uni-table.BXeOwSLO.js";import{_ as C}from"./uni-section.BpQrEx4g.js";import{_ as j}from"./uni-goods-nav.BN-nj5na.js";import{_ as R}from"./uni-icons.DRoE6XYp.js";import{_ as D}from"./uni-list-item.BkmqxiQh.js";import{_ as N}from"./uni-list.dJf-6p1_.js";import{K as L}from"./k3cloudapi.PCDjx1SF.js";import{p as M}from"./index.uHoH2c2-.js";import{a as E}from"./stock_loc.Bj3C3Byx.js";import"./inv_log.D0BShjlW.js";import{a as A}from"./gen_pdf.C89vt95K.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{f as T}from"./date-format.Dm3Q97cL.js";import"./uni-datetime-picker.Bsu03if5.js";import"./uni-badge.CO78OwkC.js";const $=B({props:{t:{type:String}},data:()=>({bill_no:"",inv_plans:[],op_type_dict:E.FOpTypeEnum,goods_nav:{options:[{icon:"checkbox",text:"全选"}],admin_button_group:[{text:"审核确认",backgroundColor:t.state.goods_nav_color.green,color:"#fff"},{text:"预览PDF",backgroundColor:t.state.goods_nav_color.blue,color:"#fff"}],staff_button_group:[{text:"提交",backgroundColor:t.state.goods_nav_color.blue,color:"#fff"}]}}),onLoad(t){t.t&&(this.bill_no=t.t,this.load_inv_plans())},mounted(){},methods:{formatDate:T,goods_nav_click(t){0===t.index&&this.check_all()},goods_nav_admin_button_click(t){0==t.index&&this.submit_audit(),1===t.index&&this.preview_pdf()},goods_nav_staff_button_click(t){0==t.index&&this.submit_submit()},check_all(){let t=!this.inv_plans.find((t=>!t.disabled&&!t.checked));this.inv_plans.forEach((e=>{e.disabled||(e.checked=!t)}))},checkbox_click(t){let e=this.inv_plans.find((e=>e.FID==t.target.dataset.id));e&&!e.disabled&&(e.checked=!e.checked)},list_item_click(t){"A"==t.FDocumentStatu&&e({itemList:["删除"],success:e=>{0===e.tapIndex&&this.submit_delete(t)}})},async preview_pdf(){var t;let e=null==(t=this.inv_plans[0])?void 0:t.FReceiver;if(!e){let t=await L.view("SAL_DELIVERYNOTICE",{Number:this.bill_no});t.data.Result.ResponseStatus.IsSuccess&&(e=t.data.Result.Result.F_PAEZ_Text)}let a=this.inv_plans.filter((t=>t.checked));0===a.length&&(a=this.inv_plans);let l=A(a,{receiver:e});window.open(`#/pages/my/preview_pdf?url=${l}`,"newWindow","width=800")},if_submit_delete(t){a({title:"删除",content:"是否确定删除?",success:e=>{e.confirm&&this.submit_delete(t)},fail:t=>{}})},async load_inv_plans(){let e={FStockId:t.state.cur_stock.FStockId,FBillNo:this.bill_no,FOpType:"out"};l({title:"Loading"}),E.query(e,{}).then((e=>{i(),this.inv_plans=e.data,this.inv_plans.forEach((e=>{e.checked=!1,e.disabled=!["A","B"].includes(e.FDocumentStatu),e.status=t.state.document_status_dict[e.FDocumentStatu]}))}))},async submit_audit(){var t;let e=this.inv_plans.filter((t=>t.checked)),a=e.filter((t=>"A"==t.FDocumentStatu)).map((t=>t.FID));a.length&&await E.submit(a);let n=e.map((t=>t.FID));if(n.length){l({title:"Loading",mask:!0});let a=await E.audit(n);if(a.data.Result.ResponseStatus.IsSuccess){for(let t=0;t<e.length;t++)l({title:`Loading:${t}/${e.length}`,mask:!0}),await E.execute(e[t]);await this.load_inv_plans(),i(),s({title:"操作成功"})}else s({icon:"none",title:null==(t=a.data.Result.ResponseStatus.Errors[0])?void 0:t.Message})}else s({icon:"none",title:"未选择任何条目"})},async submit_submit(){let t=this.inv_plans.filter((t=>t.checked)).map((t=>t.FID));t.length?(l({title:"Loading",mask:!0}),E.submit(t).then((t=>{var e;t.data.Result.ResponseStatus.IsSuccess?this.load_inv_plans():s({icon:"none",title:null==(e=t.data.Result.ResponseStatus.Errors[0])?void 0:e.Message})}))):s({icon:"none",title:"未选择任何条目"})},async submit_delete(t){if("A"==t.FDocumentStatu)return l({title:"Loading",mask:!0}),E.delete([t.FID]).then((t=>{var e;i(),t.data.Result.ResponseStatus.IsSuccess?(M("delete"),this.load_inv_plans()):s({icon:"none",title:null==(e=t.data.Result.ResponseStatus.Errors[0])?void 0:e.Message})}));s({icon:"error",title:"只能删除新增的计划"})}}},[["render",function(t,e,a,l,i,s){var L,M;const E=S(n("uni-th"),F),A=S(n("uni-tr"),y),B=b,T=S(n("uni-td"),w),$=v,O=S(n("uni-tag"),I),q=S(n("uni-table"),x),P=S(n("uni-section"),C),Q=S(n("uni-goods-nav"),j),Y=_,z=S(n("uni-icons"),R),U=S(n("uni-list-item"),D),W=S(n("uni-list"),N);return"h5"===t.$store.state.screen_type?(r(),o(c,{key:0},[d(P,{title:"出库计划",type:"square","sub-title":[i.bill_no,null==(L=i.inv_plans[0])?void 0:L.FReceiver].join(" / "),class:"above-uni-goods-nav",onClick:e[0]||(e[0]=t=>console.log(">>> this.$data",this.$data))},{default:u((()=>[d(q,{ref:"table",border:"",stripe:""},{default:u((()=>[d(A,null,{default:u((()=>[d(E,{align:"center",width:"30"}),d(E,{align:"center",width:"60"},{default:u((()=>[p("序号")])),_:1}),d(E,{align:"center"},{default:u((()=>[p("物料编号")])),_:1}),d(E,{align:"center"},{default:u((()=>[p("物料名称")])),_:1}),d(E,{align:"center"},{default:u((()=>[p("规格型号")])),_:1}),d(E,{align:"center",width:"80"},{default:u((()=>[p("操作类型")])),_:1}),d(E,{align:"center",width:"60"},{default:u((()=>[p("数量")])),_:1}),d(E,{align:"center",width:"80"},{default:u((()=>[p("单位")])),_:1}),d(E,{align:"center",width:"120"},{default:u((()=>[p("库位")])),_:1}),d(E,{align:"center",width:"80"},{default:u((()=>[p("批次")])),_:1}),d(E,{align:"center"},{default:u((()=>[p("供应商")])),_:1}),d(E,{align:"center",width:"80"},{default:u((()=>[p("状态")])),_:1}),d(E,{align:"center",width:"160"},{default:u((()=>[p("时间")])),_:1}),d(E,{align:"center",width:"80"},{default:u((()=>[p("操作")])),_:1})])),_:1}),(r(!0),o(c,null,f(i.inv_plans,((t,e)=>(r(),m(A,{key:e},{default:u((()=>[d(T,null,{default:u((()=>[d(B,{checked:t.checked,disabled:t.disabled,onClick:s.checkbox_click,"data-id":t.FID},null,8,["checked","disabled","onClick","data-id"])])),_:2},1024),d(T,{align:"center"},{default:u((()=>[p(h(e+1),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t["FMaterialId.FNumber"]),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t["FMaterialId.FName"]),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t["FMaterialId.FSpecification"]),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(i.op_type_dict[t.FOpType]),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t.FOpQTY),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t["FStockUnitId.FName"]),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t["FStockLocId.FNumber"]),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t.FBatchNo),1)])),_:2},1024),d(T,null,{default:u((()=>[p(h(t["FSupplierId.FName"]),1)])),_:2},1024),d(T,null,{default:u((()=>[d($,{class:g([t.disabled?"text-error":"text-primary"])},{default:u((()=>[p(h(t.status),1)])),_:2},1032,["class"])])),_:2},1024),d(T,null,{default:u((()=>[p(h(s.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024),d(T,{align:"center"},{default:u((()=>["A"==t.FDocumentStatu?(r(),m(O,{key:0,text:"删除",type:"error",onClick:e=>s.if_submit_delete(t)},null,8,["onClick"])):k("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)])),_:1},8,["sub-title"]),d(Y,{class:"uni-goods-nav-wrapper"},{default:u((()=>[d(Q,{options:i.goods_nav.options,"button-group":i.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)):(r(),o(c,{key:1},[d(P,{title:"出库计划",type:"square","sub-title":[i.bill_no,null==(M=i.inv_plans[0])?void 0:M.FReceiver].join(" / "),class:"above-uni-goods-nav"},{default:u((()=>[d(W,null,{default:u((()=>[(r(!0),o(c,null,f(i.inv_plans,((t,e)=>(r(),m(U,{key:e,onClick:e=>s.list_item_click(t),clickable:"","show-arrow":"",onLongpress:e=>s.list_item_click(t)},{header:u((()=>[d(Y,{class:"uni-list-item__head"},{default:u((()=>[d(B,{checked:t.checked,disabled:t.disabled,onClick:s.checkbox_click,"data-id":t.FID},null,8,["checked","disabled","onClick","data-id"])])),_:2},1024)])),body:u((()=>[d(Y,{class:"uni-list-item__body"},{default:u((()=>[d(Y,{class:"title"},{default:u((()=>[p(h(t["FMaterialId.FNumber"]),1)])),_:2},1024),d(Y,{class:"note"},{default:u((()=>[d(Y,null,{default:u((()=>[p("名称："+h(t["FMaterialId.FName"]),1)])),_:2},1024),d(Y,null,{default:u((()=>[p("规格："+h(t["FMaterialId.FSpecification"]),1)])),_:2},1024),d(Y,null,{default:u((()=>[p(" 库位："),d($,{class:"loc_no"},{default:u((()=>[p(h(t["FStockLocId.FNumber"]),1)])),_:2},1024)])),_:2},1024),d(Y,null,{default:u((()=>[p("批次："+h(t.FBatchNo),1)])),_:2},1024),t["FSupplierId.FName"]?(r(),m(Y,{key:0},{default:u((()=>[p("供应商："+h(t["FSupplierId.FName"]),1)])),_:2},1024)):k("",!0)])),_:2},1024)])),_:2},1024)])),footer:u((()=>[d(Y,{class:"uni-list-item__foot"},{default:u((()=>[d(Y,{class:"op_qty"},{default:u((()=>[d(z,{type:"arrow-down",size:"18",color:"#4cd964"}),d($,{class:"op_qty"},{default:u((()=>[p(h(t.FOpQTY)+" "+h(t["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024),d($,{class:g(["status",t.disabled?"disabled":""])},{default:u((()=>[p(h(t.status),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick","onLongpress"])))),128))])),_:1})])),_:1},8,["sub-title"]),d(Y,{class:"uni-goods-nav-wrapper"},{default:u((()=>[d(Q,{options:i.goods_nav.options,"button-group":i.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64))}]]);export{$ as default};
