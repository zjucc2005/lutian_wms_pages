var e=Object.defineProperty;import{s as t}from"./index-CqdXm0r7.js";import{K as r}from"./k3cloudapi.BjBFa2ll.js";const i=class e{constructor(e={}){this.FOpSN=t.state.snowflake.next_id(),this.FOpType=e.FOpType,this.FStockId={FStockId:e.FStockId},this.FStockLocId={FNumber:e.FStockLocNo},this.FMaterialId={FMaterialId:e.FMaterialId},this.FOpQTY=e.FOpQTY,this.FInvIncre=["in_cl","out","mv_out","sub"].includes(e.FOpType)?-e.FOpQTY:e.FOpQTY,this.FBatchNo=e.FBatchNo,e.FSupplierId&&(this.FSupplierId={FSupplierId:e.FSupplierId}),this.FBillNo=e.FBillNo||"",this.FRemark=e.FRemark||"",this.FOpStaffNo=e.FOpStaffNo,this.FReferId=["in_cl","out_cl"].includes(e.FOpType)?e.FReferId:"",this.FReceiver=e.FReceiver||""}save(){const e={model:this};return r.save("PAEZ_C_INV_LOG",e)}static batch_save(e=[]){const t={model:e,ValidateRepeatJson:!0};return r.batch_save("PAEZ_C_INV_LOG",t)}static async delete(e=[]){const t={Ids:e.join(",")};return r.delete("PAEZ_C_INV_LOG",t)}static query(e={},t={}){const i={FormId:"PAEZ_C_INV_LOG",FieldKeys:["FID","FOpSN","FOpType","FOpQTY","FCreateTime","FMaterialId","FMaterialId.FNumber","FMaterialId.FName","FMaterialId.FSpecification","FStockId","FStockId.FName","FStockLocId","FStockLocId.FNumber","FStockUnitId","FStockUnitId.FName","FInvIncre","FInvQTY","FBatchNo","FBillNo","FSupplierId","FSupplierId.FName","FRemark","FOpStaffNo","FCInvId","FReferId","FReceiver"].join(","),FilterString:r.query_filter(e)};return t.per_page&&(i.Limit=t.per_page,t.page&&(i.StartRow=(t.page-1)*t.per_page)),t.order&&(i.OrderString=t.order),r.bill_query(i)}static find(e){return this.query({FID:e},{limit:1})}static async inventory_record(e={}){let t=[];return t=await this._inventory_record_recurse(e,{page:1,per_page:1e4,order:"FCreateTime ASC"},t),t}static async _inventory_record_recurse(e={},t={},i=[]){const F={FormId:"PAEZ_C_INV_LOG",FieldKeys:["FOpType","FInvIncre","FInvQty","FCreateTime"].join(","),FilterString:r.query_filter(e)};t.per_page&&(F.Limit=t.per_page,t.page&&(F.StartRow=(t.page-1)*t.per_page)),t.order&&(F.OrderString=t.order);let a=await r.execute_bill_query(F);return i=i.concat(a.data),a.data.length===t.per_page?(t.page+=1,this._inventory_record_recurse(e,t,i)):i}static async retry(t){if(t.FCInvId)return;let r={FOpType:t.FOpType,FStockId:t.FStockId,FStockLocNo:t["FStockLocId.FNumber"],FMaterialId:t.FMaterialId,FOpQTY:t.FOpQTY,FBatchNo:t.FBatchNo,FSupplierId:t.FSupplierId,FBillNo:t.FBillNo,FOpStaffNo:t.FOpStaffNo,FRemark:t.FRemark,FReceiver:t.FReceiver};await e.delete([t.FID]);let i=new e(r);await i.save()}};var F;((t,r,i)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i})(i,"symbol"!=typeof(F="FOpTypeEnum")?F+"":F,{in:"入库",out:"出库",mv_in:"移库上架",mv_out:"移库下架",add:"增加",sub:"减少"});const a=i;export{a as I};
