import{s as e,U as t,a,h as l,b as n,c as i,q as o,e as s,w as r,d as _,g as c,F as d,i as u,o as f,f as m,u as p,t as h,k as g}from"./index-DWoH3vfe.js";import{_ as b}from"./uni-easyinput.D91VfiYe.js";import{r as y}from"./uni-app.es.BmoqNwAf.js";import{_ as k}from"./uni-section.iEIUA4ss.js";import{_ as v}from"./uni-notice-bar.B9xPLnV8.js";import{_ as F,a as j,b as q}from"./uni-td.rHsSWZDb.js";import{_ as C}from"./uqrcode.DAndGp11.js";import{_ as x}from"./uni-tag.BmIXmh-Z.js";import{_ as w}from"./uni-table.Die1grMA.js";import{_ as I}from"./uni-list-item.DDtNoANW.js";import{_ as M}from"./uni-list.BUls3DLZ.js";import{_ as $}from"./uni-goods-nav.CFHsP2dB.js";import{f as N}from"./date-format.Dm3Q97cL.js";import"./k3cloudapi.RL4SGN7f.js";import"./stock_loc.DkKMhjD6.js";import"./inv_log.B23E6Sfg.js";import{P as A}from"./pur_receive_bill.Bu4TH3zy.js";import{s as Q}from"./scan_code.B9tgpVm4.js";import{g as S}from"./gen_pdf.DKu42O_D.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.Btv09wDc.js";import"./uni-datetime-picker.C-HBs-Rb.js";import"./uni-badge.Dyjwvs1c.js";const U=R({data:()=>({search_form:{bill_no:""},materials:[],goods_nav:{options:[],button_group:[{text:"扫码查询单据",backgroundColor:e.state.goods_nav_color.red,color:"#fff"}]}}),methods:{gen_label(e,a){t({canvasId:a,success:function(t){let a=S({...e,qr:t.tempFilePath,inbound_time:N(Date.now(),"yyyy-MM-dd")});window.open(`#/pages/my/preview_pdf?url=${a}`,"newWindow","width=800,height=600")}})},goods_nav_click(e){0===e.index&&this.$logger.info("this.$data",this.$data)},goods_nav_button_click(e){0===e.index&&this.scan_code()},async handle_search(e){if(this.search_form.bill_no){this.search_form.bill_no=this.search_form.bill_no.trim().toUpperCase(),this.search_form.bill_no.match(/^\d+$/)&&(this.search_form.bill_no="CGSL"+this.search_form.bill_no),a({title:"Loading"});let e=await A.query({FBillNo:this.search_form.bill_no});this.handle_data(e),l(),0===e.data.length&&n({icon:"none",title:"单据编号不存在"})}else this.materials=[]},handle_data(e){let t=[];for(let a of e.data){let e=t.find((e=>e.id==a.FMaterialId));e?e.qty+=a.FActReceiveQty:t.push({id:a.FMaterialId,no:a["FMaterialId.FNumber"],name:a["FMaterialId.FName"],spec:a["FMaterialId.FSpecification"],stock_name:a["FStockId.FName"],supplier_name:a["FSupplierId.FName"],qty:a.FActReceiveQty,unit_name:a["FUnitId.FName"],plt_std_qty:1*a["FMaterialId.F_RGEN_Text_qtr"],box_std_qty:a["FMaterialId.FBoxStandardQty"]})}for(let a of t)a.plt_print_copy=a.plt_std_qty?4*Math.ceil(a.qty/a.plt_std_qty):"NA",a.box_print_copy=a.box_std_qty?Math.ceil(a.qty/a.box_std_qty):"NA";this.materials=t},scan_code(){Q().then((e=>{this.search_form.bill_no=e.result,this.handle_search()})).catch((e=>{n({icon:"none",title:e})}))},searchbar_icon_click(e){"prefix"==e&&this.scan_code()}}},[["render",function(e,t,a,l,n,N){var A;const Q=y(i("uni-easyinput"),b),S=u,R=y(i("uni-section"),k),U=y(i("uni-notice-bar"),v),B=y(i("uni-th"),F),z=y(i("uni-tr"),j),G=y(i("uni-td"),q),P=y(i("uqrcode"),C),V=y(i("uni-tag"),x),D=y(i("uni-table"),w),L=g,T=y(i("uni-list-item"),I),W=y(i("uni-list"),M),E=y(i("uni-goods-nav"),$);return f(),o(d,null,[s(R,{title:"查询收料通知单编号",type:"square"},{default:r((()=>[s(S,{class:"searchbar-container"},{default:r((()=>[s(Q,{modelValue:n.search_form.bill_no,"onUpdate:modelValue":t[0]||(t[0]=e=>n.search_form.bill_no=e),placeholder:"请输入搜索内容","prefix-icon":"scan",focus:"",onConfirm:N.handle_search,onClear:N.handle_search,onIconClick:N.searchbar_icon_click,"primary-color":"rgb(238, 238, 238)",styles:{color:"#000",backgroundColor:"rgb(238, 238, 238)",borderColor:"rgb(238, 238, 238)"}},null,8,["modelValue","onConfirm","onClear","onIconClick","styles"])])),_:1})])),_:1}),(null==(A=n.materials)?void 0:A.length)?(f(),_(R,{key:0,title:"物料明细",type:"square",class:"above-uni-goods-nav"},{default:r((()=>[s(U,{single:"",text:"请在二维码生成后，再点击生成标签"}),"h5"===e.$store.state.screen_type?(f(),_(D,{key:0,ref:"table",border:"",stripe:""},{default:r((()=>[s(z,null,{default:r((()=>[s(B,{align:"center",width:"60"},{default:r((()=>[m("序号")])),_:1}),s(B,{align:"center",width:"60"},{default:r((()=>[m("QR")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("物料编码")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("物料名称")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("规格型号")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("仓库")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("供应商")])),_:1}),s(B,{align:"center",width:"80"},{default:r((()=>[m("交货数量")])),_:1}),s(B,{align:"center",width:"80"},{default:r((()=>[m("收料单位")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("按托标签数")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("按箱标签数")])),_:1}),s(B,{align:"center"},{default:r((()=>[m("操作")])),_:1})])),_:1}),(f(!0),o(d,null,p(n.materials,((e,t)=>(f(),_(z,{key:t},{default:r((()=>[s(G,{align:"center"},{default:r((()=>[m(h(t+1),1)])),_:2},1024),s(G,{align:"center"},{default:r((()=>[s(P,{"canvas-id":`qrcode_${t}`,value:e.no,size:40},null,8,["canvas-id","value"])])),_:2},1024),s(G,null,{default:r((()=>[m(h(e.no),1)])),_:2},1024),s(G,null,{default:r((()=>[m(h(e.name),1)])),_:2},1024),s(G,null,{default:r((()=>[m(h(e.spec),1)])),_:2},1024),s(G,null,{default:r((()=>[m(h(e.stock_name),1)])),_:2},1024),s(G,null,{default:r((()=>[m(h(e.supplier_name),1)])),_:2},1024),s(G,{align:"center"},{default:r((()=>[m(h(e.qty),1)])),_:2},1024),s(G,{align:"center"},{default:r((()=>[m(h(e.unit_name),1)])),_:2},1024),s(G,{align:"center"},{default:r((()=>[m(h(e.plt_print_copy),1)])),_:2},1024),s(G,{align:"center"},{default:r((()=>[m(h(e.box_print_copy),1)])),_:2},1024),s(G,{align:"center"},{default:r((()=>[s(V,{text:"生成标签",type:"primary",onClick:a=>N.gen_label(e,`qrcode_${t}`)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)):(f(),_(W,{key:1},{default:r((()=>[(f(!0),o(d,null,p(n.materials,((e,t)=>(f(),_(T,{key:t,onClick:a=>N.gen_label(e,`qrcode_${t}`),clickable:"","show-arrow":""},{header:r((()=>[s(S,{class:"uni-list-item__head"},{default:r((()=>[s(P,{"canvas-id":`qrcode_${t}`,value:e.no,size:40},null,8,["canvas-id","value"])])),_:2},1024)])),body:r((()=>[s(S,{class:"uni-list-item__body"},{default:r((()=>[s(L,{class:"title"},{default:r((()=>[m(h(e.no),1)])),_:2},1024),s(S,{class:"note"},{default:r((()=>[s(S,null,{default:r((()=>[m("名称："+h(e.name),1)])),_:2},1024),s(S,null,{default:r((()=>[m("规格："+h(e.spec),1)])),_:2},1024),s(S,null,{default:r((()=>[m("仓库："),s(L,{class:"text-primary"},{default:r((()=>[m(h(e.stock_name),1)])),_:2},1024)])),_:2},1024),s(S,null,{default:r((()=>[m("供应商："+h(e.supplier_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),footer:r((()=>[s(S,{class:"uni-list-item__foot"},{default:r((()=>[s(L,null,{default:r((()=>[m(h(e.FActReceiveQty)+" "+h(e["FUnitId.FName"]),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}))])),_:1})):c("",!0),"app-plus"===e.$store.state.screen_type?(f(),_(S,{key:1,class:"uni-goods-nav-wrapper"},{default:r((()=>[s(E,{options:n.goods_nav.options,"button-group":n.goods_nav.button_group,fill:e.$store.state.goods_nav_fill,onClick:N.goods_nav_click,onButtonClick:N.goods_nav_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})):c("",!0)],64)}]]);export{U as default};
