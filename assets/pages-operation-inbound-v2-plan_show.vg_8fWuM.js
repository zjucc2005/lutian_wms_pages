import{s as t,p as e,m as a,a as l,h as i,b as s,c as n,q as o,e as d,w as u,F as c,i as _,o as r,f as p,u as f,d as m,t as g,L as h,g as k,y as b,k as F}from"./index-CqdXm0r7.js";import{_ as v,a as y,b as I}from"./uni-td.DUkeCS-G.js";import{r as S}from"./uni-app.es.D0fJ2kcT.js";import{_ as w}from"./uni-tag.BBpEhQxo.js";import{_ as x}from"./uni-table.Zy821uFa.js";import{_ as j}from"./uni-section.DKwkJd1U.js";import{_ as C}from"./uni-goods-nav.CDNwxccE.js";import{_ as D}from"./uni-icons.KMw0mbbD.js";import{_ as N}from"./uni-list-item.Dzmn-3-a.js";import{_ as M}from"./uni-list.CUX66DwN.js";import{p as L}from"./index.DXIG_Tpn.js";import"./k3cloudapi.BjBFa2ll.js";import{a as R}from"./stock_loc.B6bAmQXk.js";import"./inv_log.EW53o3V_.js";import{p as B}from"./gen_pdf.Bxf-8VOl.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{f as E}from"./date-format.Dm3Q97cL.js";import"./uni-datetime-picker.CaT3XNFC.js";import"./uni-badge.Wm6ZM3Cx.js";const O=A({props:{t:{type:String}},data:()=>({bill_no:"",inv_plans:[],op_type_dict:R.FOpTypeEnum,goods_nav:{options:[{icon:"checkbox",text:"全选"}],admin_button_group:[{text:"审核确认",backgroundColor:t.state.goods_nav_color.green,color:"#fff"},{text:"预览PDF",backgroundColor:t.state.goods_nav_color.blue,color:"#fff"}],staff_button_group:[{text:"提交",backgroundColor:t.state.goods_nav_color.grey.blue,color:"#fff"}]}}),onLoad(t){t.t&&(this.bill_no=t.t,this.load_inv_plans())},mounted(){},methods:{formatDate:E,goods_nav_click(t){0===t.index&&this.check_all()},goods_nav_admin_button_click(t){0===t.index&&this.submit_audit(),1===t.index&&this.preview_pdf()},goods_nav_staff_button_click(t){0===t.index&&this.submit_submit()},check_all(){let t=!this.inv_plans.find((t=>!t.disabled&&!t.checked));this.inv_plans.forEach((e=>{e.disabled||(e.checked=!t)}))},checkbox_click(t){let e=this.inv_plans.find((e=>e.FID==t.target.dataset.id));e&&!e.disabled&&(e.checked=!e.checked)},list_item_click(t){"A"==t.FDocumentStatu&&e({itemList:["删除"],success:e=>{0===e.tapIndex&&this.submit_delete(t)}})},preview_pdf(){let t=this.inv_plans.filter((t=>t.checked));0===t.length&&(t=this.inv_plans);let e=B(t);window.open(`#/pages/my/preview_pdf?url=${e}`,"newWindow","width=800")},if_submit_delete(t){a({title:"删除",content:"是否确定删除?",success:e=>{e.confirm&&this.submit_delete(t)},fail:t=>{}})},async load_inv_plans(){let e={FStockId:t.state.cur_stock.FStockId,FBillNo:this.bill_no,FOpType:"in"};"nrj_admin"==t.state.role&&(e["FMaterialId.F_PAEZ_Base1"]=t.state.cur_staff.FName),l({title:"Loading",mask:!0}),R.query(e,{}).then((e=>{i(),this.inv_plans=e.data,this.inv_plans.forEach((e=>{e.checked=!1,e.disabled=!["A","B"].includes(e.FDocumentStatu),e.status=t.state.document_status_dict[e.FDocumentStatu]}))}))},async submit_audit(){var t;let e=this.inv_plans.filter((t=>t.checked&&["A","B"].includes(t.FDocumentStatu))),a=e.filter((t=>"A"==t.FDocumentStatu)).map((t=>t.FID));a.length&&await R.submit(a);let n=e.map((t=>t.FID));if(n.length){l({title:"Loading",mask:!0});let a=await R.audit(n);if(a.data.Result.ResponseStatus.IsSuccess){for(let t=0;t<e.length;t++)l({title:`Loading:${t}/${e.length}`,mask:!0}),await R.execute(e[t]);await this.load_inv_plans(),i(),s({title:"操作成功"})}else s({icon:"none",title:null==(t=a.data.Result.ResponseStatus.Errors[0])?void 0:t.Message})}else s({icon:"none",title:"未选择任何条目"})},async submit_submit(){let t=this.inv_plans.filter((t=>t.checked)).map((t=>t.FID));t.length?(l({title:"Loading",mask:!0}),R.submit(t).then((t=>{var e;t.data.Result.ResponseStatus.IsSuccess?this.load_inv_plans():s({icon:"none",title:null==(e=t.data.Result.ResponseStatus.Errors[0])?void 0:e.Message})}))):s({icon:"none",title:"未选择任何条目"})},async submit_delete(t){if("A"==t.FDocumentStatu)return l({title:"Loading",mask:!0}),R.delete([t.FID]).then((t=>{var e;i(),t.data.Result.ResponseStatus.IsSuccess?(L("delete"),this.load_inv_plans()):s({icon:"none",title:null==(e=t.data.Result.ResponseStatus.Errors[0])?void 0:e.Message})}));s({icon:"error",title:"只能删除新增的计划"})}}},[["render",function(t,e,a,l,i,s){const L=S(n("uni-th"),v),R=S(n("uni-tr"),y),B=b,A=S(n("uni-td"),I),E=F,O=S(n("uni-tag"),w),T=S(n("uni-table"),x),$=S(n("uni-section"),j),q=S(n("uni-goods-nav"),C),P=_,Q=S(n("uni-icons"),D),z=S(n("uni-list-item"),N),U=S(n("uni-list"),M);return"h5"===t.$store.state.screen_type?(r(),o(c,{key:0},[d($,{title:"入库计划",type:"square","sub-title":i.bill_no,class:"above-uni-goods-nav"},{default:u((()=>[d(T,{ref:"table",border:"",stripe:""},{default:u((()=>[d(R,null,{default:u((()=>[d(L,{align:"center",width:"30"}),d(L,{align:"center",width:"60"},{default:u((()=>[p("序号")])),_:1}),d(L,{align:"center"},{default:u((()=>[p("物料编号")])),_:1}),d(L,{align:"center"},{default:u((()=>[p("物料名称")])),_:1}),d(L,{align:"center"},{default:u((()=>[p("规格型号")])),_:1}),d(L,{align:"center",width:"80"},{default:u((()=>[p("操作类型")])),_:1}),d(L,{align:"center",width:"60"},{default:u((()=>[p("数量")])),_:1}),d(L,{align:"center",width:"80"},{default:u((()=>[p("单位")])),_:1}),d(L,{align:"center",width:"120"},{default:u((()=>[p("库位")])),_:1}),d(L,{align:"center",width:"80"},{default:u((()=>[p("批次")])),_:1}),d(L,{align:"center"},{default:u((()=>[p("供应商")])),_:1}),d(L,{align:"center",width:"80"},{default:u((()=>[p("状态")])),_:1}),d(L,{align:"center",width:"160"},{default:u((()=>[p("时间")])),_:1}),d(L,{align:"center",width:"80"},{default:u((()=>[p("操作")])),_:1})])),_:1}),(r(!0),o(c,null,f(i.inv_plans,((t,e)=>(r(),m(R,{key:e},{default:u((()=>[d(A,null,{default:u((()=>[d(B,{checked:t.checked,disabled:t.disabled,onClick:s.checkbox_click,"data-id":t.FID},null,8,["checked","disabled","onClick","data-id"])])),_:2},1024),d(A,{align:"center"},{default:u((()=>[p(g(e+1),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t["FMaterialId.FNumber"]),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t["FMaterialId.FName"]),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t["FMaterialId.FSpecification"]),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(i.op_type_dict[t.FOpType]),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t.FOpQTY),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t["FStockUnitId.FName"]),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t["FStockLocId.FNumber"]),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t.FBatchNo),1)])),_:2},1024),d(A,null,{default:u((()=>[p(g(t["FSupplierId.FName"]),1)])),_:2},1024),d(A,null,{default:u((()=>[d(E,{class:h([t.disabled?"text-error":"text-primary"])},{default:u((()=>[p(g(t.status),1)])),_:2},1032,["class"])])),_:2},1024),d(A,null,{default:u((()=>[p(g(s.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss")),1)])),_:2},1024),d(A,{align:"center"},{default:u((()=>["A"==t.FDocumentStatu?(r(),m(O,{key:0,text:"删除",type:"error",onClick:e=>s.if_submit_delete(t)},null,8,["onClick"])):k("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)])),_:1},8,["sub-title"]),d(P,{class:"uni-goods-nav-wrapper"},{default:u((()=>[d(q,{options:i.goods_nav.options,"button-group":i.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64)):(r(),o(c,{key:1},[d($,{title:"入库计划",type:"square","sub-title":i.bill_no,class:"above-uni-goods-nav"},{default:u((()=>[d(U,null,{default:u((()=>[(r(!0),o(c,null,f(i.inv_plans,((t,e)=>(r(),m(z,{key:e,onClick:e=>s.list_item_click(t),clickable:"","show-arrow":"",onLongpress:e=>s.list_item_click(t)},{header:u((()=>[d(P,{class:"uni-list-item__head"},{default:u((()=>[d(B,{checked:t.checked,disabled:t.disabled,onClick:s.checkbox_click,"data-id":t.FID},null,8,["checked","disabled","onClick","data-id"])])),_:2},1024)])),body:u((()=>[d(P,{class:"uni-list-item__body"},{default:u((()=>[d(P,{class:"title"},{default:u((()=>[p(g(t["FMaterialId.FNumber"]),1)])),_:2},1024),d(P,{class:"note"},{default:u((()=>[d(P,null,{default:u((()=>[p("名称："+g(t["FMaterialId.FName"]),1)])),_:2},1024),d(P,null,{default:u((()=>[p("规格："+g(t["FMaterialId.FSpecification"]),1)])),_:2},1024),d(P,null,{default:u((()=>[p(" 库位："),d(E,{class:"loc_no"},{default:u((()=>[p(g(t["FStockLocId.FNumber"]),1)])),_:2},1024)])),_:2},1024),d(P,null,{default:u((()=>[p("批次："+g(t.FBatchNo),1)])),_:2},1024),t["FSupplierId.FName"]?(r(),m(P,{key:0},{default:u((()=>[p("供应商："+g(t["FSupplierId.FName"]),1)])),_:2},1024)):k("",!0)])),_:2},1024)])),_:2},1024)])),footer:u((()=>[d(P,{class:"uni-list-item__foot"},{default:u((()=>[d(P,{class:"op_qty"},{default:u((()=>[d(Q,{type:"arrow-up",size:"18",color:"#dd524d"}),d(E,null,{default:u((()=>[p(g(t.FOpQTY)+" "+g(t["FStockUnitId.FName"]),1)])),_:2},1024)])),_:2},1024),d(E,{class:h([t.disabled?"text-error":"text-primary"])},{default:u((()=>[p(g(t.status),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1032,["onClick","onLongpress"])))),128))])),_:1})])),_:1},8,["sub-title"]),d(P,{class:"uni-goods-nav-wrapper"},{default:u((()=>[d(q,{options:i.goods_nav.options,"button-group":i.goods_nav.admin_button_group,fill:t.$store.state.goods_nav_fill,onClick:s.goods_nav_click,onButtonClick:s.goods_nav_admin_button_click},null,8,["options","button-group","fill","onClick","onButtonClick"])])),_:1})],64))}],["__scopeId","data-v-3e41f6f4"]]);export{O as default};
