import{s as t,x as s,b as i,c as e,d as o,w as a,i as n,o as r,e as c,q as l,u as _,F as u,f as d,t as f,k as p}from"./index-DjNCOAYS.js";import{_ as h}from"./uni-list-item.Dm5ieig7.js";import{r as m}from"./uni-app.es.Ch8d-HxS.js";import{_ as F,a as g}from"./uni-swipe-action.nwLs6Yb7.js";import{_ as k}from"./uni-section.Cyvrqc16.js";import{d as v,p as I}from"./index.uJty1kg6.js";import{I as b}from"./inv_log.B3mwqkWu.js";import{f as y}from"./date-format.Dm3Q97cL.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.CZYyaTue.js";import"./uni-badge.DRmKIMEp.js";import"./k3cloudapi.B_cIKn_3.js";const S=j({data:()=>({cur_stock:{},cur_staff:{},cur_inbound_task:{},inv_logs:[],log_options:[{text:"取消",style:{backgroundColor:"#f56c6c"}}]}),mounted(){this.cur_stock=t.state.cur_stock,this.cur_staff=t.state.cur_staff,this.cur_inbound_task=s("cur_inbound_task"),this.load_inv_logs()},methods:{describe_inv_log:v,formatDate:y,load_inv_logs(){b.query({FStockId:this.cur_stock.FStockId,FBatchNo:this.cur_inbound_task.batch_no,FOpType_in:["in","in_cl"]},{order:"FCreateTime DESC"}).then((t=>{t.data.reverse().forEach((t=>this.unshift_inv_log(t)))}))},swipe_action_click(t,s){0===t.index&&this.submit_cancel(s)},submit_cancel(t){let s=this.inv_logs.find((s=>s.FID===t));if("in"!=s.FOpType||s.status)i({icon:"error",title:"ERROR"});else{new b({FOpType:"in_cl",FStockId:s.FStockId,FStockLocNo:s["FStockLocId.FNumber"],FMaterialId:s.FMaterialId,FOpQTY:s.FOpQTY,FBatchNo:s.FBatchNo,FBillNo:s.FBillNo,FOpStaffNo:this.cur_staff.FNumber,FReferId:s.FID}).save().then((t=>{I("success"),this.after_save(t),this.$refs.inv_log_swipe.closeAll()}))}},after_save(t){t.data.Result.ResponseStatus.IsSuccess?b.find(t.data.Result.Id).then((t=>{t.data[0]&&(this.unshift_inv_log(t.data[0]),i({title:"提交成功"}))})):i({title:"提交失败"})},unshift_inv_log(t){if("in_cl"==t.FOpType){let s=this.inv_logs.find((s=>s.FID===t.FReferId));s&&(s.status="已取消")}this.inv_logs.unshift(t)}}},[["render",function(t,s,i,v,I,b){const y=p,j=m(e("uni-list-item"),h),S=m(e("uni-swipe-action-item"),F),T=m(e("uni-swipe-action"),g),x=m(e("uni-section"),k),N=n;return r(),o(N,null,{default:a((()=>[c(x,{title:"操作日志",type:"line"},{default:a((()=>[c(T,{ref:"inv_log_swipe"},{default:a((()=>[(r(!0),l(u,null,_(I.inv_logs,((t,s)=>(r(),o(S,{key:s,threshold:60,"right-options":"in"!=t.FOpType||t.status?[]:I.log_options,onClick:s=>b.swipe_action_click(s,t.FID)},{default:a((()=>[c(j,{title:b.formatDate(t.FCreateTime,"yyyy-MM-dd hh:mm:ss"),note:b.describe_inv_log(t),rightText:t.status},{footer:a((()=>[c(y,{class:"uni-list-item-right-text"},{default:a((()=>[d(f(t.status),1)])),_:2},1024)])),_:2},1032,["title","note","rightText"])])),_:2},1032,["right-options","onClick"])))),128))])),_:1},512)])),_:1})])),_:1})}],["__scopeId","data-v-1c8e0124"]]);export{S as default};
